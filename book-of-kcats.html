<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-10-31 Tue 15:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The kcats Programming Language</title>
<meta name="author" content="Skyrod Vactai" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<style> pre.src { background: black; color: white; } #content { max-width: 1000px } </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="docs-custom.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">The kcats Programming Language</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org075d6c5">1. Summary</a></li>
<li><a href="#org58c404b">2. Examples</a>
<ul>
<li><a href="#orgc9b6a3f">2.1. Produce fibonacci sequence</a></li>
<li><a href="#orgb4f66a0">2.2. Sequence operations</a></li>
</ul>
</li>
<li><a href="#org8a0eaca">3. Benefits</a>
<ul>
<li><a href="#org9b56a86">3.1. Easy for beginners</a></li>
<li><a href="#org727ffe7">3.2. Powerful</a></li>
<li><a href="#orgd8266e4">3.3. Excels in the small</a></li>
<li><a href="#orga36f05f">3.4. Features</a></li>
<li><a href="#orgf50e1df">3.5. Tradeoffs</a></li>
</ul>
</li>
<li><a href="#org167ada2">4. Getting Started</a>
<ul>
<li><a href="#orgc4594bb">4.1. Builds</a>
<ul>
<li><a href="#org8def008">4.1.1. Download pre-built binaries</a></li>
<li><a href="#org2a2f555">4.1.2. Build from source</a>
<ul>
<li><a href="#org9960f89">4.1.2.1. Dependencies</a></li>
<li><a href="#org12e23b8">4.1.2.2. Creating the source</a></li>
<li><a href="#orgdf26daf">4.1.2.3. Building</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2aca77c">4.2. Using</a></li>
<li><a href="#org82a8943">4.3. Developing</a>
<ul>
<li><a href="#orge204cde">4.3.1. Browsing the source</a></li>
<li><a href="#orga752fbf">4.3.2. Emacs IDE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbde1736">5. Fundamentals</a>
<ul>
<li><a href="#org9145568">5.1. Key terminology</a></li>
<li><a href="#orgcb4cb3f">5.2. The stack</a></li>
<li><a href="#org46e5c65">5.3. Exploring</a>
<ul>
<li><a href="#orgcd4a01d">5.3.1. Overview</a></li>
<li><a href="#org0c357fb">5.3.2. What words or functions are available?</a></li>
<li><a href="#orgb44b413">5.3.3. What inputs/outputs does a particular word have?</a></li>
<li><a href="#orge173ca7">5.3.4. What are some example usages of a word?</a></li>
<li><a href="#orge943505">5.3.5. Continuing exploration</a></li>
</ul>
</li>
<li><a href="#orgf9a9c0e">5.4. Data types</a>
<ul>
<li><a href="#org9cb0813">5.4.1. Types</a>
<ul>
<li><a href="#org09b4be9">5.4.1.1. Words</a></li>
<li><a href="#orgbed6dc2">5.4.1.2. Booleans</a></li>
<li><a href="#org6d8d5e0">5.4.1.3. Numbers</a></li>
<li><a href="#org83044bc">5.4.1.4. Containers</a></li>
<li><a href="#org951a52a">5.4.1.5. Errors</a></li>
<li><a href="#org8af140c">5.4.1.6. Pipes</a></li>
</ul>
</li>
<li><a href="#orga377943">5.4.2. Traits</a>
<ul>
<li><a href="#org4fd7c28">5.4.2.1. Dispenser</a></li>
<li><a href="#org12fca78">5.4.2.2. Receptacle</a></li>
<li><a href="#org940386c">5.4.2.3. Sized</a></li>
<li><a href="#orge76683c">5.4.2.4. Ordered</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd6719f7">5.5. Stack motion</a></li>
<li><a href="#orga1dcb3a">5.6. Cloning and dropping</a></li>
<li><a href="#org4acf772">5.7. Programs that write programs</a></li>
<li><a href="#org72b8129">5.8. Looping and branching</a>
<ul>
<li><a href="#org9e2d247">5.8.1. if</a></li>
<li><a href="#orgdeecd4f">5.8.2. loop</a></li>
<li><a href="#orgbd9a864">5.8.3. while</a></li>
<li><a href="#orgedb8845">5.8.4. until</a></li>
</ul>
</li>
<li><a href="#org7d9196e">5.9. Argument order</a></li>
<li><a href="#org606a84f">5.10. Item hiding</a></li>
<li><a href="#org1bd890d">5.11. Stack effect control</a></li>
<li><a href="#org79b5978">5.12. 'down' and 'deep' variants</a></li>
<li><a href="#org980d388">5.13. Promotion</a></li>
<li><a href="#orgce6b821">5.14. Error handling</a></li>
<li><a href="#org06556fb">5.15. Your own words</a></li>
<li><a href="#org03a09fb">5.16. Generators</a>
<ul>
<li><a href="#org799e8c8">5.16.1. Overview</a></li>
<li><a href="#org0da8607">5.16.2. Example</a></li>
<li><a href="#orgc8e3939">5.16.3. Compatibility</a></li>
<li><a href="#org485a8bc">5.16.4. Capturing items from the stack</a></li>
</ul>
</li>
<li><a href="#orgb93aa3a">5.17. Coordination and Input/Output</a>
<ul>
<li><a href="#org3efc9ff">5.17.1. Basics</a></li>
<li><a href="#orgb0040f6">5.17.2. Input/output</a></li>
<li><a href="#org5abbb21">5.17.3. Coordination of simultaneous programs</a>
<ul>
<li><a href="#org716927b">5.17.3.1. Basics</a></li>
<li><a href="#org318d431">5.17.3.2. Channels</a></li>
<li><a href="#org78f15e7">5.17.3.3. Multiple environments</a></li>
<li><a href="#org395d139">5.17.3.4. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org95ffeeb">5.18. Debugging</a>
<ul>
<li><a href="#orgfbf1089">5.18.1. The debugger</a></li>
<li><a href="#orgab30ab9">5.18.2. Other tools</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org17d36a4">6. More Examples</a>
<ul>
<li><a href="#org1b6c89c">6.1. Query a flat file database</a></li>
<li><a href="#org94e0512">6.2. Factorial</a>
<ul>
<li><a href="#org9665f7d">6.2.1. Recursive with recur</a></li>
<li><a href="#orgbf51315">6.2.2. Using range</a></li>
<li><a href="#org544da5a">6.2.3. Plain loop</a></li>
</ul>
</li>
<li><a href="#org059266d">6.3. Jensen's Device</a></li>
<li><a href="#org83144da">6.4. Fibonacci</a></li>
<li><a href="#orgb40cb7e">6.5. Prime factors</a></li>
<li><a href="#org9c868f0">6.6. bidirectional comms from a socket</a></li>
<li><a href="#org2820859">6.7. Write string to a file</a></li>
<li><a href="#org51c304f">6.8. Search the dictionary</a></li>
<li><a href="#org5abd501">6.9. Copy data from one file to another</a></li>
<li><a href="#orge887b59">6.10. List the steps of program execution</a></li>
</ul>
</li>
<li><a href="#orgdbedf85">7. Contributing</a>
<ul>
<li><a href="#org0ca3697">7.1. Issue reporting</a></li>
</ul>
</li>
<li><a href="#org7b40bc9">8. FAQ</a>
<ul>
<li><a href="#org23f7813">8.1. How do I keep track of what should be on the stack, as I write programs?</a></li>
<li><a href="#org13e8342">8.2. Why is there no word 'no' in kcats, but there is 'yes'?</a></li>
<li><a href="#org33fa6ea">8.3. I got an error, how do I diagnose the problem?</a></li>
<li><a href="#orgd72d606">8.4. kcats panics and exits, why?</a></li>
</ul>
</li>
<li><a href="#org9d3233c">9. Issues</a>
<ul>
<li><a href="#org39544ad">9.1. <span class="done DONE">DONE</span> Build without using emacs interactively</a></li>
<li><a href="#org0e1e20d">9.2. <span class="done DONE">DONE</span> Remove platform interop from lexicon</a></li>
<li><a href="#org5956ab9">9.3. <span class="done DONE">DONE</span> 'unassign' doesn't take a keylist, only a single key</a></li>
<li><a href="#orga2330ba">9.4. <span class="done DONE">DONE</span> More support for nested/related envs</a></li>
<li><a href="#org16ae379">9.5. <span class="todo TODO">TODO</span> Graphical environment browser/editor</a></li>
<li><a href="#orga5c40f2">9.6. <span class="todo TODO">TODO</span> Code distribution method</a>
<ul>
<li><a href="#org3636b59">9.6.1. Durability</a>
<ul>
<li><a href="#org1fcce61">9.6.1.1. Possible dynamic sql db</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2509202">9.7. <span class="done DONE">DONE</span> Clean up all the vector conversion</a></li>
<li><a href="#org76beef1">9.8. <span class="done DONE">DONE</span> org-babel-execute for kcats</a></li>
<li><a href="#org3c8b32d">9.9. <span class="todo INPROGRESS">INPROGRESS</span> At least one example for each word in lexicon</a></li>
<li><a href="#org5367ff4">9.10. <span class="todo INPROGRESS">INPROGRESS</span> Prime number sieve example</a></li>
<li><a href="#org0e40b3b">9.11. <span class="todo TODO">TODO</span> FAQ entry about composability</a></li>
</ul>
</li>
<li><a href="#orgda3d601">10. Acknowledgements</a></li>
<li><a href="#org7965e74">11. Roadmap Notes</a>
<ul>
<li><a href="#org12b5f1b">11.1. Higher level persistence abstraction</a></li>
<li><a href="#org1457e39">11.2. Object construction, caching</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<img src="./kcats.png" alt="kcats.png" />
<img src="./kcats-repl.gif" alt="kcats-repl.gif" />
</p>
<div id="outline-container-org075d6c5" class="outline-2">
<h2 id="org075d6c5"><span class="section-number-2">1.</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
A simple, powerful, beginner-friendly programming language.
</p>
</div>
</div>
<div id="outline-container-org58c404b" class="outline-2">
<h2 id="org58c404b"><span class="section-number-2">2.</span> Examples</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgc9b6a3f" class="outline-3">
<h3 id="orgc9b6a3f"><span class="section-number-3">2.1.</span> Produce fibonacci sequence</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Here we show a local word definition <code>fibonacci</code> which accepts a
number <code>n</code> (how many items in the sequence to produce) and produces a
list (the sequence).
</p>

<p>
Then we call the word with <code>n = 20</code>.
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>fibonacci <span class="org-kcats-brackets">[[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> taker
              collect<span class="org-kcats-brackets">]</span>
             <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[</span>20 fibonacci<span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb4f66a0" class="outline-3">
<h3 id="orgb4f66a0"><span class="section-number-3">2.2.</span> Sequence operations</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Find highest priced of all products rated 4.5 or higher, and in stock
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[[</span>name <span class="org-string">"Mouse"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 50<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Laptop"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 1000<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Desktop"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 1500<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.9<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock <span class="org-kcats-brackets">[]]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Tungsten Cube"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 2500<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 3.4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Keyboard"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 70<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.8<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock <span class="org-kcats-brackets">[]]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Monitor"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 200<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Camera"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>price 600<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>rating 4.3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">make a generator</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> 

 <span class="org-comment-delimiter">;; </span><span class="org-comment">keep only rating &gt;= 4.5 AND inStock</span>
 <span class="org-kcats-brackets">[[[[</span>rating<span class="org-kcats-brackets">]</span> lookup 4.5 &gt;=<span class="org-kcats-brackets">]</span> 
   <span class="org-kcats-brackets">[[</span>inStock<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
  every?<span class="org-kcats-brackets">]</span> keep

 <span class="org-comment-delimiter">;; </span><span class="org-comment">find the remaining product with highest price</span>
 <span class="org-kcats-brackets">[[</span>pair <span class="org-kcats-brackets">[[</span>price<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-function-name">unwrap</span> &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span>
  <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
 reduce<span class="org-kcats-brackets">]</span> 
<span class="org-preprocessor">shield</span>

</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Laptop"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>price 1000<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>rating 4.7<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>inStock yes<span class="org-kcats-brackets">]]</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a0eaca" class="outline-2">
<h2 id="org8a0eaca"><span class="section-number-2">3.</span> Benefits</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org9b56a86" class="outline-3">
<h3 id="org9b56a86"><span class="section-number-3">3.1.</span> Easy for beginners</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Kcats is designed to require learning as few concepts as
possible. It's made with:
</p>

<ul class="org-ul">
<li>Stacks</li>
<li>Data values (numbers, strings, bytes)</li>
<li>Lists</li>
<li>Functions</li>
<li>Pipes</li>
</ul>

<p>
All of these are combined in various ways to achieve any type of
expression, the same way a few types of lego bricks can be combined to
make any object.<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>
</p>

<p>
Kcats code is just english words, quotation marks, <code>[</code> and <code>]</code>. No other
symbols. <sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>
</p>

<p>
Format code however you want, kcats doesn't care. 
</p>

<p>
Interactive development is encouraged. The documentation for the
standard library can be queried with the language itself. See
<a href="#org46e5c65">5.3</a>.
</p>
</div>
</div>
<div id="outline-container-org727ffe7" class="outline-3">
<h3 id="org727ffe7"><span class="section-number-3">3.2.</span> Powerful</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Kcats' metaprogramming (programs that write programs) facilities allow
you to express yourself succinctly and without repetition.
</p>
</div>
</div>
<div id="outline-container-orgd8266e4" class="outline-3">
<h3 id="orgd8266e4"><span class="section-number-3">3.3.</span> Excels in the small</h3>
<div class="outline-text-3" id="text-3-3">
<p>
There is zero ceremony. A program can easily be a single line
consisting of a few words:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"contacts.txt"</span> slurp read <span class="org-kcats-brackets">[[</span>age<span class="org-kcats-brackets">]</span> lookup 55 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>  
</pre>
</div>

<p>
That reads a database file of contacts, and prints only those contacts
at least 55 years old. The program is 8 words.
</p>

<p>
You don't need a "main" method, or class declaration or any other
boilerplate.  You only need to specify what the program is actually
supposed to <b>do</b>.
</p>
</div>
</div>
<div id="outline-container-orga36f05f" class="outline-3">
<h3 id="orga36f05f"><span class="section-number-3">3.4.</span> Features</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li class="on"><code>[X]</code> Automatic memory management</li>
<li class="on"><code>[X]</code> Multithreading</li>
<li class="on"><code>[X]</code> Error handling</li>
<li class="on"><code>[X]</code> Metaprogramming</li>
<li class="on"><code>[X]</code> Channels/CSPs</li>
<li class="on"><code>[X]</code> Introspection</li>
<li class="on"><code>[X]</code> Filesystem I/O</li>
<li class="on"><code>[X]</code> TCP/IP Socket I/O</li>
<li class="on"><code>[X]</code> Generators</li>
<li class="on"><code>[X]</code> Sequence library</li>
<li class="on"><code>[X]</code> Cryptographic primitives</li>
<li class="on"><code>[X]</code> Builtin debugging tools</li>
<li class="on"><code>[X]</code> Serialization</li>
</ul>
</div>
</div>
<div id="outline-container-orgf50e1df" class="outline-3">
<h3 id="orgf50e1df"><span class="section-number-3">3.5.</span> Tradeoffs</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Kcats is meant to handle personal automation tasks, where expressivity
and simplicity matter far more than raw performance. It's not
currently suitable for processing huge datasets or high performance
number crunching, and likely never will be.
</p>
</div>
</div>
</div>

<div id="outline-container-org167ada2" class="outline-2">
<h2 id="org167ada2"><span class="section-number-2">4.</span> Getting Started</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgc4594bb" class="outline-3">
<h3 id="orgc4594bb"><span class="section-number-3">4.1.</span> Builds</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org8def008" class="outline-4">
<h4 id="org8def008"><span class="section-number-4">4.1.1.</span> Download pre-built binaries</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
See <a href="https://github.com/skyrod-vactai/kcats/releases">Releases</a>. Binaries currently do not have installers, you will need
to place the executable in a convenient place and <code>chmod</code> it (on mac/linux).
</p>
</div>
</div>
<div id="outline-container-org2a2f555" class="outline-4">
<h4 id="org2a2f555"><span class="section-number-4">4.1.2.</span> Build from source</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
You can skip this section if you're using pre-built binaries described
above.
</p>
</div>
<div id="outline-container-org9960f89" class="outline-5">
<h5 id="org9960f89"><span class="section-number-5">4.1.2.1.</span> Dependencies</h5>
<div class="outline-text-5" id="text-4-1-2-1">
<ul class="org-ul">
<li>emacs</li>
<li>rustc</li>
<li>cargo</li>
</ul>
</div>
</div>
<div id="outline-container-org12e23b8" class="outline-5">
<h5 id="org12e23b8"><span class="section-number-5">4.1.2.2.</span> Creating the source</h5>
<div class="outline-text-5" id="text-4-1-2-2">
<p>
The source is contained within these org files, along with annotations
and other non-code information. To generate the source code (that the
runtime or compiler needs as separate files) before running or
building, run the following command:
</p>

<p>
<code>emacs --batch --load org --load tangle.el</code>
</p>
</div>
</div>
<div id="outline-container-orgdf26daf" class="outline-5">
<h5 id="orgdf26daf"><span class="section-number-5">4.1.2.3.</span> Building</h5>
<div class="outline-text-5" id="text-4-1-2-3">
<p>
See <a href="production.html#MissingReference">Building</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org2aca77c" class="outline-3">
<h3 id="org2aca77c"><span class="section-number-3">4.2.</span> Using</h3>
<div class="outline-text-3" id="text-4-2">
<p>
See <a href="production.html#using">Using</a>
</p>
</div>
</div>
<div id="outline-container-org82a8943" class="outline-3">
<h3 id="org82a8943"><span class="section-number-3">4.3.</span> Developing</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-orge204cde" class="outline-4">
<h4 id="orge204cde"><span class="section-number-4">4.3.1.</span> Browsing the source</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
It can be checked out from git or viewed here: <a href="production.html#source">Production Source</a>
</p>
</div>
</div>
<div id="outline-container-orga752fbf" class="outline-4">
<h4 id="orga752fbf"><span class="section-number-4">4.3.2.</span> Emacs IDE</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
See <code>emacs-ide.org</code> in the source tree for more info.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbde1736" class="outline-2">
<h2 id="orgbde1736"><span class="section-number-2">5.</span> Fundamentals</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org9145568" class="outline-3">
<h3 id="org9145568"><span class="section-number-3">5.1.</span> Key terminology</h3>
<div class="outline-text-3" id="text-5-1">
<dl class="org-dl">
<dt>item</dt><dd>A value.  Includes numbers, strings, byte arrays, words,
characters, and lists. (examples: <code>5</code>, <code>"Bob"</code>, <code>swap</code>, <code>[1 2 3]</code>)</dd>
<dt>list</dt><dd>An item that contains other items, in a particular order
(example: <code>[a "foo" 2]</code>).</dd>
<dt>program</dt><dd>a list of instructions intended to be carried out by a
machine. (example: <code>[[odd?] filter]</code>).</dd>
<dt>stack</dt><dd>A list with a first-in, first-out interface. This is where
the program stores all the data it needs to manipulate.</dd>
<dt>word</dt><dd>causes the program to do something, usually taking some
items from the top of the stack, and using them to create new
stack items. (examples: <code>swap</code>, <code>+</code>, <code>dip</code>)</dd>
<dt>axiom word</dt><dd>A word not defined in terms of other words.</dd>
<dt>definition</dt><dd>what a word is supposed to do, represented either in
the base language for axiom words, or as a program.</dd>
<dt>dictionary</dt><dd>a list of available words and their definitions.</dd>
<dt>environment</dt><dd>the entire state of an executing program, which
generally includes a stack, program, and dictionary.</dd>
<dt>pipe</dt><dd>A conduit to communicate between environments, and to the
outside world. Items are put into pipes and emerge somewhere else
(another environment, a file on disk, a remote machine, etc).</dd>
</dl>
</div>
</div>
<div id="outline-container-orgcb4cb3f" class="outline-3">
<h3 id="orgcb4cb3f"><span class="section-number-3">5.2.</span> The stack</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Kcats is a stack-based language. That means it uses a stack to keep
track of all the values it needs to work with, instead of variables
and function parameters. To manipulate data, you put it onto a stack,
and then words operate on the items at the top of the stack (which
might remove, shuffle, replace, or add new items). If you're familiar
with functions in other languages, that's all words are - they're a
function of the current stack, and they return a new stack.
</p>

<p>
Here's a simple example. If we mentally execute the program below, we
first put <code>1</code> onto the stack. Then we put <code>2</code> onto the stack. <code>2</code> is on top
of <code>1</code>. Then we put the word <code>+</code> onto the stack, where it will consume the <code>2</code>
and the <code>1</code>, and leave their sum, <code>3</code>.
</p>
<div class="org-src-container">
<pre class="src src-kcats">1 2 +
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">3
</pre>
</div>

<p>
Multiple steps are accomplished just by adding more words and
data. For example, in the program below we can add <code>1</code> and <code>2</code> (leaving <code>3</code>
on the stack), and then multiply by <code>5</code>, leaving <code>15</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 + 5 *
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">15
</pre>
</div>

<p>
Here's how it would look step by step (where the <code>|</code> separates the
program that hasn't run yet - on the right, from the stack on the
left). The stack's top item is just to the left of the <code>|</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">stack |  remaining program</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">------|--------------------</span>
         | 1 2 + 5 * 
       1 | 2 + 5 * 
     1 2 | + 5 *
       3 | 5 *
     3 5 | *
      15 |  
</pre>
</div>

<p>
When there is nothing remaining to the right of the <code>|</code>, the program
is finished. The result is what is left on the stack (in this case
<code>15</code>).
</p>

<p>
Note the stack can end up with multiple items. When it's printed, it
will always start with the top of the stack - the last thing in is the
first thing out.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">3 2 1
</pre>
</div>

<p>
Lists are denoted with square brackets, like <code>[1 2 3]</code>. When
encountered, they just go onto the stack as a single unit. Words can
operate on lists once the list is on the stack. You can see below the
word <code>join</code> combines two lists.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org46e5c65" class="outline-3">
<h3 id="org46e5c65"><span class="section-number-3">5.3.</span> Exploring</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-orgcd4a01d" class="outline-4">
<h4 id="orgcd4a01d"><span class="section-number-4">5.3.1.</span> Overview</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
Now that we know the very basics, we can explore and learn as we
go. Kcats lets you treat the standard library (the dictionary) as
data, and you can process it with&#x2026; itself. Documentation is in
there. You just need to know how to ask for it. So here's how you do
it, and you'll understand how exactly it works later.
</p>

<p>
In all the examples in this document, you can run them on the command
line, by running <code>kcats -p</code>, followed by the program in single quotes, like this:
</p>

<pre class="example" id="org6e9a3b8">
kats -p 'dictionary [first] map [] sort'
</pre>

<p>
In case you want to view it in its entirety, the standard library is
part of the source, it lives in <a href="lexicon.html">the lexicon</a> file.
</p>
</div>
</div>
<div id="outline-container-org0c357fb" class="outline-4">
<h4 id="org0c357fb"><span class="section-number-4">5.3.2.</span> What words or functions are available?</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
This program retrieves the dictionary of the starting environment, and
prints just the name of each, sorted in alphabetical order.
</p>
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-kcats-brackets">[]</span> sort
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>* + - / &lt; &lt;= = &gt; &gt;= abs addmethod advance and animate any? assert
 assign association association? attend autoformat bail both both?
 <span class="org-preprocessor">branch</span> break breakpoint bytes bytes? capture ceil <span class="org-builtin">clone</span> close collect
 compare contains? <span class="org-function-name">count</span> cram cut days dec decide decorate decorated
 delegated dictionary <span class="org-preprocessor">dip</span> dipdeep <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">dive</span> divedeep <span class="org-preprocessor">divedown</span> <span class="org-builtin">drop</span>
 dropdeep <span class="org-builtin">dropdown</span> dropper dump each emit empty empty? ends?
 environment error? eval-<span class="org-function-name">step</span> evaluate even? <span class="org-builtin">evert</span> every? <span class="org-preprocessor">execute</span> fail
 file-in file-out <span class="org-function-name">filter</span> <span class="org-function-name">first</span> flip <span class="org-builtin">float</span> fold functional future
 generate generator get group handle handoff hash hours <span class="org-preprocessor">if</span> inc indexed
 <span class="org-preprocessor">inject</span> inspect integers into <span class="org-function-name">join</span> joiner keep key <span class="org-function-name">last</span> let liberate
 lingo list? lookup <span class="org-preprocessor">loop</span> <span class="org-function-name">map</span> max milliseconds min minutes mod
 negative? not number? odd? or pair pipe-in pipe-out pipe? <span class="org-function-name">pop</span>
 positive? prepend prime primrec print <span class="org-function-name">put</span> quot range read receiver
 recover <span class="org-preprocessor">recur</span> redefine rem repeat <span class="org-function-name">rest</span> restore retry <span class="org-function-name">reverse</span> <span class="org-function-name">second</span>
 seconds select sender serversocket set set? <span class="org-preprocessor">shield</span> <span class="org-preprocessor">shielddeep</span>
 <span class="org-preprocessor">shielddown</span> sign <span class="org-builtin">sink</span> siphon sleep slice slurp <span class="org-builtin">snapshot</span> socket
 something?  sort sort-indexed spawn spit split sprint sqrt standard
 starts? <span class="org-function-name">step</span> stepper string string? <span class="org-builtin">swap</span> <span class="org-builtin">swapdown</span> <span class="org-function-name">take</span> taker template
 timer <span class="org-preprocessor">times</span> timestamps toe tos triplet tunnel type unassign <span class="org-preprocessor">until</span>
 <span class="org-function-name">unwrap</span> update value verify when <span class="org-preprocessor">while</span> within? word? <span class="org-function-name">wrap</span> xor yes
 zero? zip<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
Even though the rest of this document will explain a lot of these
words and how they work, the above program does the following:
</p>

<ul class="org-ul">
<li><code>dictionary</code>: retrieves the dictionary and puts it on the stack</li>
<li><code>[first] map</code>: for each item in the dictionary (which is a key/value
pair, where the key is the word and the value is the definition)
take the <code>first</code>, which is the word.</li>
<li><code>[] sort</code>: sort takes a program to transform each item in the list
it's sorting, to use for comparison. We want to use the word itself
for comparison, so we don't need to transform it at all, hence the
empty program.</li>
</ul>
</div>
</div>
<div id="outline-container-orgb44b413" class="outline-4">
<h4 id="orgb44b413"><span class="section-number-4">5.3.3.</span> What inputs/outputs does a particular word have?</h4>
<div class="outline-text-4" id="text-5-3-3">
<p>
The specification of a word's input and output types is stored in the
dictionary too. It's in the property called <code>spec</code>. Let's say you're
interested in the word <code>swap</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> spec<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
What this program does is fetches the dictionary, then looks up the
<code>swap</code> definition, then within that definition, looks up the <code>spec</code> property.
</p>

<p>
In the result, what we have here is two lists - the spec of the
input, and the spec of the output.
</p>

<p>
The input spec is <code>[[item a] [item b]]</code>. The output spec is <code>[[item b]
[item a]]</code>. What it's telling you is that it requires two items on the
stack, any two, we'll call them <code>a</code> (on top) and <code>b</code> beneath. There may be
more items below that but they won't be touched. When swap is
finished, <code>a</code> and <code>b</code> will have their places swapped so that <code>b</code> is on
top. And in fact that's what we get:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"b"</span> <span class="org-string">"a"</span> <span class="org-builtin">swap</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"b"</span> <span class="org-string">"a"</span>
</pre>
</div>

<p>
Remember the top of the stack is printed first, and so <code>b</code> is now on top. 
</p>
</div>
</div>
<div id="outline-container-orge173ca7" class="outline-4">
<h4 id="orge173ca7"><span class="section-number-4">5.3.4.</span> What are some example usages of a word?</h4>
<div class="outline-text-4" id="text-5-3-4">
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> examples<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2<span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
This is a list of examples, and each example is a pair:
</p>

<ul class="org-ul">
<li>A program that calls the given word</li>
<li>A program that doesn't call the word that gives the same result <sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup></li>
</ul>
</div>
</div>
<div id="outline-container-orge943505" class="outline-4">
<h4 id="orge943505"><span class="section-number-4">5.3.5.</span> Continuing exploration</h4>
<div class="outline-text-4" id="text-5-3-5">
<p>
Use the same technique to explore other words. You can simply replace
the word in the code snippets above with some other word.  Here's how
you find the examples for <code>=</code>, which tests for equality of two items -
just replaced <code>swap</code> with <code>=</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span>= examples<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>1 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
 <span class="org-kcats-brackets">[[</span>1 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
 <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[[]]]</span>
   <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[[]]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
   <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"there"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
 <span class="org-kcats-brackets">[[[]</span> yes =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
 <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
   <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
 <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf9a9c0e" class="outline-3">
<h3 id="orgf9a9c0e"><span class="section-number-3">5.4.</span> Data types</h3>
<div class="outline-text-3" id="text-5-4">
</div>
<div id="outline-container-org9cb0813" class="outline-4">
<h4 id="org9cb0813"><span class="section-number-4">5.4.1.</span> Types</h4>
<div class="outline-text-4" id="text-5-4-1">
</div>
<div id="outline-container-org09b4be9" class="outline-5">
<h5 id="org09b4be9"><span class="section-number-5">5.4.1.1.</span> Words</h5>
<div class="outline-text-5" id="text-5-4-1-1">
<p>
In kcats, words can be in the dictionary or not. 
</p>

<p>
The first type, verbs, are used directly in the execution of programs,
like <code>clone</code> and <code>swap</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 <span class="org-builtin">clone</span> 2 <span class="org-builtin">swap</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">1 2 1
</pre>
</div>

<p>
The second type are used inside lists, often as field names. These
words can't be executed (you'll get an error if you try), they're used
more like you'd use strings or keywords in other programming
languages.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>quux<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> <span class="org-function-name">put</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>foo bar baz quux<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
Note the use of <code>unwrap</code> here. What's wrong with just trying to <code>put</code>
<code>quux</code> directly into the list? 
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span> quux <span class="org-function-name">put</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>quux<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>reason <span class="org-string">"word is not defined"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>quux <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
The problem is when kcats encounters a word during execution, it
checks the dictionary to see what to do. If the word isn't isn't in
the dictionary, that's an error. When a word is inside a list, kcats
treats the whole list as an item and doesn't look inside the list.
</p>

<p>
What we want is to get <code>quux</code> onto the stack by itself without actually
executing it. We can do that with <code>[quux] unwrap</code>. The word <code>unwrap</code> does
just what it says, removes the list wrapper and leaves a bare word on
the stack. No error occurs here because the bare word is already on
the stack, it's not part of a program. Another way to go about this is
to use <code>join</code> so we don't need <code>unwrap</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>quux<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>foo bar baz quux<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbed6dc2" class="outline-5">
<h5 id="orgbed6dc2"><span class="section-number-5">5.4.1.2.</span> Booleans</h5>
<div class="outline-text-5" id="text-5-4-1-2">
<p>
Most programming languages have special values <code>true</code> and <code>false</code>. Kcats
does not. In kcats decision making, an empty <a href="#org83044bc">container</a> is negative
(acts like <code>false</code>), and anything else is affirmative (acts like <code>true)</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"yes"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"no"</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"no"</span>
</pre>
</div>
<p>
versus
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"anything"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"yes"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"no"</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"yes"</span>
</pre>
</div>

<p>
But wait, what about this?
</p>

<div class="org-src-container">
<pre class="src src-kcats">3 odd?
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
Some words will return the word <code>yes</code>, but it's not really a boolean,
it's just the word <code>yes</code> which has no special meaning to kcats other
than that it's an arbitrary affirmative value. For convenience, <code>yes</code> is
in the dictionary, so you do not have to quote it. It evaluates to
itself. There is no word <code>no</code>, since it would need special handling to
be negative when every other word is affirmative. Use empty list <code>[]</code> to
mean <code>no</code>.
</p>
</div>
</div>
<div id="outline-container-org6d8d5e0" class="outline-5">
<h5 id="org6d8d5e0"><span class="section-number-5">5.4.1.3.</span> Numbers</h5>
<div class="outline-text-5" id="text-5-4-1-3">
<p>
Integers and floats are supported (64 bit).
</p>

<p>
Supported math operations include <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>mod</code>, <code>rem</code>, <code>min</code>, <code>max</code>, <code>abs</code>,
<code>inc</code>, <code>dec</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>ceil</code>, <code>sqrt</code>, <code>odd?</code>, <code>even?</code>.
</p>
</div>
</div>

<div id="outline-container-org83044bc" class="outline-5">
<h5 id="org83044bc"><span class="section-number-5">5.4.1.4.</span> Containers</h5>
<div class="outline-text-5" id="text-5-4-1-4">
</div>
<ol class="org-ol">
<li><a id="orga521b52"></a>Overview<br />
<div class="outline-text-6" id="text-5-4-1-4-1">
<p>
Containers are types that contain other items. Some containers are
homogenous, for example strings are a container for characters and if
you try to put anything else in it, that's an error. Other containers
can hold any kind of item, for example lists and sets.
</p>
</div>
</li>
<li><a id="orgc896b2a"></a>Lists<br />
<div class="outline-text-6" id="text-5-4-1-4-2">
<p>
Lists are multiple items bound up into a single unit, where their
order is maintained. Lists are heterogenous and can accept any type,
including other lists.
</p>
</div>

<ol class="org-ol">
<li><a id="org5e3befa"></a>Comprehension<br />
<div class="outline-text-8" id="text-5-4-1-4-2-0-1">
<p>
See the word <code>step</code>, which runs the same program on each item in a list.
</p>

<div class="org-src-container">
<pre class="src src-kcats">0 <span class="org-kcats-brackets">[</span>12 6 13 7 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span> 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">43
</pre>
</div>

<p>
Similar to <code>step</code>, but more strict, is <code>map</code>, which only allows the
program to work on a given item and can't mess with the rest of the
stack. Use that to transform each item in a list, in the same way (in
this case showing the remainder when dividing by 5).
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>12 6 13 7 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 mod<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>2 1 3 2 0<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org9b8bc92"></a>Strings<br />
<div class="outline-text-6" id="text-5-4-1-4-3">
<p>
Strings are a container for character types, and work much like in
other programming languages. Most of the functions that work on other
containers will work on strings.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-function-name">count</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">12
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-function-name">first</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">\H
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"Hello World"</span> 0 5 slice
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgf6d44d2"></a>Bytes (byte array)<br />
<div class="outline-text-6" id="text-5-4-1-4-4">
<p>
Byte arrays are a sort of "lowest common denominator" data
format. It's what you use to interact with files or sockets. You can
get byte literals in base64 encoding:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> bytes
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">#b64 <span class="org-string">"SGVsbG8gV29ybGQh"</span>
</pre>
</div>

<p>
and you can treat those byte arrays as lists of integers:
</p>

<div class="org-src-container">
<pre class="src src-kcats">#b64 <span class="org-string">"SGVsbG8gV29ybGQh"</span> <span class="org-function-name">take</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">72 #b64 <span class="org-string">"ZWxsbyBXb3JsZCE="</span>
</pre>
</div>

<p>
72 is the ASCII encoding for <code>H</code>.
</p>
</div>
</li>
<li><a id="orgf2780f8"></a>Associations<br />
<div class="outline-text-6" id="text-5-4-1-4-5">
<p>
An association is made from a list of pairs, like this:
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
However there are some words you can use that make this list behave a
bit differently than a normal list. For example:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[</span>age<span class="org-kcats-brackets">]</span> 25 assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>age 25<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Here we use <code>assign</code> to reset Alice's age - it does not simply add a new
item to the list.  It will find the existing key and replace it. It
will create a new item only if the key didn't already exist:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[</span>department<span class="org-kcats-brackets">]</span> <span class="org-string">"Sales"</span> assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>department <span class="org-string">"Sales"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Notice that the order of the items is not preserved. Once you treat a
list as an association, it "sticks" (see <a href="#org980d388">5.13</a> for details). It
acts like an association from then on, and order is no longer
guaranteed to be maintained.
</p>

<p>
We can improve upon our example that incremented Alice's age
(presumably after her birthday) with the word <code>update</code>. That will run a
program on the item of whatever key (or keys) you specify.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[</span>age<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>age 25<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Note that associations and lists look the same when printed, but
testing them for equality will reveal they are not the same:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[</span>age<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update

<span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 25<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

=
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span>
</pre>
</div>

<p>
Here we are comparing an association with a list. The <code>=</code> operator has
no way of knowing whether you want the list semantics (which does care
about order), or the association semantics (which doesn't care about
order). It defaults to the more strict rules, so they are not equal.
</p>

<p>
The act of using a list as an association (by applying words to it
like <code>assign</code> or <code>update</code>) will convert it to an association, but what if
you just want to convert a list to an association, without doing
anything else?
</p>

<p>
You can use the word <code>association</code> to convert the list to an association:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 24<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[</span>age<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update

<span class="org-kcats-brackets">[[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>age 25<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>favorite-color <span class="org-string">"brown"</span><span class="org-kcats-brackets">]]</span>

association =
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>
</div>
</li>

<li><a id="org7e5a49e"></a>Sets<br />
<div class="outline-text-6" id="text-5-4-1-4-6">
<p>
Sets are made to test for membership, and do not care about order. 
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"Larry"</span> <span class="org-string">"Curly"</span> <span class="org-string">"Moe"</span><span class="org-kcats-brackets">]</span> set <span class="org-string">"Moe"</span> contains?
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
If you add an item to a set, but it's already there, nothing changes.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"Larry"</span> <span class="org-string">"Curly"</span> <span class="org-string">"Moe"</span><span class="org-kcats-brackets">]</span> set <span class="org-string">"Curly"</span> <span class="org-function-name">put</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"Larry"</span> <span class="org-string">"Moe"</span> <span class="org-string">"Curly"</span><span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
You can <code>take</code> from a set but since order doesn't matter, you get an arbitrary item.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 20 1 range set <span class="org-function-name">take</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">15 <span class="org-kcats-brackets">[</span>8 3 18 16 6 13 11 12 4 7 2 10 14 17 19 5 9 1<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org951a52a" class="outline-5">
<h5 id="org951a52a"><span class="section-number-5">5.4.1.5.</span> Errors</h5>
<div class="outline-text-5" id="text-5-4-1-5">
<p>
See <a href="#orgce6b821">5.14</a>
</p>
</div>
</div>
<div id="outline-container-org8af140c" class="outline-5">
<h5 id="org8af140c"><span class="section-number-5">5.4.1.6.</span> Pipes</h5>
<div class="outline-text-5" id="text-5-4-1-6">
<p>
See <a href="#orgb93aa3a">5.17</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orga377943" class="outline-4">
<h4 id="orga377943"><span class="section-number-4">5.4.2.</span> Traits</h4>
<div class="outline-text-4" id="text-5-4-2">
<p>
There are words that operate on multiple types, and it's helpful to
talk about what those types have in common. Specs use these traits to
describe groups of types that a word will accept or produce.
</p>
</div>
<div id="outline-container-org4fd7c28" class="outline-5">
<h5 id="org4fd7c28"><span class="section-number-5">5.4.2.1.</span> Dispenser</h5>
<div class="outline-text-5" id="text-5-4-2-1">
<p>
Containers from which you can take out items, one by
one. Includes:
</p>
<ul class="org-ul">
<li>Strings</li>
<li>Bytes</li>
<li>Lists</li>
<li>Associations</li>
<li>Sets</li>
<li>Out Pipes</li>
<li><p>
Tunnels
</p>

<p>
We can query the dictionary to see what words take a <code>dispenser</code>:
</p></li>
</ul>
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>spec<span class="org-kcats-brackets">]</span> lookup
            <span class="org-function-name">first</span> set <span class="org-kcats-brackets">[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>program dispenser<span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-string">"a"</span><span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item dispenser<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12fca78" class="outline-5">
<h5 id="org12fca78"><span class="section-number-5">5.4.2.2.</span> Receptacle</h5>
<div class="outline-text-5" id="text-5-4-2-2">
<p>
Containers into which you can put items, one by one. Includes:
</p>
<ul class="org-ul">
<li>Strings</li>
<li>Bytes</li>
<li>Lists</li>
<li>Associations</li>
<li>Sets</li>
<li>In Pipes</li>
<li>Tunnels</li>
</ul>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>spec<span class="org-kcats-brackets">]</span> lookup
            <span class="org-function-name">first</span> set <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">put</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> 1 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> bytes 32 <span class="org-function-name">put</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo "</span><span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>item receptacle<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div>

<p>
Supported words:
</p>
<ul class="org-ul">
<li><code>put</code></li>
</ul>
</div>
</div>
<div id="outline-container-org940386c" class="outline-5">
<h5 id="org940386c"><span class="section-number-5">5.4.2.3.</span> Sized</h5>
<div class="outline-text-5" id="text-5-4-2-3">
<p>
Containers whose items can be counted. Includes:
</p>
<ul class="org-ul">
<li>Strings</li>
<li>Bytes</li>
<li>Lists</li>
<li>Associations</li>
<li>Sets</li>
</ul>

<p>
Just list the names of the words that use <code>sized</code> since there's a lot:
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>spec<span class="org-kcats-brackets">]</span> lookup
            <span class="org-function-name">first</span> set <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-kcats-brackets">[]</span> sort
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>get sort-indexed any? assign <span class="org-function-name">count</span> environment every? fail <span class="org-function-name">filter</span> <span class="org-function-name">join</span> lookup <span class="org-function-name">map</span>
 sort<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge76683c" class="outline-5">
<h5 id="orge76683c"><span class="section-number-5">5.4.2.4.</span> Ordered</h5>
<div class="outline-text-5" id="text-5-4-2-4">
<p>
Containers whose items are kept in a specific order. Includes
</p>
<ul class="org-ul">
<li>Strings</li>
<li>Bytes</li>
<li>Lists</li>
</ul>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>spec<span class="org-kcats-brackets">]</span> lookup
            <span class="org-function-name">first</span> set <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]]]</span>
         <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>3 2 1<span class="org-kcats-brackets">]]]]]</span>
           <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-string">"c"</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item ordered<span class="org-kcats-brackets">]]]]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span> <span class="org-kcats-brackets">[[</span>definition builtin-function<span class="org-kcats-brackets">]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>3 4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd6719f7" class="outline-3">
<h3 id="orgd6719f7"><span class="section-number-3">5.5.</span> Stack motion</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Often you have all the data a word needs on the stack, but it's in the
wrong order. There's lots of handy words to help there.
</p>

<dl class="org-dl">
<dt>swap</dt><dd>swap the top two items</dd>
<dt>float</dt><dd>float the 3rd item up to the top</dd>
<dt>sink</dt><dd>sink the top item down to 3rd</dd>
<dt>flip</dt><dd><p>
reverse the top 3 items
</p>

<p>
These words can also be combined with <code>dip</code> and its variants to reach
deeper into the stack.
</p></dd>
</dl>
</div>
</div>
<div id="outline-container-orga1dcb3a" class="outline-3">
<h3 id="orga1dcb3a"><span class="section-number-3">5.6.</span> Cloning and dropping</h3>
<div class="outline-text-3" id="text-5-6">
<p>
When you're done with an item, you can <code>drop</code> it, which eliminates it
from the top of the stack. If you know a word will drop a item you
need afterward, you can <code>clone</code> it.
</p>
</div>
</div>
<div id="outline-container-org4acf772" class="outline-3">
<h3 id="org4acf772"><span class="section-number-3">5.7.</span> Programs that write programs</h3>
<div class="outline-text-3" id="text-5-7">
<p>
The most important expressive feature of kcats is that you can
manipulate programs exactly the same way as you can any other data.
</p>

<p>
One thing you can do with a list, is treat it like a program and
<code>execute</code> it. Notice that on the 5th and 6th line of the execution trace
below, the word <code>execute</code> takes the list from the top of the stack on
the left, and puts its contents back on the right, making it part of
the program remaining to be run!
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;;   </span><span class="org-comment">stack  |  remaining program</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">---------|--------------------</span>
            | 4 5 6 <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span> inc
          4 | 5 6 <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span> inc
        4 5 | 6 <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span> inc
      4 5 6 | <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span> inc
4 5 6 <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> | <span class="org-preprocessor">execute</span> inc
      4 5 6 | * + inc
       4 30 | + inc
         34 | inc
         35 |
</pre>
</div>
<p>
Note that, when <code>* +</code> gets moved back to the program, it went in
<b>front</b> of <code>inc</code>. The program acts just like a stack - the last thing in
is the first thing out.
</p>

<p>
The same way we used <code>join</code> to combine two lists, we can combine two
small programs into one, and then <code>execute</code> it:
</p>

<div class="org-src-container">
<pre class="src src-kcats">4 5 6 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-preprocessor">execute</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">44
</pre>
</div>

<p>
Note that words inside lists don't perform any action when the list is
put on the stack. You can think of it as a quotation - a message being
being passed along, not acted upon.
</p>
</div>
</div>

<div id="outline-container-org72b8129" class="outline-3">
<h3 id="org72b8129"><span class="section-number-3">5.8.</span> Looping and branching</h3>
<div class="outline-text-3" id="text-5-8">
</div>
<div id="outline-container-org9e2d247" class="outline-4">
<h4 id="org9e2d247"><span class="section-number-4">5.8.1.</span> if</h4>
<div class="outline-text-4" id="text-5-8-1">
<p>
<code>if</code> takes 3 programs from the stack:
</p>
<ul class="org-ul">
<li><code>condition</code> a program whose result decides which branch to take</li>
<li>the <code>yes</code> branch</li>
<li>the <code>no</code> branch</li>
</ul>

<p>
An important detail: after <code>condition</code> runs, its stack effects are
erased. The <code>yes</code> or <code>no</code> branch runs on whatever was underneath the 3
programs at the start.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's odd"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's even"</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"it's odd"</span> 3 2 1
</pre>
</div>

<p>
Notice how the <code>3</code> is still there. The word <code>odd?</code> normally consumes its
argument.
</p>
<div class="org-src-container">
<pre class="src src-kcats">3 odd?
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
Here's a more extreme example:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3 <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's odd"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's even"</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"it's even"</span> 3 2 1
</pre>
</div>

<p>
See how we <code>drop</code> the <code>3</code> and test <code>odd?</code> against <code>2</code> instead? Normally we'd
have consumed both the <code>3</code> and the <code>2</code> but the conditional is not allowed
to have any stack effect. See <a href="#org1bd890d">5.11</a>.
</p>
</div>
</div>
<div id="outline-container-orgdeecd4f" class="outline-4">
<h4 id="orgdeecd4f"><span class="section-number-4">5.8.2.</span> loop</h4>
<div class="outline-text-4" id="text-5-8-2">
<p>
Loops take a program to run as the body, and a boolean (See <a href="#orgbed6dc2">5.4.1.2</a>)
condition whether to run the body. If the condition is false, the body
never runs. If it's true, the body runs and <code>loop</code> expects another
boolean condition to be on top to see whether to run the body again.
</p>

<p>
Note that the item on top <b>only</b> determines whether the body runs
again, it's dropped and <b>not</b> accessible to the body program. If the
body needs it, be sure to <code>clone</code> it. Usually it doesn't need that item
for anything except deciding whether to continue the loop, which is
why it's dropped automatically.
</p>

<p>
Here's an example:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 yes <span class="org-kcats-brackets">[</span>2 * <span class="org-builtin">clone</span> 100 &lt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">128
</pre>
</div>

<p>
Notice that <code>loop</code> receives the body program and <code>yes</code> the first
time. The body program never sees <code>yes</code>, only the <code>1</code> underneath it - it
multiplies it by 2, then clones it and checks if it's less
than 100. If so, it drops that boolean value and continues and
multiplies the number beneath by 2 again, and so on, until the number
is greater than or equal to 100. Finally that <code>false</code> value is dropped
and the <code>loop</code> is done, leaving just the final number <code>128</code>.
</p>
</div>
</div>
<div id="outline-container-orgbd9a864" class="outline-4">
<h4 id="orgbd9a864"><span class="section-number-4">5.8.3.</span> while</h4>
<div class="outline-text-4" id="text-5-8-3">
<p>
Kcats also has <code>while</code>, which is a bit higher level than <code>loop</code>. Instead
of expecting a boolean value on top each time through, you provide a
condition program similar to what <code>if</code> requires. <code>while</code> runs the
condition program, if it leaves a affirmative value, the loop
continues. Like <code>loop</code>, <code>while</code>'s body does not have access to the
affirmative value.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 <span class="org-kcats-brackets">[</span>100 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">128
</pre>
</div>

<p>
Like <code>if</code>, the condition program cannot permanently affect the stack. So
we don't need <code>clone</code> like we did with <code>loop</code>. After we compare the number
to 100, it's restored so the body can see it on top.
</p>
</div>
</div>
<div id="outline-container-orgedb8845" class="outline-4">
<h4 id="orgedb8845"><span class="section-number-4">5.8.4.</span> until</h4>
<div class="outline-text-4" id="text-5-8-4">
<p>
It's just like <code>while</code> but with the condition's logic reversed, so that
it stops when the condition is true.
</p>
<div class="org-src-container">
<pre class="src src-kcats">1 <span class="org-kcats-brackets">[</span>100 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">128
</pre>
</div>

<p>
Unlike <code>while</code> (which runs the body 0 or more times), <code>until</code> will always
run it at least once.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">2
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7d9196e" class="outline-3">
<h3 id="org7d9196e"><span class="section-number-3">5.9.</span> Argument order</h3>
<div class="outline-text-3" id="text-5-9">
<p>
Kcats stack-based nature can take a little getting used to, and the
reversing of the order you wrote something is perhaps the biggest
stumbling block.
</p>

<p>
Notice how <code>if</code> is designed to have the
conditional/true/false branch in the order you expect when you write
code. However remember if you print the stack the order will be
reversed - the <code>false</code> program will be on top, followed by the <code>true</code>
program, followed by the <code>conditional</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3 <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's odd"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's even"</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if </span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"it's even"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it's odd"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> odd?<span class="org-kcats-brackets">]</span> 3 2 1
</pre>
</div>

<p>
This is a common theme in kcats, where argument order is designed to
make the code readable - if a word takes multiple arguments, and the
order matters, the "first" logical argument is not the top of the
stack. Here's an example:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 &lt;
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
When we write <code>1 2 &lt;</code> we mean "1 is less than 2". Even though the top
of the stack is 2, we don't consider 2 the "first" argument.
</p>
</div>
</div>
<div id="outline-container-org606a84f" class="outline-3">
<h3 id="org606a84f"><span class="section-number-3">5.10.</span> Item hiding</h3>
<div class="outline-text-3" id="text-5-10">
<p>
Sometimes you have a program that you don't trust with a certain stack
item. Perhaps there's a password on the stack, and you're running an
untrusted program given to you by someone else.
</p>

<p>
What if there was a way to hide that password behind your back such
that the program never even knew it was there, and then restore it
after the untrusted program was finished?
</p>

<p>
<code>dip</code> takes an item on the top of the stack, and a program. It
temporarily hides the item, and runs the program. After the program is
done, it puts the item back on the stack.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 <span class="org-string">"mypassword"</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"mypassword"</span> 3
</pre>
</div>

<p>
Notice the addition program could not access the password even if it
tried. It isn't on the stack while it's executing, it's hidden away
elsewhere in the runtime, temporarily.
</p>

<p>
<code>dip</code> is very common in kcats, and it's used mostly in cases where you
don't actually care if a program reads a item, you just want the
item out of the way temporarily, and it's easier than finicky
swapping. However in cases where there is a trust issue, no amount of
swapping can fix the problem and you definitely should reach for <code>dip</code>.
</p>
</div>
</div>

<div id="outline-container-org1bd890d" class="outline-3">
<h3 id="org1bd890d"><span class="section-number-3">5.11.</span> Stack effect control</h3>
<div class="outline-text-3" id="text-5-11">
<p>
Kcats provides some facilities to let you avoid tedious cloning of
items to keep from losing them. Most words consume items from the
stack to produce new items. Sometimes you'll still need those old
items again later.
</p>

<p>
We saw earlier how <code>if</code> runs a condition program, and no matter how
badly that program messes with the stack, that effect is wiped clean
and only the top result of that program remains.
</p>

<p>
That magic is not locked away inside <code>if</code> - you can use it in your own
programs.
</p>

<p>
Earlier we showed how to examine the dictionary. Here's how you see
the definition of <code>if</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-preprocessor">if</span> definition<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
<code>if</code> runs the condition program with <code>shield</code>. <code>shield</code> runs the given
program, takes the top item and places it on top of the <b>original</b> stack
(before the program ran). Let's look at the first example of <code>shield</code> -
remember each example shows two programs that produce the same result.
</p>

<p>
Here's how we view the first example of <code>shield</code>.
</p>
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> examples<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<p>
Here we're checking whether <code>2</code> and <code>3</code> are equal without consuming
anything.
</p>

<p>
Here's what it would look like without <code>shield</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3 =
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> 1
</pre>
</div>

<p>
The <code>2</code> and <code>3</code> are consumed, leaving only the empty list to signal the
negative condition.
</p>
</div>
</div>
<div id="outline-container-org79b5978" class="outline-3">
<h3 id="org79b5978"><span class="section-number-3">5.12.</span> 'down' and 'deep' variants</h3>
<div class="outline-text-3" id="text-5-12">
<p>
There are words like <code>dipdown</code>, <code>shielddown</code>, <code>swapdown</code>, <code>dropdown</code>,
<code>divedown</code>. What are those?
</p>

<p>
It's a modification of the original where the effect is one stack
element further down from the original. What exactly is further down,
depends on the word.
</p>

<dl class="org-dl">
<dt>swapdown</dt><dd>swap not the top two items, but the 2nd and 3rd items</dd>
<dt>dipdown</dt><dd>hide not the top stack item, but the top two items</dd>
<dt>shielddown</dt><dd>protect not the whole stack, but everything except the
top item.</dd>
<dt>dropdown</dt><dd>drops the 2nd item</dd>
<dt>divedown</dt><dd>hides the top two items but then floats the result back
to the top above the previously hidden items</dd>
</dl>

<p>
Similarly the <code>deep</code> variants are one level even deeper than that:
</p>

<dl class="org-dl">
<dt>swapdeep</dt><dd>swap the 3rd and 4th items</dd>
<dt>dipdeep</dt><dd>hide the top 3 items</dd>
<dt>shielddeep</dt><dd>protect all but the top two item</dd>
<dt>dropdeep</dt><dd>drops the 3rd item</dd>
</dl>
</div>
</div>
<div id="outline-container-org980d388" class="outline-3">
<h3 id="org980d388"><span class="section-number-3">5.13.</span> Promotion</h3>
<div class="outline-text-3" id="text-5-13">
<p>
Data types are automatically converted when needed.
</p>

<p>
For example, if you have a list of pairs and you use the word <code>lookup</code>,
it assumes your intention is to use the list as an associative data
type, so it will be automatically converted, and remain converted
after <code>lookup</code> completes.
</p>

<p>
You can tell by the spec when the return type is a promoted type:
</p>
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span>assign spec<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>item value<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span>
  sized<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Here you can see that the spec for <code>assign</code> takes a <code>sized</code> and returns an
<code>association</code>. This allows you to do things like this:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>name <span class="org-string">"Susie"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>age 25<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>sport<span class="org-kcats-brackets">]</span> <span class="org-string">"bowling"</span> assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>age 25<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>name <span class="org-string">"Susie"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>sport <span class="org-string">"bowling"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
The initial value of <code>[[name "Susie"] [age 25]]</code> is not an <code>associative</code>,
it's just a <code>list</code>. You could explicitly convert it using the word
<code>association</code> but <code>assign</code> will do it for you, because it needs an
associative type.
</p>

<p>
Note that the conversion can fail, because converting to <code>associative</code>
requires that you have a list of pairs. If you don't, that's an error:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>age<span class="org-kcats-brackets">]</span> 25 assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>unwound <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>reason <span class="org-string">"type mismatch"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>actual <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
The most common promotion is from <code>list</code> to <code>associative</code> but there are
others.
</p>
</div>
</div>
<div id="outline-container-orgce6b821" class="outline-3">
<h3 id="orgce6b821"><span class="section-number-3">5.14.</span> Error handling</h3>
<div class="outline-text-3" id="text-5-14">
<p>
In kcats, when a program encounters an error, an error item is
placed on the stack instead of the usual result.
</p>

<div class="org-src-container">
<pre class="src src-kcats">2 3 <span class="org-string">"four"</span> * + 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>unwound <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>reason <span class="org-string">"type mismatch"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>actual <span class="org-string">"four"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span> <span class="org-string">"four"</span> 3 2
</pre>
</div>

<p>
Notice the <code>unwound</code> field contains the rest of the program that
remained when the error occurred.
</p>

<p>
We can fix the problem and continue, but only if we can stop the
unwinding before our entire program is unwound. We can do that using
the word <code>recover</code>, which takes two programs: <code>p</code> and <code>r</code>, <code>p</code> is run and if
it results in an error, the unwinding is limited to <code>p</code> and then <code>r</code> is
run. When <code>r</code> runs, the error item is on the top of stack. If there is no
error, <code>r</code> does not run.
</p>

<p>
In the program below, we recover by discarding the error and the
string "four", and replacing it with the number <code>4</code>. Then trying the
operations <code>* +</code> again.
</p>
<div class="org-src-container">
<pre class="src src-kcats">2 3 <span class="org-string">"four"</span> <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> 4 * +<span class="org-kcats-brackets">]</span> recover
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">14
</pre>
</div>

<p>
The problem with the usage of <code>recover</code> above is that we had to specify
the arithmetic words <code>* +</code> twice - once in <code>p</code> and again in <code>r</code> in case they
failed the first time. Remember those operations are saved in the
<code>unwound</code> field of the error, and we can access them and even <code>execute</code>
them. There is a word that does this for you: <code>retry</code>: it takes an error
on the top of stack, and executes its <code>unwound</code> program.
</p>

<div class="org-src-container">
<pre class="src src-kcats">2 3 <span class="org-string">"four"</span> <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">drop</span> 4<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> retry<span class="org-kcats-brackets">]</span> recover
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">14
</pre>
</div>

<p>
In the above program, after the error occurs, we discard the string
underneath the error and replace it with the integer <code>4</code>.
</p>

<p>
Sometimes you need to raise your own errors, you can do that with the
word <code>fail</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats">2
<span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span><span class="org-string">"ok"</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[[</span>type error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>asked odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>reason <span class="org-string">"expected odd number"</span><span class="org-kcats-brackets">]]</span>
 association fail<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">if</span>
3 4 +
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>asked odd?<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>reason <span class="org-string">"expected odd number"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>3 4 +<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span> 2
</pre>
</div>

<p>
Sometimes you want to handle some errors but not others. There's no
error type matching like you'd find with java's <code>catch</code>. You have to
recover, examine the error, and if it's one you don't want to handle,
re-activate it with <code>fail</code>.
</p>
</div>
</div>
<div id="outline-container-org06556fb" class="outline-3">
<h3 id="org06556fb"><span class="section-number-3">5.15.</span> Your own words</h3>
<div class="outline-text-3" id="text-5-15">
<p>
You're not stuck with just the vocabulary in the starting
environment. You can make your own words!
</p>

<p>
You can alter the dictionary however you want, but it's a best
practice to limit the scope of those changes to a particular
program. <code>lingo</code> is a word that executes a program with an altered
dictionary (and then restores the original dictionary):
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>square<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> *<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]]</span>
 assign<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>9 square<span class="org-kcats-brackets">]</span>
lingo
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">81
</pre>
</div>

<p>
So what's happening here? <code>lingo</code> takes two programs. The first alters
the dictionary (it can expect the environment's current dictionary to
be on top when it's called). In this case it's <code>assign</code> ing <code>square</code> to
the given definition <code>[clone * ]</code>. The second program is the program you
want to run that uses the altered dictionary <code>[9 square]</code>.
</p>

<p>
Note that you can do whatever you want - you can alias <code>+</code> to <code>-</code> (not
advisable, but you can), you can remove <code>lingo</code> from the dictionary so
your program can't define any of its own new words, etc.
</p>

<p>
Also note that it is possible, and encouraged, to nest calls to <code>lingo</code>
so that only the sections of code that actually need a particular
alteration are using it. All library code should be loaded with <code>lingo</code>. <sup><a id="fnr.2.100" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>
</p>

<p>
If you really want to permanently alter the dictionary, you can do
that too, with <code>redefine</code>, which takes a dictionary (presumably that
you've modified) and replaces the environment's dictionary with that
one.
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary
<span class="org-kcats-brackets">[</span>square<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> *<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]]</span>
assign
redefine
9 square
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">81
</pre>
</div>
</div>
</div>
<div id="outline-container-org03a09fb" class="outline-3">
<h3 id="org03a09fb"><span class="section-number-3">5.16.</span> Generators</h3>
<div class="outline-text-3" id="text-5-16">
</div>
<div id="outline-container-org799e8c8" class="outline-4">
<h4 id="org799e8c8"><span class="section-number-4">5.16.1.</span> Overview</h4>
<div class="outline-text-4" id="text-5-16-1">
<p>
Sometimes in programming, having the concept of an indefinite sequence
is handy. You have part of your program producing data, and another
consuming it, but the producer doesn't know how much the consumer will
actually need. A producer might calculate a huge number of items at
great expense, only for the consumer to only need a tiny fraction of
them. Generators allow the consumer to tell the producer when to
produce, but the producer still retains all the logic of how that's done.
</p>

<p>
In kcats there's no special sauce for generators, we can implement
them as a pattern with just the standard words we've already seen.
</p>
</div>
</div>
<div id="outline-container-org0da8607" class="outline-4">
<h4 id="org0da8607"><span class="section-number-4">5.16.2.</span> Example</h4>
<div class="outline-text-4" id="text-5-16-2">
<p>
Let's say you want to create the fibonacci sequence. Let's see how we
can code that without worrying about how many items in the sequence
we'll eventually need.
</p>

<p>
A generator consists of two things: state, and a program. Each time
we want to generate an item, we run the program. The program should
produce a new item and update the state. We just put however many
state items we need on the stack, and then a program that can work
with those items.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
So here we start with <code>1 0</code>. That's the starting state. Normally we'd
start fibonacci with <code>1 1</code> but this isn't the actual first two numbers
in the sequence, it's starting values we use to calculate them. Then
we have a program that takes two numbers as input and leaves one new
number. Let's just <code>execute</code> that program and see the result:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">1 1 1
</pre>
</div>

<p>
We can see the <code>0</code> is now <code>1</code> and there's an extra <code>1</code> on the
stack. Remember the generator must do two things, produce a new item
and update the state. It updated the state from <code>0 1</code> to <code>1 1</code>, and
produced the first item, <code>1</code>.
</p>

<p>
This gets us one number, but not the whole fibonacci sequence. Let's
look at the word <code>generate</code>. All it does is run the program, pulls the
generated item to the top of the stack, and puts a new copy of the
program in place so that when we want the next item, we can call
<code>generate</code> again:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> generate
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">1 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 1 1
</pre>
</div>

<p>
Notice here that the only difference from before is that the program
is sandwiched between the fibonacci number we produced, and the state.
</p>

<p>
Let's keep going and call generate again! But wait, before we do that
we need to do something with item we just produced, to get it out of
the way. For now we'll just <code>drop</code> it. We've seen it and we want to
see what's next.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> generate <span class="org-comment-delimiter">;; </span><span class="org-comment">what we had before</span>
<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">throw away the first item</span>
generate <span class="org-comment-delimiter">;; </span><span class="org-comment">the 2nd item</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">1 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 1 2
</pre>
</div>

<p>
Ok, so the 2nd item is <code>1</code> and we can see the state is updated -
instead of <code>1 1</code> we have <code>1 2</code>.
</p>

<p>
One more time:
</p>
<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">generate and drop the first two items</span>
generate <span class="org-comment-delimiter">;; </span><span class="org-comment">the 3rd item</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">2 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 2 3
</pre>
</div>

<p>
Ok we can see that we can get items one at a time by calling
<code>generate</code>, but this is not very useful. What we really want is to get
the first <code>20</code> numbers in the fibonacci sequence, and collect them into a
list. We can do exactly that:
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">our original generator</span>
20 taker <span class="org-comment-delimiter">;; </span><span class="org-comment">another generator that stops generating after 20 items</span>
collect <span class="org-comment-delimiter">;; </span><span class="org-comment">collects all the generated items into a list</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 6765 10946
</pre>
</div>

<p>
There's the fibonacci sequence! Hey wait, what's all that stuff after
it?  We just want fibonacci! That's there in case you wanted to keep
generating more items. If you want to just get the result and throw
away the generators, you can do that with <code>shield</code>, which erases all
stack effects except whatever was on top. So we'll just <code>shield</code> the
entire thing:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
 20 taker
 collect<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
So what is happening here? We're stacking up generators. Starting with
the last, we have <code>collect</code> which will repeatedly call <code>generate</code> on the
generator below it. It keeps going and collecting the generated items
in a list, until the generator below returns <code>nothing</code>. Then it stops
and returns what it collected.
</p>

<p>
Then below <code>collect</code> we have a generator <code>20 taker</code> - what that does is
keeps its own state of how many items we want it to take. It counts
down as it generates items below it, passing them up to <code>collect</code> and
when it hits zero, it returns <code>nothing</code> (even if the generator below it
would have produced something, <code>taker</code> won't even ask). That will signal
<code>collect</code> to stop.
</p>

<p>
We have other handy generators we can stack up. Let's say for whatever
reason we want to know what are the first 20 <b>odd</b> fibonacci numbers?
Well, we have <code>keep</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">our original generator</span>
<span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> keep <span class="org-comment-delimiter">;; </span><span class="org-comment">a generator that keeps calling the one</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">below it until it gets something that</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">passes the predicate we specified</span>
20 taker <span class="org-comment-delimiter">;; </span><span class="org-comment">another generator that calls generate 20 times</span>
collect<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">collects all the generated items into a list</span>
<span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 3 5 13 21 55 89 233 377 987 1597 4181 6765 17711 28657 75025 121393 317811 514229<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
There it is, the first 20 <b>odd</b> fibonacci numbers!
</p>

<p>
Let's say instead we wanted to know the prime factors that make up
each of the first 20 fibonacci numbers. We can do that with <code>each</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">our original generator</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">a program to give the prime factors of a given number</span>
 <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> 2 <span class="org-comment-delimiter">;;  </span><span class="org-comment">current-divisor input result</span>
  <span class="org-kcats-brackets">[[</span>sqrt<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &gt;=<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[</span>mod zero?<span class="org-kcats-brackets">]</span> 
   <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d c-d i r</span>
    <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d i c-d r</span>
    <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d i new-r</span>
    / 2<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">dividend new-r</span>
   <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d++ i r</span>
   <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span>
  <span class="org-builtin">drop</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span>
 each

 20 taker <span class="org-comment-delimiter">;; </span><span class="org-comment">another generator that calls generate 20 times</span>
 collect<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">collects all the generated items into a list</span>
<span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>13<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 17<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 11<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>89<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 2 2 3 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>233<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>13 29<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>2 5 61<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 7 47<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1597<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 2 17 19<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>37 113<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>3 5 11 41<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
There we have it. We can see that <code>[2 2 2]</code> is what makes up <code>8</code>, etc.
</p>

<p>
Other included generators are:
</p>

<dl class="org-dl">
<dt>dropper</dt><dd>Inverse of <code>taker</code> - drops the first n items of the
sequence and returns the rest.</dd>
<dt>joiner</dt><dd>Joins items together</dd>
<dt>integers</dt><dd>all the numbers starting with 0</dd>
</dl>

<p>
<code>reduce</code> will consume what a generator produces. You provide a program
that takes 2 arguments, and <code>reduce</code> will generate all the items, and
pass to your program: the result so far and the next item generated,
and repeat that until there are no items left:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>integers
 1 dropper <span class="org-comment-delimiter">;; </span><span class="org-comment">drop 0 so we start with 1</span>
 10 taker
 <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> each
 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> reduce<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">135
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc8e3939" class="outline-4">
<h4 id="orgc8e3939"><span class="section-number-4">5.16.3.</span> Compatibility</h4>
<div class="outline-text-4" id="text-5-16-3">
<p>
Let's say you go to the trouble of making a beautiful stack of
transformations and you want to re-use it, but you don't have a
generator, you have a list! Our transformation stack needs a
<b>generator</b>! How are we supposed to use it?  Never fear, there is a
simple way to adapt transformations to work on anything that works
with the word <code>take</code>. You can use the word <code>liberate</code> to convert a list to
a generator. (It's just an alias for <code>[take]</code> which is even shorter than
<code>liberate</code> so feel free to just use <code>[take]</code>).
</p>

<p>
Do you see why <code>[take]</code> converts a list to a generator? Remember,
generators are a state and a program. If we already have a list or
pipe, we can just treat that as the state. And <code>[take]</code> as the program
does exactly what we want, removes an item from the list and returns
it, leaving the state with one fewer item.
</p>
</div>
</div>
<div id="outline-container-org485a8bc" class="outline-4">
<h4 id="org485a8bc"><span class="section-number-4">5.16.4.</span> Capturing items from the stack</h4>
<div class="outline-text-4" id="text-5-16-4">
<p>
One pitfall with generators is that sometimes you want to transform
generated items and use some item from the stack to help do it. The
problem with this is that generators can be arbitrarily deep and you
won't know exactly how deep that item is.
</p>

<p>
The solution is to <code>capture</code> the items you want.
</p>

<p>
Let's look at a simple example. Let's say we want to generate every
multiple of n (where n is some number on the stack). We can already
generate every integer, we just need to multiply each one by n. A naive
solution would be to just use <code>each</code>, but it doesn't work:
</p>

<div class="org-src-container">
<pre class="src src-kcats">3 integers
<span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> each
1 dropper <span class="org-comment-delimiter">;; </span><span class="org-comment">drop 0</span>
10 taker collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>reason <span class="org-string">"type mismatch"</span><span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[[</span>0 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
               0 3<span class="org-kcats-brackets">]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-builtin">dropdown</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                                                   <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> dec <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                                                                                                                    <span class="org-preprocessor">dip</span> dec <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
           <span class="org-preprocessor">loop</span> <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
           <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span>
           <span class="org-kcats-brackets">[[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                           <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
              <span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
              <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
             bail<span class="org-kcats-brackets">]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>9<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
           <span class="org-function-name">unwrap</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>actual <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span>
0 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
0 3
</pre>
</div>

<p>
This doesn't work because n and the last integer we generated aren't
next to each other on the stack, there's a bunch of generator
machinery in between. We could try to guess exactly how deep the
machinery is, but then our generators aren't composable anymore - we
couldn't move that call to <code>each</code> somewhere else in the generator stack,
without having to change the program. What we really should do is
create our program for <code>each</code> first, before we start stacking up
generators, and <code>bind</code> n:
</p>

<div class="org-src-container">
<pre class="src src-kcats">3 
<span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> bind
<span class="org-kcats-brackets">[</span>integers<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">insert the integers generator below the each program</span>
each
1 dropper
10 taker collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>3 6 9 12 15 18 21 24 27 30<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> 0 <span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                                                             <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
                                                <span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                                                <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
                                               bail<span class="org-kcats-brackets">]</span>
0 <span class="org-kcats-brackets">[</span>generate <span class="org-kcats-brackets">[[</span>3 *<span class="org-kcats-brackets">]</span>
             bail<span class="org-kcats-brackets">]</span>
   <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
10
</pre>
</div>

<p>
What exactly is this doing? We're taking values from the current
stack, and prepending them to a program, so that later when the
program executes, it'll find that value on the top of the stack. Put
another way, we're <b>binding</b> the value of the first argument to the
program now, rather than letting it take a value from the top of the
stack later.
</p>
</div>
</div>
</div>
<div id="outline-container-orgb93aa3a" class="outline-3">
<h3 id="orgb93aa3a"><span class="section-number-3">5.17.</span> Coordination and Input/Output</h3>
<div class="outline-text-3" id="text-5-17">
</div>
<div id="outline-container-org3efc9ff" class="outline-4">
<h4 id="org3efc9ff"><span class="section-number-4">5.17.1.</span> Basics</h4>
<div class="outline-text-4" id="text-5-17-1">
<p>
In kcats, both coordination and input/output are done with <code>pipes</code>. See
the <a href="#org9145568">definition</a> for pipe.
</p>

<p>
Let's take a common example of coordination. Your program has to do
several very long and intensive calculations but doesn't want to make
the user wait to do other things. The way that's done in kcats is by
creating multiple environments, and have them communicate with each
other using pipes. You can send any item through a pipe that you
could put onto the stack, including other pipes. You can <code>clone</code> a pipe
to give access to it to more than one environment.
</p>

<p>
There are two main operations a pipe supports: <code>put</code> and <code>take</code>. You
either put an item in, or take an item out. Either one of those
operations may <b>block</b>, if the pipe is either full (when putting) or
empty (when taking). Your environment would have to wait for some
other environment to take something out so there's space to put, or
put something in so that there's something to take out.
</p>

<p>
All pipes share the <code>put</code> and <code>take</code> operations but they can differ in
other ways. 
</p>

<p>
Note that <code>put</code> and <code>take</code> can also be used on plain lists. <code>put</code> adds to
the end, and <code>take</code> removes the first item. Neither will ever block when
used on a list. Another slight difference is what happens when you've
reached the end of the content (either the list is empty or the pipe
has, for example, hit the end of file condition): a <code>take</code> from an empty
list will just return <code>nothing</code>, but a <code>take</code> from a pipe that is at EOF
will result in an error.
</p>
</div>
</div>

<div id="outline-container-orgb0040f6" class="outline-4">
<h4 id="orgb0040f6"><span class="section-number-4">5.17.2.</span> Input/output</h4>
<div class="outline-text-4" id="text-5-17-2">
<p>
Let's look at how we do I/O using files as an example - let's say we
want to write the word <code>foo</code> to a file called <code>bar</code>:
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> pipe-in <span class="org-comment-delimiter">;; </span><span class="org-comment">create the pipe to the given file "foo"</span>
<span class="org-string">"foo"</span> bytes <span class="org-comment-delimiter">;; </span><span class="org-comment">we have to convert string to bytes first, using the word</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">=bytes=.</span>
<span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">finally, put the bytes into the pipe, and they are written to</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">the file</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>to <span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>type tunnel<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>values <span class="org-kcats-brackets">[[</span>type bytes<span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
Note the representation of the pipe shows where it leads (the <code>to</code>
field), and what types of items it can carry (the <code>values</code> field).
</p>

<p>
Neither <code>put</code> nor <code>take</code> consume the pipe from the stack,
for convenience, as most of the time you'll want to use it again.
</p>

<p>
Let's look at reading from a file:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> pipe-out
<span class="org-function-name">take</span> string
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-kcats-brackets">[[</span>type tunnel<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>values <span class="org-kcats-brackets">[[</span>type bytes<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>to <span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
Note that the amount of bytes you'll get from a file on each take, is
limited. You will only get the entire contents if the file is
small. We'll want to repeatedly <code>take</code> until there's nothing left, and
put all the taken parts together.
</p>

<p>
Here's how we do it:
</p>
<ul class="org-ul">
<li>turn the pipe that provides chunks of a file into a <a href="#org03a09fb">generator</a>, with <code>[take]</code>.</li>
<li>Assemble the chunks with <code>reduce</code>. It requires a program to say how to
combine the chunks. We want to <code>join</code> them, so the program is <code>[join]</code>.</li>
</ul>

<p>
We can also use the word <code>file-out</code> as a shortcut to get a pipe given a
file's name.
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"bar"</span> file-out <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> reduce string
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>type tunnel<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>values <span class="org-kcats-brackets">[[</span>type bytes<span class="org-kcats-brackets">]]]</span>
                       <span class="org-kcats-brackets">[</span>to <span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
Finally there's a convenient alias for <code>[take] [join] reduce string</code>, it's called <code>slurp</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-kcats-brackets">[</span>slurp<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> reduce string <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
              <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
It actually drops the generator for you as well, since we know it's already
been fully read from. So you can do this:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"bar"</span> file-out slurp
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5abbb21" class="outline-4">
<h4 id="org5abbb21"><span class="section-number-4">5.17.3.</span> Coordination of simultaneous programs</h4>
<div class="outline-text-4" id="text-5-17-3">
</div>
<div id="outline-container-org716927b" class="outline-5">
<h5 id="org716927b"><span class="section-number-5">5.17.3.1.</span> Basics</h5>
<div class="outline-text-5" id="text-5-17-3-1">
<p>
The way kcats handles parallel processing (aka multithreading) is by
allowing you to create multiple environments, each with their own
programs, that run simultaneously.
</p>

<p>
Often you need the environments to communicate with each other, and
not just with the outside world. That's done with channels. Channels
let you send items from one environment to another.
</p>
</div>
</div>
<div id="outline-container-org318d431" class="outline-5">
<h5 id="org318d431"><span class="section-number-5">5.17.3.2.</span> Channels</h5>
<div class="outline-text-5" id="text-5-17-3-2">
<p>
Channels are a type of pipe. They are different from other pipes, like
files or network sockets, in that while files and sockets only deal
with bytes, channels can pass any kind of item (numbers, strings,
words, lists, and even other pipes). If you can put an item on the
stack, you can also pass it through a channel.
</p>
</div>
<ol class="org-ol">
<li><a id="org57e9598"></a>Handoff<br />
<div class="outline-text-6" id="text-5-17-3-2-1">
<p>
This is the most common type of channel. Think of it as a pipe with no
length or capacity. It's more like a hole in a wall, than an actual
pipe. You can pass items through the hole, but only if someone is
already on the other side waiting to take it. If your program tries to
pass an item through the handoff, but no other program running
simultaneously is already waiting to take it, your program will
<b>block</b>. That means it stops and waits. The same goes for receiving
items - if your program tries to receive but no one is sending yet,
your program will wait until someone sends. Handoffs support multiple
senders and receivers through the same "hole" - imagine multiple
people standing on either side of the wall, holding items they need to
pass through, and others empty handed waiting to receive. Only one
person can receive per send - it's a direct handoff and not a
broadcast.
</p>

<p>
You pass items from one environment to another by giving both
environments a copy of the handoff pipe. One environment calls <code>put</code>
(with an item) and the other calls <code>take</code>. If they're doing that at the
same time, the item moves from one environment to the other and both
the <code>put</code> and <code>take</code> complete at the same time.
</p>

<p>
You can pass as many items through the handoff as you want.
</p>
</div>
</li>
<li><a id="orgde12fab"></a>Buffered<br />
<div class="outline-text-6" id="text-5-17-3-2-2">
<p>
This channel works similarly to a Handoff, but instead of having no
capacity, it has a fixed capacity that you specify when you create
it. Let's say you give it a capacity of 10. That means the sender can
put 10 items in, even when no one is receiving yet. On the 11th item,
sending will block just like a handoff would.
</p>

<p>
If a receiver takes an item out, that frees up space for one more item
that the sender can put in without blocking.
</p>
</div>
</li>
<li><a id="orgb2103ca"></a>Signaling when you're done<br />
<div class="outline-text-6" id="text-5-17-3-2-3">
<p>
It's common for a program to keep taking from a pipe until there's
nothing left to take, and then stop. How does it know there's nothing
left (in other words, nothing more will ever arrive, no matter how
long it waits)? With channels there's 2 ways to know:
</p>

<ul class="org-ul">
<li>One of the senders sends the item <code>nothing</code>. All the standard library
words that pull from a channel repeatedly, will stop when they
receive <code>nothing</code>.</li>
<li>All the senders copies of the channel are dropped.</li>
</ul>

<p>
How is a sender dropped? That can happen several ways:
</p>

<ul class="org-ul">
<li>The channel item is dropped from the stack with the word <code>drop</code> or
its variants, or otherwise consumed.</li>
<li>The entire environment is dropped (as often happens when its program
is finished)</li>
<li>A program receives on this copy of the channel. By default, channels
are one direction only. As soon as you send, the receiver is
dropped, and vice versa. Bidirectional channels (where the same
program can send and receive on the same channel) are possible but
currently not supported because they take a bit more care to use
properly.</li>
</ul>

<p>
When writing a program that needs to know about the end of a stream,
you must take care to not leave extra copies of channels lying
around. Any extra channel copy that you don't <code>drop</code> when finished, will
keep the stream open forever and will result in a <b>deadlock</b>. A deadlock
is when some program is waiting for a condition that can never
occur. In this case, a receiver is waiting for the end of the stream,
and it will never get it. The primary symptom of a deadlock is a
program that appears to be stuck or doing nothing, doesn't produce the
intended result, doesn't produce an error, and doesn't exit.
</p>

<p>
Note that it's also possible for receivers to signal they have
everything they want, by dropping their copy of the channel. After all
receivers are dropped, all senders will get errors when they try to
send.
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org78f15e7" class="outline-5">
<h5 id="org78f15e7"><span class="section-number-5">5.17.3.3.</span> Multiple environments</h5>
<div class="outline-text-5" id="text-5-17-3-3">
<p>
Parallel processing is done with multiple environments running
simultaneously, but how exactly do we set that up? And how do we
enable them to communicate with each other? How do we create two
environments with a copy of the same channel, so one can send and the
other receive?
</p>

<p>
One handy way is to use the word <code>spawn</code>. It takes a program and creates
a new environment, such that its program is the given program and the
stack is a copy of the current environment's stack. That way, you end
up with two environments, with different programs but the same stack.
</p>

<p>
Once the new environment is created, it doesn't actually do anything,
it's just another item inside the current environment. To make it
actually run the program, we need to <code>animate</code> it. At that point it
disappears from this environment and goes off on its own.
</p>

<div class="org-src-container">
<pre class="src src-kcats">handoff <span class="org-kcats-brackets">[</span>5 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> spawn animate <span class="org-function-name">take</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">5 <span class="org-kcats-brackets">[[</span>type out<span class="org-kcats-brackets">]</span>
   <span class="org-kcats-brackets">[</span>handoff 0<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Here we create a handoff, and then create a new environment that
inherits that handoff in its stack. That new environment will <code>put</code> the
number <code>5</code> into the channel. Then we call <code>take</code> on the other copy of the
channel to receive the number <code>5</code>.
</p>

<p>
Note that when you <code>animate</code> a new environment, you can't debug it using
the same debugging tools we saw earlier. You actually lose all contact
with it, except for whatever pipe communication you program it to
do. Debugging simultaneous programs is a bit more involved and this
will be covered later.
</p>
</div>
</div>
<div id="outline-container-org395d139" class="outline-5">
<h5 id="org395d139"><span class="section-number-5">5.17.3.4.</span> Example</h5>
<div class="outline-text-5" id="text-5-17-3-4">
<p>
We'll show how parallel programming (multithreading) works in kcats,
with an example. Let's say we have a database of books, and we have 3
librarians checking in returned books. Let's say for simplicity that
<b>all</b> the books in the database were checked out and have now been
returned and are ready for checkin. We want to update the database so
that each book has a <code>last-checkin</code> property with the timestamp the
librarian processed it, and <code>checked-in-by</code> with the librarian's
name. We want all the books to be processed exactly once, with 3
librarians working in parallel.
</p>

<p>
We'll create chunks of our program and put it all together
later. Here's one chunk.  Let's read in our database and parse it into
a list:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"examples/books.kcats"</span> file-out slurp read
</pre>
</div>

<p>
So that's our database of unprocessed books. Now let's feed our
database into a pipe, in a separate environment. We could also have
used a buffered channel here.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> spawn animate
<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">this copy of the library as the task to feed it is already running</span>
</pre>
</div>

<p>
Now we can create two channels - one to carry unstamped books (the input for the librarian), and one to
carry stamped books (the librarian's output). Then we create another pipe that gives the current time.
</p>
<div class="org-src-container">
<pre class="src src-kcats">handoff <span class="org-comment-delimiter">;; </span><span class="org-comment">a pipe for unprocessed books</span>
handoff <span class="org-comment-delimiter">;; </span><span class="org-comment">a pipe to collect completed work</span>
timestamps <span class="org-comment-delimiter">;; </span><span class="org-comment">pipe for the librarians to stamp their books with</span>
</pre>
</div>

<p>
Now we specify what each librarian should do. This is the meat of the
program. Note the use of the word <code>siphon</code> here. It takes a generator
and a pipe, and keeps generating items and putting them into the
pipe, until the end of the stream is reached (generator produces
<code>nothing</code>).
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">the spawn prog should see: n ts po pi (librarian-name, timestamps, output-pipe, input-pipe)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">the book each prog should see: book n ts po pi</span>
<span class="org-kcats-brackets">[[[[</span><span class="org-function-name">take</span> <span class="org-builtin">dropdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">get a timestamp and then drop the ts pipe</span>
    pair <span class="org-kcats-brackets">[</span>checked-in-by <span class="org-function-name">last</span>-checkin<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> zip<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span>
  binddown binddown  <span class="org-comment-delimiter">;; </span><span class="org-comment">bind n, ts.</span>
  <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">make a generator out of pi</span>
  each <span class="org-comment-delimiter">;; </span><span class="org-comment">book, do the stamping</span>
  <span class="org-builtin">float</span> siphon<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">from the each generator to the output pipe </span>
 spawn animate<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">launch a separate environment</span>
<span class="org-kcats-brackets">[</span>binddown binddown binddown<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bind the 2-4th args</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">now that we've already captured the pipes to the workers we</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">can drop pi and ts</span>
<span class="org-builtin">dropdown</span> dropdeep
</pre>
</div>

<p>
Now that we've specified what each librarian should do, we specify the
librarians. In this case, all we need is their name.
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"Darlene"</span> <span class="org-string">"Thomas"</span> <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the names of the librarians</span>
<span class="org-builtin">swap</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">for each librarian do the above program</span>

<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the resulting list, we only care about launching envs</span>
</pre>
</div>

<p>
Finally we can just collect all the results from the output channel,
and drop the other items we don't need anymore, leaving just the results.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> collect <span class="org-comment-delimiter">;; </span><span class="org-comment">the results</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">drop generator, leaving only results</span>
<span class="org-builtin">sink</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span>
</pre>
</div>

<p>
Here's the whole program:
</p>

<div class="org-src-container">
<pre class="src src-kcats">handoff <span class="org-comment-delimiter">;; </span><span class="org-comment">a pipe for unprocessed books</span>
<span class="org-string">"examples/books.kcats"</span> file-out slurp read <span class="org-comment-delimiter">;; </span><span class="org-comment">read the library</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">feed all the unprocessed books into a pipe, in a separate task</span>
<span class="org-kcats-brackets">[[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> spawn animate
<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">this copy of the library as the task to feed it is already running</span>
handoff <span class="org-comment-delimiter">;; </span><span class="org-comment">a pipe to collect completed work</span>
timestamps <span class="org-comment-delimiter">;; </span><span class="org-comment">pipe for the librarians to stamp their books with</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">the spawn prog should see: n ts po pi (librarian-name, timestamps, output-pipe, input-pipe)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">the book each prog should see: book n ts po pi</span>
<span class="org-kcats-brackets">[[[[</span><span class="org-builtin">swap</span> <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">get a timestamp and then drop the ts pipe</span>
    pair <span class="org-kcats-brackets">[</span>checked-in-by <span class="org-function-name">last</span>-checkin<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> zip<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span>
  binddown binddown  <span class="org-comment-delimiter">;; </span><span class="org-comment">bind n, ts.</span>
  <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">make a generator out of pi</span>
  each <span class="org-comment-delimiter">;; </span><span class="org-comment">book, do the stamping</span>
  <span class="org-builtin">float</span> siphon<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">from the each generator to the output pipe </span>
 spawn animate<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">launch a separate environment</span>
<span class="org-kcats-brackets">[</span>binddown binddown binddown<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bind the 2-4th args</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">now that we've already captured the pipes to the workers we</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">can drop pi and ts</span>
<span class="org-builtin">dropdown</span> dropdeep

<span class="org-kcats-brackets">[</span><span class="org-string">"Darlene"</span> <span class="org-string">"Thomas"</span> <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the names of the librarians</span>
<span class="org-builtin">swap</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">for each librarian do the above program</span>

<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the resulting list, we only care about launching envs</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> collect <span class="org-comment-delimiter">;; </span><span class="org-comment">the results</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">drop generator, leaving only results</span>
<span class="org-builtin">sink</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>checked-in-by <span class="org-string">"Darlene"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958940<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"George"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Orwell"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"1984"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1949<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>government dystopia surveillance totalitarianism freedom<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958945<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Aldous"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Huxley"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Brave New World"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1932<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>society technology dystopia happiness drugs<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"F. Scott"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Fitzgerald"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The Great Gatsby"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1925<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>wealth love obsession american-dream tragedy<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"J.D."</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Salinger"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The Catcher in the Rye"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>adolescence alienation innocence society adulthood<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Jane"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Austen"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Pride and Prejudice"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1813<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>love marriage society class reputation<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Mary"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Shelley"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Frankenstein"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1818<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>creation science responsibility monster humanity<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"John"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Steinbeck"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Of Mice and Men"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1937<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>friendship dream loneliness society tragedy<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Ernest"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Hemingway"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The Old Man and the Sea"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1952<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>endurance nature old-age fisherman sea<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Harper"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Lee"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"To Kill a Mockingbird"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1960<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>racism innocence morality law childhood<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958950<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"J.R.R."</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Tolkien"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The Lord of the Rings"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1954<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>adventure elf dwarf hobbit ring journey magic evil<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Joseph"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Conrad"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Heart of Darkness"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1899<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>colonization africa journey morality darkness europeans<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Leo"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Tolstoy"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"War and Peace"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1869<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>war peace society history love aristocracy<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Homer"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The Odyssey"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year -800<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>journey odyssey homecoming gods heroism adventure<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Charlotte"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Bronte"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Jane Eyre"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1847<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>love morality society class womanhood independence<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Mark"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Twain"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Adventures of Huckleberry Finn"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1884<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>adventure racism slavery morality friendship river<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Darlene"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Ray"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Bradbury"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Fahrenheit 451"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1953<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>censorship knowledge books society dystopia future<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Charles"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Dickens"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"A Tale of Two Cities"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1859<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>revolution love sacrifice resurrection society history<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"William"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Golding"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Lord of the Flies"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1954<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>society civilization savagery childhood morality island<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Thomas"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Miguel de"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Cervantes"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Don Quixote"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1605<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>adventure idealism reality knight insanity literature<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>checked-in-by <span class="org-string">"Ethel"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span>-checkin 1698764958951<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">first</span> <span class="org-string">"H.G."</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Wells"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"The War of the Worlds"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1898<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>invasion aliens society technology war humanity<span class="org-kcats-brackets">]]]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org95ffeeb" class="outline-3">
<h3 id="org95ffeeb"><span class="section-number-3">5.18.</span> Debugging</h3>
<div class="outline-text-3" id="text-5-18">
</div>
<div id="outline-container-orgfbf1089" class="outline-4">
<h4 id="orgfbf1089"><span class="section-number-4">5.18.1.</span> The debugger</h4>
<div class="outline-text-4" id="text-5-18-1">
<p>
In kcats, we don't need an external debugger. We can debug our
programs right in the kcats interpeter. We can specify the program to
run and step through it.
</p>

<p>
Let's say this is the program we want to step through. This is how
we'd normally run it:
</p>
<div class="org-src-container">
<pre class="src src-kcats">0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">6
</pre>
</div>

<p>
To debug, we put it into an environment item which we can then use
debugging words like <code>advance</code>:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span> environment
<span class="org-kcats-brackets">[</span>advance<span class="org-kcats-brackets">]</span> 7 <span class="org-preprocessor">times</span>
eval-<span class="org-function-name">step</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> 1 0<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
Note that <code>advance</code> is like <code>step-over</code> in a traditional debugger, and
<code>eval-step</code> is like <code>step-into</code>.  So above we advance until we reach the
word <code>step</code> in the program, and then we step into it. We end up showing
the environment in the middle of execution. The stack has a program
<code>[+]</code> on top, and the next word is <code>execute</code> which will run that program.
</p>

<p>
You can also use a <code>until</code> loop to run the program until an arbitrary
condition is hit. Here's one that runs the program until the number <code>4</code>
is on the top of stack (note the handy word <code>tos</code> shortcut)
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span> environment
<span class="org-kcats-brackets">[</span>tos 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2 1<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
You can do whatever you want with the environment data - you can
retain the environment at every step, filter the steps, change them,
and continue the execution from any arbitrary place.
</p>

<p>
It's particularly handy to save an environment at the "last known
good" state and continue from there, instead of having to re-execute
from the beginning each time.
</p>

<p>
Just as an example of what's possible, here we show only the states
where <code>+</code> is about to be executed. <code>stepper</code> is a generator that takes an
environment and generates all the steps of execution. Note <code>top</code> means
"top of program", so it's keeping the states where <code>+</code> is the next
item in the program.
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>program <span class="org-kcats-brackets">[</span>0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span> environment
 stepper
 <span class="org-kcats-brackets">[</span>top <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> keep
 collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2 1<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
Then just to show that all these environments work on their own, we'll
add some code to select the first one and step it forward. So we've
essentially gone back in time and rolled forward again.
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>program <span class="org-kcats-brackets">[</span>0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span> environment
 stepper
 <span class="org-kcats-brackets">[</span>top <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> keep
 collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">add this</span>
<span class="org-function-name">first</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">to select the first env from above</span>
eval-<span class="org-function-name">step</span> <span class="org-comment-delimiter">;; </span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
We can even mess with the stack and the program:
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>program <span class="org-kcats-brackets">[</span>0 1 3 inc 1 range <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span> environment
 stepper
 <span class="org-kcats-brackets">[</span>top <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> keep
 collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">add this</span>
<span class="org-function-name">first</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">to select the first env from above</span>
<span class="org-kcats-brackets">[</span>program 0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> assign <span class="org-comment-delimiter">;; </span><span class="org-comment">change + to - right before it is run</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">now step forward again</span>
eval-<span class="org-function-name">step</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>-1<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab30ab9" class="outline-4">
<h4 id="orgab30ab9"><span class="section-number-4">5.18.2.</span> Other tools</h4>
<div class="outline-text-4" id="text-5-18-2">
<p>
The "good old fashioned" method of debugging a program is to put <code>print</code>
statements throughout the program to get insight into what's
happening.
</p>

<p>
You can do that in kcats too!
</p>

<div class="org-src-container">
<pre class="src src-kcats">3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it was odd"</span> print inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"it was even"</span> print 2 *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span>
</pre>
</div>

<p>
<code>print</code> takes a string and will print it to standard out.
</p>

<div class="org-src-container results">
<pre class="src src-kcats">it was odd
4
</pre>
</div>

<p>
There's also a way to print the current stack, it's called <code>dump</code>, and
it has has no stack effect, so it's safe to put anywhere.
</p>

<div class="org-src-container">
<pre class="src src-kcats">1 2 3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dump inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dump 2 *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span> 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span>
4 2 1
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org17d36a4" class="outline-2">
<h2 id="org17d36a4"><span class="section-number-2">6.</span> More Examples</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org1b6c89c" class="outline-3">
<h3 id="org1b6c89c"><span class="section-number-3">6.1.</span> Query a flat file database</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"examples/books.kcats"</span> file-out slurp read
 <span class="org-kcats-brackets">[[</span>subjects<span class="org-kcats-brackets">]</span> lookup
  set <span class="org-kcats-brackets">[</span>dystopia<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> contains?<span class="org-kcats-brackets">]</span>
 <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> 
<span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>author-<span class="org-function-name">first</span> <span class="org-string">"George"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Orwell"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"1984"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1949<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>government dystopia surveillance totalitarianism freedom<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Aldous"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Huxley"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Brave New World"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1932<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>society technology dystopia happiness drugs<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>author-<span class="org-function-name">first</span> <span class="org-string">"Ray"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>author-<span class="org-function-name">last</span> <span class="org-string">"Bradbury"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>title <span class="org-string">"Fahrenheit 451"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>year 1953<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>subjects <span class="org-kcats-brackets">[</span>censorship knowledge books society dystopia future<span class="org-kcats-brackets">]]]]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94e0512" class="outline-3">
<h3 id="org94e0512"><span class="section-number-3">6.2.</span> Factorial</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-org9665f7d" class="outline-4">
<h4 id="org9665f7d"><span class="section-number-4">6.2.1.</span> Recursive with recur</h4>
<div class="outline-text-4" id="text-6-2-1">
<div class="org-src-container">
<pre class="src src-kcats">10
<span class="org-kcats-brackets">[</span>1 &lt;=<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> *<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">recur</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">3628800
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf51315" class="outline-4">
<h4 id="orgbf51315"><span class="section-number-4">6.2.2.</span> Using range</h4>
<div class="outline-text-4" id="text-6-2-2">
<div class="org-src-container">
<pre class="src src-kcats">10
inc <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 1 range 
<span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">3628800
</pre>
</div>
</div>
</div>

<div id="outline-container-org544da5a" class="outline-4">
<h4 id="org544da5a"><span class="section-number-4">6.2.3.</span> Plain loop</h4>
<div class="outline-text-4" id="text-6-2-3">
<div class="org-src-container">
<pre class="src src-kcats">10 <span class="org-builtin">clone</span> 
yes <span class="org-kcats-brackets">[</span>dec <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">clone</span> 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span>
<span class="org-builtin">drop</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">3628800
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org059266d" class="outline-3">
<h3 id="org059266d"><span class="section-number-3">6.3.</span> Jensen's Device</h3>
<div class="outline-text-3" id="text-6-3">
<p>
<a href="https://rosettacode.org/wiki/Jensen%27s_Device">https://rosettacode.org/wiki/Jensen%27s_Device</a>
</p>
<div class="org-src-container">
<pre class="src src-kcats">100 <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1.0 <span class="org-builtin">swap</span> /<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> +<span class="org-kcats-brackets">]</span> primrec
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">5.187377517639621
</pre>
</div>
</div>
</div>

<div id="outline-container-org83144da" class="outline-3">
<h3 id="org83144da"><span class="section-number-3">6.4.</span> Fibonacci</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">fibonacci generator</span>
 20 taker <span class="org-comment-delimiter">;; </span><span class="org-comment">another generator that calls generate 20 times</span>
 collect<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">collects all the generated items into a list</span>
 <span class="org-preprocessor">shield</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb40cb7e" class="outline-3">
<h3 id="orgb40cb7e"><span class="section-number-3">6.5.</span> Prime factors</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-kcats">3602342544211111

<span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span> 2 <span class="org-comment-delimiter">;;  </span><span class="org-comment">current-divisor input result</span>

<span class="org-kcats-brackets">[[</span>sqrt<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &gt;=<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[</span>mod zero?<span class="org-kcats-brackets">]</span> 
 <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d c-d i r</span>
  <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d i c-d r</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d i new-r</span>
  / 2<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">dividend new-r</span>
 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">c-d++ i r</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">while</span>

<span class="org-builtin">drop</span> <span class="org-function-name">put</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>37 287873 338206811<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
Prime factor generator
</p>

<div class="org-src-container">
<pre class="src src-kcats">1231231231231231
2
<span class="org-kcats-brackets">[[[[[</span>mod zero? not<span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[[</span>sqrt<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &gt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>  
  <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> 
  <span class="org-preprocessor">while</span>

  <span class="org-kcats-brackets">[</span>mod zero?<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[</span>/<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> dropdeep <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
collect <span class="org-builtin">dropdown</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>89 3271 5683 744203<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c868f0" class="outline-3">
<h3 id="org9c868f0"><span class="section-number-3">6.6.</span> bidirectional comms from a socket</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>string <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">each group of bytes that come out of the tunnel,</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">convert to string and join to whatever we already</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">collectd</span>
 <span class="org-kcats-brackets">[[</span>type ip-host<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>address <span class="org-string">"localhost"</span><span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>port 9988<span class="org-kcats-brackets">]]</span> association <span class="org-comment-delimiter">;; </span><span class="org-comment">description of where to connect to (an ip port)</span>
 tunnel <span class="org-comment-delimiter">;; </span><span class="org-comment">make a bidirectional tunnel</span>
 <span class="org-string">"foo! bar!"</span> <span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">send this string</span>
 collect<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">receive</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2820859" class="outline-3">
<h3 id="org2820859"><span class="section-number-3">6.7.</span> Write string to a file</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]</span> pipe-in
 <span class="org-string">"blah"</span> <span class="org-function-name">put</span>
 close<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org51c304f" class="outline-3">
<h3 id="org51c304f"><span class="section-number-3">6.8.</span> Search the dictionary</h3>
<div class="outline-text-3" id="text-6-8">
<div class="org-src-container">
<pre class="src src-kcats">dictionary <span class="org-comment-delimiter">;; </span><span class="org-comment">put the dictionary of all words onto the stack as key value pairs</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the value of one of those pairs</span>
 <span class="org-kcats-brackets">[</span>spec<span class="org-kcats-brackets">]</span> lookup <span class="org-comment-delimiter">;; </span><span class="org-comment">look up the spec field</span>
 <span class="org-function-name">first</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the input part of the spec</span>
 <span class="org-kcats-brackets">[</span>number number<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">is it taking two number inputs?</span>
<span class="org-function-name">filter</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">filter the dictionary using the above criteria</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">of what remains, just keep the key (which is the word itself)</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>quot rem &gt; + / * max - &gt;= min &lt; &lt;= mod within?<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5abd501" class="outline-3">
<h3 id="org5abd501"><span class="section-number-3">6.9.</span> Copy data from one file to another</h3>
<div class="outline-text-3" id="text-6-9">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>file <span class="org-string">"/tmp/buffer-content-bkWB9Z"</span><span class="org-kcats-brackets">]]</span> pipe-out 
<span class="org-kcats-brackets">[[</span>file <span class="org-string">"/tmp/mytest"</span><span class="org-kcats-brackets">]]</span> pipe-in
<span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> siphon <span class="org-builtin">drop</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"/tmp/foo"</span> <span class="org-string">"/tmp/bar"</span>
pair <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-builtin">float</span> assign<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">make file descriptors for both</span>
<span class="org-function-name">take</span> pipe-out
<span class="org-builtin">swap</span> <span class="org-function-name">unwrap</span> pipe-in
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>unwound <span class="org-kcats-brackets">[[</span>type<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> = <span class="org-kcats-brackets">[[[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/bar"</span><span class="org-kcats-brackets">]]]]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span> <span class="org-function-name">unwrap</span> <span class="org-preprocessor">branch</span> <span class="org-kcats-brackets">[[[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>type<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/bar"</span><span class="org-kcats-brackets">]]]]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[[[[</span>association<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-function-name">unwrap</span> or <span class="org-kcats-brackets">[[[[</span><span class="org-keyword">nothing</span>?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>or<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span> <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> = <span class="org-kcats-brackets">[[[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/bar"</span><span class="org-kcats-brackets">]]]]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[[[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/bar"</span><span class="org-kcats-brackets">]]]]]</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>value file-out<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> serversocket<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+kcats.pipe/-&gt;filled<span class="org-kcats-brackets">]]]</span> decide<span class="org-kcats-brackets">]]</span> <span class="org-function-name">unwrap</span> <span class="org-preprocessor">branch</span> <span class="org-builtin">swap</span> <span class="org-function-name">unwrap</span> pipe-in<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>reason <span class="org-string">"type mismatch"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>actual <span class="org-kcats-brackets">[[</span>file <span class="org-string">"/tmp/foo"</span><span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[[</span>file <span class="org-string">"/tmp/bar"</span><span class="org-kcats-brackets">]]]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge887b59" class="outline-3">
<h3 id="orge887b59"><span class="section-number-3">6.10.</span> List the steps of program execution</h3>
<div class="outline-text-3" id="text-6-10">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the program to trace</span>

<span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-function-name">wrap</span> environment <span class="org-comment-delimiter">;; </span><span class="org-comment">create a starting env</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">now create a generator of environment states for each step of execution</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if the program is not empty</span>
 <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">step </span>
 <span class="org-kcats-brackets">[[]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise emit nothing to stop the consumption</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">consume the generator</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]</span> 0<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> 0<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> 1 0<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> 2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>3<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> 3 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]]</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]]</span>
</pre>
</div>

<p>
We could ensure the stack/program are printed in the same order each time
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the program to debug</span>

<span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-function-name">wrap</span> environment <span class="org-comment-delimiter">;; </span><span class="org-comment">create a starting env</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">now create a generator of environment states for each step of execution</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">print with the fields sorted the same way for each step</span>
<span class="org-kcats-brackets">[</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> 3 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]]</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]]</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdbedf85" class="outline-2">
<h2 id="orgdbedf85"><span class="section-number-2">7.</span> Contributing</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org0ca3697" class="outline-3">
<h3 id="org0ca3697"><span class="section-number-3">7.1.</span> Issue reporting</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Instead of opening a github issue, add a <code>TODO</code> subheading to the
<a href="#org9d3233c">Issues</a> heading. Commit the change and submit it as a pull request. In
the branch where that issue is being fixed, it will be changed to
<code>INPROGRESS</code>. When the issue is fixed, the heading will be
removed. (If you disagree that it's been fixed, submit a PR that
reverts the commit to remove it).
</p>

<p>
You can edit this file right on github, in your own fork of the
project, if you prefer.
</p>

<p>
Why do things this weird way? I don't want to rely on github, nice as
it is.
</p>

<p>
Please do report design improvements you'd like to see - for example,
inconsistencies in how words expect stack arguments to be, ways to
make the standard library easier to work with, etc.
</p>
</div>
</div>
</div>
<div id="outline-container-org7b40bc9" class="outline-2">
<h2 id="org7b40bc9"><span class="section-number-2">8.</span> FAQ</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org23f7813" class="outline-3">
<h3 id="org23f7813"><span class="section-number-3">8.1.</span> How do I keep track of what should be on the stack, as I write programs?</h3>
<div class="outline-text-3" id="text-8-1">
<p>
There's tooling planned that will help show what should be on the
stack at any point in a given program. However until that exists, you
can use comments to annotate your program line by line, and show what
is on the stack at each step.
</p>

<p>
See <a href="#orgb40cb7e">6.5</a> example.
</p>

<p>
This is admittedly low tech, but it isn't as tedious as you might
first expect. You only have to pay attention to the stack items
actually touched by the code you're writing, which usually is rather
small - if you need to annotate a line with more than 5 or 6 items you
are probably doing something wrong. The solution could be to use an
association or list to hold multiple properties of the same conceptual
object, in one stack item.
</p>
</div>
</div>
<div id="outline-container-org13e8342" class="outline-3">
<h3 id="org13e8342"><span class="section-number-3">8.2.</span> Why is there no word 'no' in kcats, but there is 'yes'?</h3>
<div class="outline-text-3" id="text-8-2">
<p>
The logic rules are that empty containers are 'negative', and every
other value is 'affirmative'. So the word <code>no</code>, by those rules would be
affirmative, which would be very surprising! So the word <code>no</code> is not
used in the language. To convey a logical negative, use empty list <code>[]</code>.
</p>
</div>
</div>
<div id="outline-container-org33fa6ea" class="outline-3">
<h3 id="org33fa6ea"><span class="section-number-3">8.3.</span> I got an error, how do I diagnose the problem?</h3>
<div class="outline-text-3" id="text-8-3">
<p>
The first thing to do is check the contents of the error. The <code>unwound</code>
field will show you the instruction that failed along with the
remaining program. 
</p>

<p>
If that doesn't tell you enough about what's wrong (and it often
doesn't), there are several more tools at your disposal:
</p>

<ul class="org-ul">
<li><code>dump</code> - this word prints the stack to stdout, if you add it to your
program at strategic places, you can see if the stack looks the way
you would expect at that point in the execution.</li>
<li><a href="#org95ffeeb">built-in debugger</a> - this allows you to step through program execution.</li>
<li>tracing - see <a href="#orge887b59">6.10</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgd72d606" class="outline-3">
<h3 id="orgd72d606"><span class="section-number-3">8.4.</span> kcats panics and exits, why?</h3>
<div class="outline-text-3" id="text-8-4">
<p>
This is due to a known unimplemented feature in the interpreter, or an
unknown bug. Please see <a href="#org9d3233c">9</a>, and if you don't see it there, please
add a new one and submit a pull request. Even for unimplemented
features it's good to let us know you need that feature so we can
prioritize it.
</p>

<p>
The goal is for kcats to never panic.
</p>
</div>
</div>
</div>
<div id="outline-container-org9d3233c" class="outline-2">
<h2 id="org9d3233c"><span class="section-number-2">9.</span> Issues</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org39544ad" class="outline-3">
<h3 id="org39544ad"><span class="section-number-3">9.1.</span> <span class="done DONE">DONE</span> Build without using emacs interactively</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Users should not be required to know emacs to build the project, only
have it installed. The build should be accessible from bash without
having to use emacs interactively. 
</p>
</div>
</div>
<div id="outline-container-org0e1e20d" class="outline-3">
<h3 id="org0e1e20d"><span class="section-number-3">9.2.</span> <span class="done DONE">DONE</span> Remove platform interop from lexicon</h3>
<div class="outline-text-3" id="text-9-2">
<p>
That was only there as a cheat when there was only the prototype
implementation. The platforms are different and their function names
don't belong in the lexicon.
</p>

<p>
I'm not even sure there should be platform interop at all - it doesn't
appear to be possible in the rust impl anyway.
</p>

<p>
So far what I've done is have some lower level words actually in the
dictionary but marked them like `++lookup`. I haven't decided what to
do about this yet. Lower level words probably should just be first
class citizens and I just need to think of better names. Right now the
low level (single-depth) lookup is `++lookup` and the user-facing
`lookup` does the arbitrary depth. In this case, the user-facing name
probably needs to change to reflect what it does (something like
`drill` or `extract`), and then the low level can just be `lookup`.
</p>

<p>
That means for all the i/o and crypto interactions, there needs to be
low-level words. I'm not sure yet how to prevent namespace pollution,
as one of the design choices is
</p>
</div>
</div>
<div id="outline-container-org5956ab9" class="outline-3">
<h3 id="org5956ab9"><span class="section-number-3">9.3.</span> <span class="done DONE">DONE</span> 'unassign' doesn't take a keylist, only a single key</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Should change to match <code>assign</code> and <code>lookup</code>, accept a list instead of
a single bare word.
</p>
</div>
</div>
<div id="outline-container-orga2330ba" class="outline-3">
<h3 id="orga2330ba"><span class="section-number-3">9.4.</span> <span class="done DONE">DONE</span> More support for nested/related envs</h3>
<div class="outline-text-3" id="text-9-4">
<p>
Debuggers, spawning, ingesting etc
</p>
</div>
</div>
<div id="outline-container-org16ae379" class="outline-3">
<h3 id="org16ae379"><span class="section-number-3">9.5.</span> <span class="todo TODO">TODO</span> Graphical environment browser/editor</h3>
<div class="outline-text-3" id="text-9-5">
<p>
It would be nice to have a graphical display of all the environments
in an application, and be able to 
</p>
<ul class="org-ul">
<li>Drill into the environment and read the stack/program/dictionary</li>
<li>Pause/resume execution</li>
<li>Apply debugging (breakpoint, step etc)</li>
<li>View pipes and what/where they connect to (draw lines if they
connect somewhere else in the app)</li>
<li>Manually put things into pipes or take them out</li>
<li>Create new envs</li>
<li>Persist changes</li>
<li>Revert changes</li>
</ul>
</div>
</div>
<div id="outline-container-orga5c40f2" class="outline-3">
<h3 id="orga5c40f2"><span class="section-number-3">9.6.</span> <span class="todo TODO">TODO</span> Code distribution method</h3>
<div class="outline-text-3" id="text-9-6">
<p>
Let's say we write an app or library, how do we distribute it?
</p>

<p>
This ties in with durability - where do we store things in general,
and not just libraries? kcats does support the filesystem but I would
like that to be for compatibility only. The "native" kcats way of
storing and retrieving things should be via hash keys. There may also
be a fact database, probably with sparse tables (aka eavt format).
</p>

<p>
It brings up the question of what should "come with" the language. I
am thinking maybe there's a "barebones" version of the language with
no library management or anything. Then on top of that, build some
durability and networking to distribute code and other data. Then the
question is, what do we need to support in the base language? Seems
like there needs to be database/network functionality there, but
unused? Maybe make it a feature flag?
</p>

<p>
Let's explore the various options
</p>
</div>
<div id="outline-container-org3636b59" class="outline-4">
<h4 id="org3636b59"><span class="section-number-4">9.6.1.</span> Durability</h4>
<div class="outline-text-4" id="text-9-6-1">
<p>
It's tempting to want the flexibility of EAV (where there's basically
just one big db table with 3 columns and every attribute is a row).
</p>

<p>
However this may be a little hasty. Perhaps what we're really after
here is custom tables - the idea being that each user's db schema
might be different depending on what data is important to them.
</p>

<p>
We've basically got a database schema consensus problem. Maybe Alice
has a table CATS with columns SIZE COLOR AGE and Bob has a table CATS
with columns HEIGHT COAT-COLOR AGE. How do they share data? The two
tables are not really compatible without a specialized conversion tool
and even then some data would be missing. So Alice and Bob ideally
should agree on what a CATS schema is, otherwise they can't really
share CAT facts. The advantage of EAV might be that even if they had
different schemas they could stlil perhaps meaningfully talk about AGE
and possibly even COLOR (with a bit of intervention, or even another
fact that equates COLOR and COAT-COLOR in CATS).
</p>

<p>
The drawback of EAV is of course that it would perform rather terribly
as the database grows. I can't say for sure how many facts could
potentially be stored here, but here are some constraints:
</p>

<ul class="org-ul">
<li>Assume individual data only (no facebooks that store millions of
people's data)</li>
<li>Assume popularity of the app (users may try to cram every fact they
"know" into this db)</li>
<li><p>
Assume there's some kind of garbage collection - Alice may collect
weather observations or predictions constantly but doesn't need to
keep old data. Maybe facts have a TTL? Not sure how that could be
determined automatically.
</p>

<p>
It's hard to estimate how large the db might get, but I suspect a
 lower bound of supporting 1M entries is safe. As for upper bound,
 it's more difficult to say, but I would think the hardware limits of
 mobile devices would come into play. As of 2023 I think a db size on
 the order of 10gb would be approaching the device's capability
 limits, so maybe 100M entries or so. I think it would be difficult
 to get an EAV database to perform well at that size, especially on
 mobile. Note datomic can handle that size so it's theoretically
 within reach.
</p>

<p>
It may be possible to pick a standard db now (sqlite maybe) and not
worry too much about performance. As long as the facts are portable
to another db (which shouldn't be that hard), the issue can be
revisited when it becomes an issue.
</p>

<p>
Even using sqlite though, just building proper queries may be
difficult. It may be possible to skirt that problem too and just do
a minimal query to get a dataset that fits easily in memory and then
post-process the rest. Let's say the query is "List all predictors
(people who made predictions) and their accuracy", you could get all
the unique predictor ids in a query, then one by one get all their
predictions, then get all the relevant observations and compare
them. Slow but not the type of query that will be done often, and
possibly indexable.
</p></li>
</ul>
</div>
<div id="outline-container-org1fcce61" class="outline-5">
<h5 id="org1fcce61"><span class="section-number-5">9.6.1.1.</span> Possible dynamic sql db</h5>
<div class="outline-text-5" id="text-9-6-1-1">
<p>
One possible design is to just use plain old sql (sqlite?) and create
normal tables. However the table names would be namespaced, possibly
with some sort of hash. That way, one person's "Customer" schema could
be in the same database as another person's without interfering.
</p>

<p>
So for example, the kcats language might need to keep track of library
dependencies. There could be a table <code>dependencies-01234abcd</code> with
columns <code>name</code>, <code>version</code>, <code>hash</code>, <code>blob</code> etc. Anything else wanting to use the
same schema could refer to it by hash. It would be possible to have
foriegn keys too.
</p>

<p>
One thing we want to avoid is having kcats users writing sql query
strings, that is not the idiomatic way of dealing with i/o. What
should happen is there's a <code>query</code> word that takes a program and db
descriptor of where the db is, and returns a pipe (where results come
out). The program is a "query equivalent" and would need to be
translated to sql and post-processed. This is very much nontrivial and
a naive implementation probably wouldn't perform well but we will try
it anyway. For example instead of writing
</p>

<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">insert</span> <span class="org-keyword">into</span> Customers (<span class="org-keyword">name</span>, age) <span class="org-keyword">values</span> ("Bob", 25); 
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> Customers <span class="org-keyword">where</span> <span class="org-keyword">name</span>="Bob";
</pre>
</div>

<p>
you'd write something like
</p>
<div class="org-src-container">
<pre class="src src-kcats">customers <span class="org-kcats-brackets">[[</span>name <span class="org-string">"Bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>age 25<span class="org-kcats-brackets">]]</span> <span class="org-function-name">put</span>

customers <span class="org-kcats-brackets">[[</span>name<span class="org-kcats-brackets">]</span> lookup <span class="org-string">"Bob"</span> =<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span>
</pre>
</div>

<p>
and 
And then the translation would see we're selecting from customers,
then there's a filter. The filter might not translate to sql so it
will either just select all, or if it sees a certain format for the
predicate it can translate to a <code>where</code> clause. This is going to be
complex and bug prone but hopefully can be done in a way that the
worst case is poor performance and then iterate to get better
speed.
</p>


<p>
I suppose content distribution might need to be done
alongside this.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org2509202" class="outline-3">
<h3 id="org2509202"><span class="section-number-3">9.7.</span> <span class="done DONE">DONE</span> Clean up all the vector conversion</h3>
<div class="outline-text-3" id="text-9-7">
<p>
I've been calling <code>vec</code> a lot, sometimes just so the list will print
out with square braces. I now have a <code>repr</code> function that could do
this, so using <code>vec</code> for that purpose is no longer needed.
</p>

<p>
However, I can't get rid of all of them- for example, calling <code>conj</code>
on a vector vs list adds at different ends of the list so they are not
interchangeable in that respect. It may be dangerous to leave any
lists lying around if they might get conjed onto expecting it to go on
the end.
</p>
</div>
</div>
<div id="outline-container-org76beef1" class="outline-3">
<h3 id="org76beef1"><span class="section-number-3">9.8.</span> <span class="done DONE">DONE</span> org-babel-execute for kcats</h3>
</div>
<div id="outline-container-org3c8b32d" class="outline-3">
<h3 id="org3c8b32d"><span class="section-number-3">9.9.</span> <span class="todo INPROGRESS">INPROGRESS</span> At least one example for each word in lexicon</h3>
<div class="outline-text-3" id="text-9-9">
<div class="org-src-container">
<pre class="src src-kcats">10 0.5 *
</pre>
</div>

<pre class="example">
5
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"foo"</span> bytes
</pre>
</div>

<pre class="example">
#b64 "Zm9v"
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> 5 assign
</pre>
</div>

<pre class="example">
[[c [[d 5]]] [a b]]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[]]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d 5<span class="org-kcats-brackets">]]</span> association assign
</pre>
</div>

<pre class="example">
[[c [[d 5]]] [a b]]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>1 1 0 1<span class="org-kcats-brackets">]</span> 5 assign
</pre>
</div>

<pre class="example">
[[a b] [c [[d 5]]]]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]</span> 5 assign
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">4 3 <span class="org-kcats-brackets">[</span>&gt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">sink</span> <span class="org-preprocessor">branch</span> 
</pre>
</div>

<pre class="example">
4
</pre>


<div class="org-src-container">
<pre class="src src-kcats">yes 4 2 <span class="org-preprocessor">branch</span>
</pre>
</div>

<pre class="example">
[[asked [program]] [reason "type mismatch"] [type error] [unwound [branch]]] 2 4 yes
</pre>


<div class="org-src-container">
<pre class="src src-kcats">5
<span class="org-kcats-brackets">[</span>1 2 <span class="org-string">"oh fudge"</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[]</span>
 recover<span class="org-kcats-brackets">]</span>
<span class="org-function-name">map</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>type error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>reason <span class="org-string">"word is not defined"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>handle<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[]]]</span> <span class="org-kcats-brackets">[[</span>unwound <span class="org-kcats-brackets">[]]</span> <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>handle<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>reason <span class="org-string">"word is not defined"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>asked <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>reason <span class="org-string">"type mismatch"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]]]]</span> 5
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">5 1 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> recover
</pre>
</div>

<pre class="example">
[[unwound []] [asked [handle]] [reason "word is not defined"] [type error]] 1 5
</pre>


<div class="org-src-container">
<pre class="src src-kcats">1 type
</pre>
</div>

<pre class="example">
number
</pre>


<div class="org-src-container">
<pre class="src src-kcats">5.01 5 0.1 <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>- abs<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &lt;
</pre>
</div>

<pre class="example">
yes
</pre>
</div>
</div>

<div id="outline-container-org5367ff4" class="outline-3">
<h3 id="org5367ff4"><span class="section-number-3">9.10.</span> <span class="todo INPROGRESS">INPROGRESS</span> Prime number sieve example</h3>
<div class="outline-text-3" id="text-9-10">
<div class='tangle-wrapper' data-tangle='sieve.kcats'><div class="org-src-container">
<pre class="src src-kcats">2000 <span class="org-builtin">clone</span> 2 <span class="org-builtin">swap</span> range <span class="org-comment-delimiter">;; </span><span class="org-comment">all the numbers up to n</span>

<span class="org-kcats-brackets">[</span>sqrt 2<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">start counter at 2, stop at sqrt of n</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> =<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">stop loop when the counter hits sqrt n</span>
<span class="org-kcats-brackets">[[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the original args, just leaving the primes</span>
<span class="org-kcats-brackets">[[[[</span>=<span class="org-kcats-brackets">]</span> 
   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> mod positive?<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> 
 <span class="org-function-name">filter</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">keep the counter but no multiples of it </span>
 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">increment counter</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">recur</span>
</pre>
</div></div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>reason not enough items on stack<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>sqrt 2 <span class="org-kcats-brackets">[[]]</span>
           <span class="org-function-name">unwrap</span>
           <span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> =<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
            <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[[[[</span>=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> mod positive?<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
             any?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span>
            <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>consume<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Here's a mimic of the python version, WIP:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">num</span>
10
<span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>yes <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">; </span><span class="org-comment">a n</span>
2 <span class="org-comment-delimiter">;; </span><span class="org-comment">p a n</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-builtin">clone</span> * &gt; <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">while test</span>
<span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">if test - fetch by index</span>
 <span class="org-kcats-brackets">[</span>
 <span class="org-builtin">swapdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p n a</span>
 <span class="org-builtin">clone</span> <span class="org-comment-delimiter">; </span><span class="org-comment">p</span>
 <span class="org-builtin">clone</span> * <span class="org-comment-delimiter">; </span><span class="org-comment">p^2 p n a</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">range wants p, n+1, p^2 </span>
 <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p n p^2</span>
 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p n+1 p^2</span>
 <span class="org-kcats-brackets">[</span>range<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r p n+1 p^2 a</span>
 <span class="org-kcats-brackets">[</span>dec <span class="org-builtin">sink</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r p a n</span>
 <span class="org-builtin">swapdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r a p</span>
 <span class="org-kcats-brackets">[</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">i r a p</span>
  <span class="org-function-name">wrap</span> <span class="org-comment-delimiter">;;</span><span class="org-comment">swapdown ;; [i] a r p</span>
  <span class="org-kcats-brackets">[[]]</span> update <span class="org-comment-delimiter">;; </span><span class="org-comment">set to false: a r p</span>
  <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r a p</span>
 <span class="org-kcats-brackets">]</span>
 <span class="org-function-name">step</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">a p</span>
 <span class="org-builtin">swap</span> 
 <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">do the for loop</span>
 <span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">else do nothing</span>
 <span class="org-preprocessor">if</span>
 inc <span class="org-comment-delimiter">;; </span><span class="org-comment">p++</span>
<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">while</span> 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>reason type mismatch<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>unwound <span class="org-kcats-brackets">[</span>fail <span class="org-kcats-brackets">[[</span>2 <span class="org-kcats-brackets">[</span>yes yes yes yes
                     yes yes yes yes
                     yes yes<span class="org-kcats-brackets">]</span>
                  10<span class="org-kcats-brackets">]]</span>
           <span class="org-function-name">unwrap</span> <span class="org-builtin">evert</span>
           <span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">swapdown</span> <span class="org-builtin">clone</span> <span class="org-builtin">clone</span> *
                   <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                   <span class="org-kcats-brackets">[</span>range<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>dec <span class="org-builtin">sink</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                   <span class="org-preprocessor">dipdown</span> <span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[]]</span>
                                     update <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                   <span class="org-function-name">step</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[]]</span> <span class="org-function-name">unwrap</span>
           <span class="org-preprocessor">branch</span> inc <span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-builtin">clone</span> * &gt;<span class="org-kcats-brackets">]</span>
           <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-builtin">clone</span> <span class="org-builtin">clone</span> *
                    <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                    <span class="org-kcats-brackets">[</span>range<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>dec <span class="org-builtin">sink</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                    <span class="org-preprocessor">dipdown</span> <span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[]]</span>
                                      update <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-function-name">step</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[]</span>
                   <span class="org-preprocessor">if</span> inc <span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-builtin">clone</span> * &gt;<span class="org-kcats-brackets">]</span>
                   <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>actual <span class="org-kcats-brackets">[[</span>type error<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>reason Lookup attempted on non-associative value<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>asked
                                                                                      <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>handled yes<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>type error<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>asked <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>reason Lookup attempted on non-associative value<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes yes yes yes
 yes yes yes yes
 yes yes<span class="org-kcats-brackets">]</span> 10
</pre>
</div>

<pre class="example">
[yes yes yes yes yes yes yes yes yes yes]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> 15 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span>
2 <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p a</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-builtin">clone</span> *<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p^2 a p</span>
<span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>&lt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">b p^2 a p  </span>
<span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span> update<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">do the update </span>
 <span class="org-builtin">float</span> <span class="org-builtin">drop</span> <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span>
<span class="org-comment-delimiter">;</span><span class="org-comment">while</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes 4 <span class="org-kcats-brackets">[</span>yes yes yes yes yes yes yes yes yes yes yes yes yes yes yes<span class="org-kcats-brackets">]</span> 2
</pre>
</div>

<p>
How do we write this code? Generally, how do we decide what order things go on the stack?
</p>

<p>
It looks like the array of bools is the main piece of data here, that
is used throughout the algorithm. The other commonly used variable is
p, the one that's incremented. I think probably p should remain on
top. The outermost loop needs to know when to stop, and that needs to
compare to num. That can go on the bottom.
</p>

<p>
The inner loop uses i. That should probably replace p on top when in use.
So it should be <code>[p a]</code> and later <code>[i a p]</code>.
</p>

<p>
Now that <code>lingo</code> exists, maybe should also write <code>let</code> for variables
(where the values are evaluated before updating the dictionary)?  Also
these aren't actually "variables" because you can't change the value,
without an inner <code>let</code>.
</p>

<p>
Actually this is probably best implemented in two parts:
</p>
<ul class="org-ul">
<li>a word that takes a set of bindings and evaluates the values,
leaving a map of word to value</li>
<li>a word that takes the map above and inserts it into the
dictionary. I think <code>lingo</code> does this already.</li>
</ul>

<p>
let's try to write the former here. I think we need <code>map-values</code> type of
thing here, which requires treating a map as a list.
</p>

<div class="org-src-container">
<pre class="src src-kcats">
</pre>
</div>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>+ 5 6<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span>b <span class="org-kcats-brackets">[</span>- 100 8<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>a b +<span class="org-kcats-brackets">]</span>
 let<span class="org-kcats-brackets">]</span> 

</pre>
</div>

<p>
ok round 2 here, let's just do the updating loop first: expect p, a,
n, and modify a in place such that all multples of p are flipped to <code>[]</code>.
</p>

<div class="org-src-container">
<pre class="src src-kcats">10
<span class="org-builtin">clone</span> yes <span class="org-builtin">swap</span> repeat
2

</pre>
</div>

<p>
first though let's just produce the array of indices to mark from p
and n.
</p>

<div class="org-src-container">
<pre class="src src-kcats">10 2
<span class="org-builtin">clone</span> <span class="org-builtin">sink</span> range
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>2 4 6 8<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
now given that and a, mark all those indices
</p>

<div class="org-src-container">
<pre class="src src-kcats">1000 <span class="org-builtin">clone</span> yes <span class="org-builtin">swap</span> repeat 
2
<span class="org-builtin">swapdown</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> * &gt;<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[</span><span class="org-builtin">dropdown</span> <span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> <span class="org-builtin">sink</span> range <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">sink</span> 
  <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[]</span> assign<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]</span>
 when
 inc<span class="org-kcats-brackets">]</span>
<span class="org-preprocessor">while</span>
<span class="org-builtin">drop</span> <span class="org-builtin">drop</span>
indexed
<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
<span class="org-function-name">rest</span> <span class="org-function-name">rest</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71
 73 79 83 89 97 101 103 107 109 113 127 131 137 139 149 151 157 163 167 173
 179 181 191 193 197 199 211 223 227 229 233 239 241 251 257 263 269 271 277 281
 283 293 307 311 313 317 331 337 347 349 353 359 367 373 379 383 389 397 401 409
 419 421 431 433 439 443 449 457 461 463 467 479 487 491 499 503 509 521 523 541
 547 557 563 569 571 577 587 593 599 601 607 613 617 619 631 641 643 647 653 659
 661 673 677 683 691 701 709 719 727 733 739 743 751 757 761 769 773 787 797 809
 811 821 823 827 829 839 853 857 859 863 877 881 883 887 907 911 919 929 937 941
 947 953 967 971 977 983 991 997<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
Now take an array of bools and filter by index
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>yes <span class="org-kcats-brackets">[]</span> yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 1 range <span class="org-builtin">swap</span> zip
<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 2<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
this is too inefficient (copying the whole array due to the shield
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>
<span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[]</span> assign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>

</pre>
</div>

<p>
Need to avoid using shield, as it causes copying of the large array.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> 100 <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>assign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">unwrap</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">100 <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>100 2 3<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e40b3b" class="outline-3">
<h3 id="org0e40b3b"><span class="section-number-3">9.11.</span> <span class="todo TODO">TODO</span> FAQ entry about composability</h3>
<div class="outline-text-3" id="text-9-11">
<p>
Kcats is difficult to use in the same mindset as other languages. The
amount of complexity you can fit into a single function or subroutine,
before it gets too difficult to reason about, is quite a bit
smaller. However kcats is designed to be used this way. The kcats way
is building small combinators, and then using those combinators to
build what you need.
</p>

<p>
Kcats has some distinct advantages here:
</p>
<ul class="org-ul">
<li>The overhead of putting pieces together is basically zero, since
function composition is the default.</li>
<li>Combinators are very easy to test independently.</li>
</ul>

<p>
Kcats makes it easy to test combinators independent of the context
where you will use it. In purely functional code, this is
straightforward: you just place some sample data on the stack and then
the combinator you want to test, then run it.
</p>

<p>
With i/o it's not quite as straightforward. However kcats pipes are
designed to be easily swappable for regular values. Let's say you have
some code that expects to read from a file but you want to test it
without having to maintain state in your local filesystem:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"bar"</span> file-out
<span class="org-function-name">take</span> string
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-kcats-brackets">[[</span>type tunnel<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>values <span class="org-kcats-brackets">[[</span>type bytes<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>to <span class="org-kcats-brackets">[[</span>file <span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]]</span>
</pre>
</div>

<p>
Swap the <code>file-out</code> pipe for a plain list of byte arrays, they
have the same interface, and gives the same result:
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"SGVsbG8gV29ybGQh"</span><span class="org-kcats-brackets">]</span>
<span class="org-function-name">take</span> string
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>

<p>
and of course you can build that byte array out of strings, if you prefer:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"Hello World!"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
<span class="org-function-name">take</span> string

</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"Hello World!"</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>

<p>
This technique works for any use case where you're using a pipe for
its usual take/put/step interface, and timing is not critical.
</p>
</div>
</div>
</div>
<div id="outline-container-orgda3d601" class="outline-2">
<h2 id="orgda3d601"><span class="section-number-2">10.</span> Acknowledgements</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li>Kcats is inspired by <a href="https://en.wikipedia.org/wiki/Joy_(programming_language">Joy</a>, created by Manfred Von Thun.</li>
<li>Tons of implementation ideas taken from <a href="https://joypy.osdn.io/">Thun</a>, a dialect of Joy
written in python by Simon Forman</li>
<li>Many ideas taken from <a href="http://clojure.org">Clojure</a> by Rich Hickey, and other lisp
dialects.</li>
</ul>
</div>
</div>
<div id="outline-container-org7965e74" class="outline-2">
<h2 id="org7965e74"><span class="section-number-2">11.</span> Roadmap Notes</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org12b5f1b" class="outline-3">
<h3 id="org12b5f1b"><span class="section-number-3">11.1.</span> Higher level persistence abstraction</h3>
<div class="outline-text-3" id="text-11-1">
<p>
I wonder whether kcats should have any notion of files and sockets at
all. Sort of like java doesn't have any notion of memory addresses or
malloc/free - it operates at a higher level and handles mem management
for you. Maybe kcats handles persistence for you. This may be a sort
of chicken/egg problem where I need a network protocol to help w
persistence and I want that protocol to include kcats as a
language. Can they be bootstrapped as a single unit? Seems possible
but not easy. Persistence might involve having another party store
data for you, which might involve identity (to limit access) and money
(to incentivize someone to keep your data for later). That might be a
bit of a reach for a programming standard lib to handle.
</p>

<p>
And then there's the question of interop with other programs, how
would they communicate if kcats doesn't know what a file or socket is?
Maybe it can know what a file/socket is but you don't need to use it
except as interop (like clojure's java interop or java's jni).
</p>

<p>
So what would this look like?
</p>

<p>
Instead of telling the program <b>where</b> to persist, you just want it
persisted and you get a sort of claim check (maybe the hash of the
data?). Then to get it back later, you present the claim
check. Persistence is a best-effort deal (you can't be 100% sure no
disaster could wipe it out). So maybe also include some optional
params to indicate:
</p>

<ul class="org-ul">
<li>how long until you might need this again</li>
<li>how long you can wait between requesting it and getting it</li>
<li>how disaster-proof it needs to be</li>
<li>how much you're willing to pay to store it</li>
</ul>

<p>
Maybe we can even put messaging under this model - after all, sending
someone a message is in fact making a copy of data you have. You don't
necessarily want to retrieve it later though.
</p>

<p>
Computing might be better thought of as a worldwide resource - you
might not be able to trust someone else to do a computation for you
(yet, unless it's a specific type where you can verify without doing
the full computation yourself) but you can trust them with storage
(given enough redundancy - they can't steal your data because it's
encrypted).
</p>
</div>
</div>
<div id="outline-container-org1457e39" class="outline-3">
<h3 id="org1457e39"><span class="section-number-3">11.2.</span> Object construction, caching</h3>
<div class="outline-text-3" id="text-11-2">
<p>
Often we create objects similar to java construction, where the input
and output are informationally equivalent (you can reconstruct the
output from the input anytime you want, and sometimes vice versa).
</p>

<p>
It might be nice if kcats didn't force you as a user to do this type
of operation and just let you use the original data.
</p>

<p>
For example, lets say you have <code>[[file "/tmp/foo"]]</code>. That's an
association of <code>file</code> (a type) to a string. Really what that means is
we're referring to a file on disk. In java we'd construct a <code>File</code>
object with <code>new File("/tmp/foo")</code>. It'd be nice if everywhere in
kcats you never needed a <code>File</code> object and could use the original
descriptor instead (or a pipe you've already created, if state
matters). On the jvm platform obviously somewhere a <code>File</code> object
would get created but that should be hidden from view. How would that
work?
</p>

<p>
I thought of a word like <code>derive</code> that caches these things? Maybe it
would keep a cache of previously derived things and just return the
answer if asked again (like memoized function in clojure and could
even be implemented that way). It would also have a mapping of <b>how</b>
to derive one thing from another. eg <code>[[file "foo"]]</code> and create a
pipe-in to write to it. You'd first need an inputstream to the file
(as inputstream is what the pipe protocol is actually using).
</p>

<p>
The thing is, inputstreams are not values. They're stateful, pointers
to places on disk. So we probably can't cache them nor need to.
</p>

<p>
<code>derive</code> would be more for things like crypto keys created from a
seed.
</p>

<p>
For pipes, we need to go from a descriptor, to some platform specific
object, to a pipe. How do we keep platform specific code isolated? I'm
hesitant to make public abstractions for anything but pipes. I don't
want a <code>file</code> word that creates file objects from descriptors, kcats
users should never see that. The only solution I can think of is to
just leave the platform-specific code where it is, and have some kind
of switching mechanism like clj/cljs has.
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Inspired by Alan Kay's quote "Lisp isn't a language, it's a
building material".
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Currently, there is no special standard library functionality
for loading libraries. However you can still do it - if you put
whatever alterations you want in a separate file, let's say
<code>square.kcats</code>, you can load it like this:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"square.kcats"</span> slurp read <span class="org-kcats-brackets">[</span>9 square<span class="org-kcats-brackets">]</span> lingo
</pre>
</div></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Why is it done this way instead of just giving a program and
its expected result? Some results don't have literal representations.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Skyrod Vactai</p>
<p class="date">Created: 2023-10-31 Tue 15:15</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>