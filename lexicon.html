<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-07-16 Tue 22:32 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The kcats Programming Language Lexicon</title>
<meta name="author" content="Skyrod Vactai" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<style> pre.src { background: black; color: white; } #content { max-width: 1000px } </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="doc-custom.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">The kcats Programming Language Lexicon</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8191c9c">1. Standard library source and documentation</a>
<ul>
<li><a href="#orgc7ba9d0">1.1. Comparison</a></li>
<li><a href="#orgb401ce8">1.2. Stack Ops</a>
<ul>
<li><a href="#org97a6917">1.2.1. Motion</a></li>
</ul>
</li>
<li><a href="#org16eba5e">1.3. Program execution</a></li>
<li><a href="#orgc5b3d7e">1.4. Collections</a>
<ul>
<li><a href="#org5854964">1.4.1. Associations</a></li>
<li><a href="#org0202c8f">1.4.2. Sets</a></li>
<li><a href="#org3531fb6">1.4.3. Generators</a></li>
</ul>
</li>
<li><a href="#orgdb2cdd4">1.5. Dictionary modules</a></li>
<li><a href="#orgb0a7a0b">1.6. Math</a></li>
<li><a href="#org907743b">1.7. Serialization</a></li>
<li><a href="#org075f974">1.8. Boolean logic</a></li>
<li><a href="#org1179d66">1.9. Byte encoding and decoding</a></li>
<li><a href="#org7e2fd6e">1.10. Strings</a></li>
<li><a href="#org92607be">1.11. Error handling</a></li>
<li><a href="#org9a0c614">1.12. Methods</a></li>
<li><a href="#org24d010e">1.13. Pipes</a></li>
<li><a href="#org746d68a">1.14. Crypto</a></li>
<li><a href="#org74ed2fa">1.15. Time and date</a></li>
<li><a href="#orgb74cd38">1.16. Nested Environments</a>
<ul>
<li><a href="#org2c24df6">1.16.1. Debugging</a>
<ul>
<li><a href="#orged98b19">1.16.1.1. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbabcb9d">1.17. Templating macro</a></li>
<li><a href="#orgeceae0d">1.18. Functional environment</a></li>
</ul>
</li>
<li><a href="#org9a01d7d">2. Issues</a>
<ul>
<li><a href="#org10d773b">2.1. <span class="done DONE">DONE</span> Get rid of platform-specific definitions</a></li>
<li><a href="#orgb535ec8">2.2. <span class="done DONE">DONE</span> fix evaluate</a></li>
<li><a href="#org498f557">2.3. <span class="todo TODO">TODO</span> merkle tree functions</a></li>
<li><a href="#orgaf6888d">2.4. <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org8191c9c" class="outline-2">
<h2 id="org8191c9c"><span class="section-number-2">1.</span> Standard library source and documentation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgc7ba9d0" class="outline-3">
<h3 id="orgc7ba9d0"><span class="section-number-3">1.1.</span> Comparison</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Words that help compare one item to another, with concepts of <code>equal</code>, <code>greater</code>, <code>less</code> etc.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[</span>1 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 1.0 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[[]]]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[[]]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"there"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[</span>\h \h =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>\h \i =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"hi"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"there"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>

               <span class="org-kcats-brackets">[[[]</span> yes =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]</span> set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>compare <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"a"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>1 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>2 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>greater<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"foo"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-function-name">unwrap</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO these should be in terms of compare and not limited to numbers</span>
<span class="org-kcats-brackets">[</span>&lt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>&lt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                <span class="org-kcats-brackets">[[</span>1 2.2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>min <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>max <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.3<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgb401ce8" class="outline-3">
<h3 id="orgb401ce8"><span class="section-number-3">1.2.</span> Stack Ops</h3>
<div class="outline-text-3" id="text-1-2">
<div class='tangle-wrapper' data-tangle='src/kcats/core/stack-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>1 2 3 <span class="org-kcats-brackets">[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list *<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-builtin">evert</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 5 4 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/stack.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>clonedown <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 clonedown<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>clonedeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>clonedown<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 clonedeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3 4<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>over <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>clonedown <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 over<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>under <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-builtin">sink</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 under<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dropdeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 dropdeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Save the whole stack as a list on the stack"</span><span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">evert</span> <span class="org-builtin">clone</span> <span class="org-builtin">evert</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>restore <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-string">"y"</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> restore<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[]</span> restore<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org97a6917" class="outline-4">
<h4 id="org97a6917"><span class="section-number-4">1.2.1.</span> Motion</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
These words change the order of items on the stack.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 1 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">sink</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>flip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 flip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-org16eba5e" class="outline-3">
<h3 id="org16eba5e"><span class="section-number-3">1.3.</span> Program execution</h3>
<div class="outline-text-3" id="text-1-3">
<div class='tangle-wrapper' data-tangle='src/kcats/core/execute-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>2 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> 4 <span class="org-builtin">swap</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">branch</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>item condition<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 yes <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>6 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">recur</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program rec2<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program rec1<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3
                     <span class="org-kcats-brackets">[</span>1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> *<span class="org-kcats-brackets">]</span>
                     <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">loop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item flag<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 yes <span class="org-kcats-brackets">[</span>-2 * <span class="org-builtin">clone</span> 50 &lt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>160<span class="org-kcats-brackets">]]]]]]</span>


<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 8 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 8<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>
                   <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: This depends on `if` so might need to move elsewhere, maybe Methods?</span>
<span class="org-kcats-brackets">[</span>decide <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list test-expr-pairs<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Takes a list of choices (pairs of test, program) and</span>
<span class="org-string">                executes the first program whose test passes. if none</span>
<span class="org-string">                pass, returns 'nothing'. Stack is reset between</span>
<span class="org-string">                testing conditions."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>5 <span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[</span>9 <span class="org-string">"something else"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>9 <span class="org-kcats-brackets">[]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/execute.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>decorate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>foo bar<span class="org-kcats-brackets">]</span> decorate<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>1 inc<span class="org-kcats-brackets">]</span> foo<span class="org-kcats-brackets">]</span> bar<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>decorated <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>decorate <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bail <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: implement as axiom (which would depend on 'restore' which should also be axiom?)</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Runs program keeping top of stack produced but protects existing items from being consumed."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-preprocessor">inject</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 <span class="org-kcats-brackets">[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddeep</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program p<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item consumed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item consumed<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>item result<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>+ +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 6<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">if</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>6 <span class="org-kcats-brackets">[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>when <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>3 <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: drop dependency on 'decorated'</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
                  <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">dip</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dipdeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
                  <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> dipdeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3 4<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 9<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 11<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>divedeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> divedeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 7 8 9<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">inject</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program list<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Inject the quoted program into the list below</span>
<span class="org-string">                     it (runs the program with the list as its</span>
<span class="org-string">                     stack).  Does not affect the rest of the stack."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">evert</span> <span class="org-function-name">take</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">evert</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>26<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">add shield to the pred program</span>
                     <span class="org-builtin">clone</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run it on the previous ToS</span>
                     <span class="org-function-name">join</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1 0<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">until</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pred body</span>
                     <span class="org-kcats-brackets">[</span>not<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">reverse logic</span>
                     <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">add shield to the pred program -&gt; pred body</span>
                     <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">[body ..  pred]</span>
                     yes <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run at least once</span>
                     <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>prime <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program init<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-builtin">float</span> <span class="org-function-name">join</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">times</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program body<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span>
                     <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">build [dec body dip]</span>
                     <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                     <span class="org-preprocessor">while</span>
                     <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>5<span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 5 5<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1 1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>primrec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program rec1<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>program exit<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>number data<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add execute to rec1 to be recurs rec2</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add drop to exit condition</span>
                       <span class="org-kcats-brackets">[[</span>zero?<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dipdown</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">put the condition on bottom</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add the r1</span>
                       <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">now its generic recur</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> primrec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                  <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgc5b3d7e" class="outline-3">
<h3 id="orgc5b3d7e"><span class="section-number-3">1.4.</span> Collections</h3>
<div class="outline-text-3" id="text-1-4">
<div class='tangle-wrapper' data-tangle='src/kcats/core/collections-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> <span class="org-string">"cd"</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> encode <span class="org-string">"cd"</span> encode <span class="org-function-name">join</span> <span class="org-string">"abcd"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-kcats-brackets">[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a g<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association  <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">""</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item receptacle<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> 1 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]</span>
                 <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> \d <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"food"</span><span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode 32 <span class="org-function-name">put</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo "</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"cd"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> encode <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\f<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">last</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>3 4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">last</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item dispenser<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item ordered<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 2 1<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"321"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>slice <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foobar"</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 0 7 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>a b c d e<span class="org-kcats-brackets">]</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>cut <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> slice<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>0 <span class="org-builtin">swap</span> slice<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
                   <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcdefghijklmnopqrstuvwxyz"</span> 5 cut<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"fghijklmnopqrstuvwxyz"</span> <span class="org-string">"abcde"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>empty <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> association<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> set<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>range <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 5 1 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[[</span>3 13 3 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 6 9 12<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>empty? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>1 empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[[]</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>pad <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item padding<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer newsize<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                   <span class="org-builtin">swap</span> repeat
                   <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 5 0 pad<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 0 1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>list? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[]</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>5 list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>sort-indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/collections.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>something? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span> 
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>empty? not<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[]</span> something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                        <span class="org-kcats-brackets">[[[]</span> something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>butlast <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> butlast<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>prepend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item list<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2<span class="org-kcats-brackets">]</span> 3 prepend<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 1 2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>every? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                       <span class="org-kcats-brackets">[]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> every?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> yes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>12 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12 yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>any? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> boolean<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                     <span class="org-kcats-brackets">[]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> any?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[</span>3 5 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                  <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                  <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>3 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>-15 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-15 yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">map</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put empty results below list</span>
                   <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">run map fn shielded and dipped under result</span>
                   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> prepend <span class="org-comment-delimiter">;; </span><span class="org-comment">start by swapping the result back to the top</span>
                   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">end by adding this result to result list</span>
                   <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>

      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 4<span class="org-kcats-brackets">]]]</span>

                 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]]]</span>
                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ *<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>70 77 84<span class="org-kcats-brackets">]]]</span>
                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>7 7 7<span class="org-kcats-brackets">]]]</span>

                 <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 1 inc<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 2 2<span class="org-kcats-brackets">]]]</span>
                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">filter</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put empty results below list</span>
                      <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">run filter fn shielded and dipped under result</span>
                      <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> prepend <span class="org-comment-delimiter">;; </span><span class="org-comment">start by swapping the result back to the top</span>
                      <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">end by checking pred, add to result</span>
                      <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 3<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[</span>33 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 + odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>sort <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> **1 pair<span class="org-kcats-brackets">]</span> template
                    <span class="org-function-name">map</span> sort-indexed<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 3 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Carol"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Alice"</span> <span class="org-string">"Bob"</span> <span class="org-string">"Carol"</span><span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Charlie"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Bob"</span> <span class="org-string">"Alice"</span> <span class="org-string">"Charlie"</span><span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>repeat <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                 item<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> 3 repeat<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> <span class="org-string">"hi"</span><span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 1 range <span class="org-builtin">swap</span> zip<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> indexed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>indexer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>indexer<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>indexof <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>indexer<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">use wrap so we can find index of words,</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise the word gets executed</span>
                       <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-function-name">wrap</span> =<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">wrap</span> <span class="org-function-name">put</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span>
                       keep generate <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> indexof<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> indexof<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>interpose <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> flip
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> pair <span class="org-function-name">join</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
                         <span class="org-builtin">drop</span> <span class="org-function-name">pop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo bar baz<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo <span class="org-string">"hi"</span> bar <span class="org-string">"hi"</span> baz<span class="org-kcats-brackets">]]]</span>
                       <span class="org-kcats-brackets">[[[]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                       <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>starts? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>zip <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"ab"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>ends? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> both starts?<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"cd"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>pair <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>pair? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span> recover<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"ab"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[[]</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>7 pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>triplet <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]</span> triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>both? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> pair <span class="org-builtin">swap</span> every?<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>1 3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>both <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>walk <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program item-transform<span class="org-kcats-brackets">]</span> list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>list? not<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                    <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-function-name">step</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-preprocessor">recur</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>inc <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> walk<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 <span class="org-kcats-brackets">[</span>4 <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> 7<span class="org-kcats-brackets">]]]]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> inc pair<span class="org-kcats-brackets">]</span> walk<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 2 3 <span class="org-kcats-brackets">[</span>3 4 <span class="org-kcats-brackets">[</span>4 5 5 6<span class="org-kcats-brackets">]</span> 6 7<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>template <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list template<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">build a map of word like *1, *2 etc to values on the stack</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Do a separate entry for **1, **2, etc which means to splice the value</span>
                         <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> inc 1 1 <span class="org-builtin">swapdown</span> range
                         <span class="org-kcats-brackets">[</span><span class="org-string">"*"</span> <span class="org-string">"**"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>string <span class="org-function-name">join</span> word<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
                         <span class="org-function-name">unwrap</span> <span class="org-function-name">join</span> <span class="org-builtin">dropdown</span> 
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> zip association<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>

                        <span class="org-comment-delimiter">;; </span><span class="org-comment">save copy of template</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>

                        <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span> get<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> prepend <span class="org-function-name">wrap</span>
                         <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> 
                          <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                         walk<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">find the highest index placeholder</span>
                        flatten set 0 <span class="org-builtin">swap</span> 
                        <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">try to parse as a placeholder and get the index</span>
                         <span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[</span><span class="org-string">"*"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span>
                          <span class="org-kcats-brackets">[</span>number max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> recover<span class="org-kcats-brackets">]</span> 
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">drop that many items from the stack</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-builtin">float</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>
                        <span class="org-kcats-brackets">[</span>*2 <span class="org-kcats-brackets">[</span>*1 x **2<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]</span> template<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar x foo<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>flatten <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>list? not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]</span> f<span class="org-kcats-brackets">]</span> g<span class="org-kcats-brackets">]</span> flatten<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e f g<span class="org-kcats-brackets">]]]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org5854964" class="outline-4">
<h4 id="org5854964"><span class="section-number-4">1.4.1.</span> Associations</h4>
<div class="outline-text-4" id="text-1-4-1">
<div class='tangle-wrapper' data-tangle='src/kcats/core/associations-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>get <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[</span>10 11 12 13<span class="org-kcats-brackets">]</span> 1 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\b<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>98<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>assign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item value<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span>
                 sized<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[]]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d 5<span class="org-kcats-brackets">]]</span> association assign<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>1 1 0<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 0<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> 3<span class="org-kcats-brackets">]]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>a 0<span class="org-kcats-brackets">]</span> 10 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>10 2 3<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>unassign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item key<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>a d<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[]</span> association <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> assign<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[</span>0 1 2 <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>3 c<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>0 1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>association? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                          <span class="org-kcats-brackets">[[</span>1 association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                          <span class="org-kcats-brackets">[[[]</span> association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                          <span class="org-kcats-brackets">[[[]</span> association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 1 assign association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 1 assign association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>association <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[]]]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>

                          <span class="org-kcats-brackets">[[]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/associations.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">Associative words</span>
<span class="org-kcats-brackets">[</span>update <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">m ks v p</span>
                      <span class="org-preprocessor">shielddown</span>
                      assign<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 3<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 3 5 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>1 3 6 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 10 15<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6 +<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>lookup <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list keys<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">keylist not empty</span>
                      <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>get<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">extract the first key and lookup</span>
                      <span class="org-preprocessor">while</span>
                      <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>b<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[[[</span>outer <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>outer c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: fix the case where you just want a value [[type foo]] - only</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">one item but you want the value, not key</span>
<span class="org-kcats-brackets">[</span>type <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>error?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>type<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                                       <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span>
                                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>type<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                                         <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                                         <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                                         <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                                        <span class="org-kcats-brackets">[[]]</span>
                                        <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                                       <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                                      <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]</span>
                    decide <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>1 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>1.0 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[]</span> type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>attr1 foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr2 <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>url<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>value <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if it's a single item</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the value is the value of that first item</span>
                     <span class="org-kcats-brackets">[[</span>value<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise look up the key 'value'</span>
                     <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>

                   <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]]]]]</span>
<span class="org-kcats-brackets">[</span>zip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dispenser values<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dispenser keys<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[]]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add empty result below ToS</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">take the next key, wrap it</span>
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">to make a "pair" (adding</span>
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">value later)</span>
                    <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run that underneath the current value</span>
                    <span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the value into the "pair" we created earlier</span>
                    <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add the new pair to the results</span>
                   <span class="org-function-name">step</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">through all the values</span>
                   <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the now-empty list of keys</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> zip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>label <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized labels<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">labels acc</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-builtin">float</span> assign<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"Alice"</span> 23 <span class="org-string">"123 Main St"</span> <span class="org-kcats-brackets">[</span>address age name<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>address <span class="org-string">"123 Main St"</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>age 23<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>definition<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> dictionary <span class="org-builtin">swap</span> lookup<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>flip<span class="org-kcats-brackets">]</span> definition <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org0202c8f" class="outline-4">
<h4 id="org0202c8f"><span class="section-number-4">1.4.2.</span> Sets</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/sets-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">TODO add 'set' type for spec?</span>
<span class="org-kcats-brackets">[[</span>set <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>set? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>contains? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item container<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[</span>1 2 3 3 5<span class="org-kcats-brackets">]</span> set 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>intersection <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> intersection<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org3531fb6" class="outline-4">
<h4 id="org3531fb6"><span class="section-number-4">1.4.3.</span> Generators</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/generators.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">infinite sequence (generators) functions</span>

<span class="org-kcats-brackets">[[</span>generate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program item<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> generate<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>liberate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>assemble <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program generators<span class="org-kcats-brackets">]</span> dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">join</span> <span class="org-kcats-brackets">[</span>collect<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span> keep<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 3 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>into <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">n</span>
                     <span class="org-builtin">swap</span> <span class="org-builtin">clone</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">n n r</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r</span>
                      <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r n</span>
                      <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">n n r</span>
                     <span class="org-preprocessor">loop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>\a \b \c \d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-string">""</span> into<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>0 10 1 range <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                      5 dropper
                      <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                      <span class="org-kcats-brackets">[]</span> into<span class="org-kcats-brackets">]</span>
                     <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>50 60 70 80 90<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>collect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> into<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                      <span class="org-kcats-brackets">[[[</span>0 10 1 range <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                         5 dropper
                         <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                         collect<span class="org-kcats-brackets">]</span>
                        <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>50 60 70 80 90<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>each <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                     <span class="org-kcats-brackets">[</span>bail <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> decorate
                     <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> *<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span>
                     assemble<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>1 4 9 16<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span>
                        <span class="org-kcats-brackets">[]</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span>
                         <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span>
                        <span class="org-preprocessor">while</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 9<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span>
                       assemble<span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 6 7 8 9<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>taker <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>3 taker<span class="org-kcats-brackets">]</span>
                      assemble<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>catcher <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                         <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail not<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span>
                         when<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 -4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> catcher<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>dropper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>positive?<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
                          <span class="org-preprocessor">while</span>
                          <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
                         bail<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>3 dropper<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>skipper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the state (whether threshold reached)</span>
                        <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">condition - whether we've finished dropping or not</span>
                         <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">true - pass everything else through</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">false - generate, check pred, repeat</span>
                         <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prime init</span>
                          <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bring pred up and exec it</span>
                          <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if pred passes drop the value</span>
                          prime <span class="org-comment-delimiter">;; </span><span class="org-comment">after this should have value on top</span>
                          <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                         <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 -3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> skipper<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>-3 4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>keep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>not<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                     <span class="org-kcats-brackets">[</span>something?<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> pair <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pred that also checks for nothing first</span>
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                      <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pred 1</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> generate<span class="org-kcats-brackets">]</span>
                       <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
                      <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span> keep<span class="org-kcats-brackets">]</span>
                     assemble<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>1 3 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>group <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program group-by<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span>
                      <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">k v state</span>
                       <span class="org-function-name">wrap</span> <span class="org-builtin">swap</span>  <span class="org-comment-delimiter">;;  </span><span class="org-comment">v k state</span>
                       <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> update<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                      <span class="org-kcats-brackets">[]</span> association <span class="org-comment-delimiter">;; </span><span class="org-comment">state f</span>
                      <span class="org-builtin">swap</span> cram<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> liberate <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> group<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>yes <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>2 4<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>split <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program sized sized<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorated
                      <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span> ends? not<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> prime
                       <span class="org-builtin">drop</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> ends?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-builtin">swap</span> - <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> slice<span class="org-kcats-brackets">]</span>
                       when
                       <span class="org-kcats-brackets">[</span>empty<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcabc"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"b"</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"ca"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3 4 2 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]]]</span>


 <span class="org-kcats-brackets">[</span>partition <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span>
                          <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[[</span>taker collect
                                         <span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">drop the used-up taker generator</span>
                                        <span class="org-function-name">join</span> divedeep<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[</span>shift <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span> &lt;=<span class="org-kcats-brackets">]</span>
                                    <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 0 slice<span class="org-kcats-brackets">]</span>
                                    <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
                          <span class="org-kcats-brackets">[[]</span>
                           <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> shift<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> shift<span class="org-kcats-brackets">]</span>
                           <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                          let<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5 6 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>combinations <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> -1 <span class="org-comment-delimiter">;; </span><span class="org-comment">l idx i</span>
                             <span class="org-kcats-brackets">[[[</span><span class="org-builtin">swap</span> <span class="org-function-name">count</span> =<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-function-name">take</span> 0 <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> when
                              <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>combinations<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>frequencies <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> association
                            <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                            cram<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"Hello there!"</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> frequencies<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[[</span>\space 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\! 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\H 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\e 3<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\h 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\l 2<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\o 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\r 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\t 1<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>fold <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">-&gt; [+ clone] to build the 'then' branch</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">build the loop body</span>
                     <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[]]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-kcats-brackets">[</span>when<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">generate the first item under the loop body</span>
                     <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                     <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers 1 dropper 10 taker <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> fold<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>cram <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>item initial-value<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[]</span>
                     <span class="org-builtin">float</span> prime <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers 1 dropper 10 taker 0 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> cram<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>pairwise <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[]</span> <span class="org-builtin">evert</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">capture stack</span>
                          <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pair up stack items</span>
                         <span class="org-preprocessor">inject</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run the program on the pairs</span>
                         <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> assemble <span class="org-comment-delimiter">;; </span><span class="org-comment">unpair the items</span>
                         <span class="org-function-name">unwrap</span> <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span> <span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">restore as the stack</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 4 5 2 3<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span><span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4 5 1<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span><span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 5 9<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>integers <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>-1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-orgdb2cdd4" class="outline-3">
<h3 id="orgdb2cdd4"><span class="section-number-3">1.5.</span> Dictionary modules</h3>
<div class="outline-text-3" id="text-1-5">
<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>dictionary <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>cache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>decache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>hashbytes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode hashbytes<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode hashbytes
                         <span class="org-string">"fop"</span> encode hashbytes
                         =<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>dictmerge <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dictionary module<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dictionary original<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>updates <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized word-updates<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program single-update<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> update <span class="org-comment-delimiter">;; </span><span class="org-comment">wrap the word name to get a path to update</span>
                         <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> each
                        joiner generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>entry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program definition<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>association full-entry<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>definition<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]]]]</span>

<span class="org-comment-delimiter">; </span><span class="org-comment">[draft [[spec [[[sized bindings]] [[program dictionary-updater]]]]</span>
<span class="org-comment-delimiter">;         </span><span class="org-comment">[definition [[entry] map updates]]</span>
<span class="org-comment-delimiter">;         </span><span class="org-comment">[examples [[[[[swap [5]]]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">["a" "b" "c" swap]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">draft]</span>
<span class="org-comment-delimiter">;                     </span><span class="org-comment">["a" "b" "c" 5]]</span>

<span class="org-comment-delimiter">;                    </span><span class="org-comment">[[[[swap [5]]]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">[["hi"] 3 times swap]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">draft]</span>
<span class="org-comment-delimiter">;                     </span><span class="org-comment">["hi" "hi" "hi" 5]]</span>

<span class="org-comment-delimiter">;                    </span><span class="org-comment">[[[[swap [5 swap]]]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">[["hi"] 3 times swap]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">draft ]</span>
<span class="org-comment-delimiter">;                     </span><span class="org-comment">["hi" "hi" 5 "hi"]]</span>

<span class="org-comment-delimiter">;                    </span><span class="org-comment">[[[[foo ["foo"]]]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">[foo</span>
<span class="org-comment-delimiter">;                       </span><span class="org-comment">[[foo ["bar" put]]]</span>
<span class="org-comment-delimiter">;                       </span><span class="org-comment">[foo]</span>
<span class="org-comment-delimiter">;                       </span><span class="org-comment">revise]</span>
<span class="org-comment-delimiter">;                      </span><span class="org-comment">draft]</span>
<span class="org-comment-delimiter">;                     </span><span class="org-comment">["foo" "bar"]]]]]]  </span>

<span class="org-comment-delimiter">; </span><span class="org-comment">[using [[spec [[program [list namespaces]] [*]]]</span>
<span class="org-comment-delimiter">;         </span><span class="org-comment">[definition [resolve execute]]]]</span>

<span class="org-kcats-brackets">[</span>module <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item wrapped-module-alias-or-hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"reads a cached stdlib module from disk and puts it on the stack as a program"</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>decache string read <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"123"</span> encode <span class="org-kcats-brackets">[</span>crypto<span class="org-kcats-brackets">]</span> stdmod <span class="org-kcats-brackets">[</span>hash<span class="org-kcats-brackets">]</span> confine<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"pmWkWSBCL51Bfkhn79xPuKBKHz//H6B+mY6G9/eieuM="</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inscribe <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program module<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dictionary <span class="org-builtin">swap</span> <span class="org-preprocessor">shield</span> dictmerge<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>draft <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized definitions<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program dictionary-updater<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>entry<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">create full entries for each definition</span>
                     <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">add 'join' to join the entries with the existing dictionary</span>

<span class="org-kcats-brackets">[</span>let <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program p<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>program dictionary-modifier<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>draft dictionary <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>emit encode hashbytes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
                    <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                    <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>dictmerge<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">under the let program ;; prog dict hash</span>
                   <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">wrap the hash to make a list of 1 namespace</span>

                   <span class="org-kcats-brackets">[</span>program dictionary resolver<span class="org-kcats-brackets">]</span> label environment <span class="org-comment-delimiter">;; </span><span class="org-comment">creates closure</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">when the closure executes, capture the outer stack first</span>
                   <span class="org-function-name">wrap</span>
                   <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> assign evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">]</span> 
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>times5 <span class="org-kcats-brackets">[</span>5 *<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>doubledec <span class="org-kcats-brackets">[</span>dec dec<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span>3 times5 doubledec<span class="org-kcats-brackets">]</span> let <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>13<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                   let <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> 5<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgb0a7a0b" class="outline-3">
<h3 id="orgb0a7a0b"><span class="section-number-3">1.6.</span> Math</h3>
<div class="outline-text-3" id="text-1-6">
<div class='tangle-wrapper' data-tangle='src/kcats/core/math-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 + 3.3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3.2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>- <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 -<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 - -1.1 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 - 1.2 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>10 1.5 * 15 0.0001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 0 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 -1 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>/ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 3 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>15 1.5 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10.0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>0 1 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 0 / handle <span class="org-kcats-brackets">[</span>reason<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 <span class="org-string">"division by zero"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>quot <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>16 5 quot<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>rem <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 rem<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>mod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 mod<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>exp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 5 exp<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>32<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>log <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>32 2 log<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>floor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 floor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>ceiling <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 ceiling<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>round <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 round<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sqrt <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>9 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>81 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>9<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inc <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>99 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>100<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>100 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>99<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>abs <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2.1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-0.2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>odd? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>-1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>4 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>even? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>3 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>zero? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>0.0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-0.00001 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>1.1 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>number? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[[]</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[</span>5 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>5.01 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>number <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"-11.1"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-11.1<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-function-name">first</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>97<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/math.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>positive? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>negative? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &lt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>within? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>- abs<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &lt;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1.0 2.0 + 3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org907743b" class="outline-3">
<h3 id="org907743b"><span class="section-number-3">1.7.</span> Serialization</h3>
<div class="outline-text-3" id="text-1-7">
<div class='tangle-wrapper' data-tangle='src/kcats/core/serialize-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>read <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[1 [2] 3]"</span> read<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>emit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]</span> emit<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1 [2] 3"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>autoformat <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[[foo bar] [baz [[quux floop] [toop zoop]]]]"</span> autoformat<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"[[foo bar]\n [baz [[quux floop]\n       [toop zoop]]]]"</span><span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org075f974" class="outline-3">
<h3 id="org075f974"><span class="section-number-3">1.8.</span> Boolean logic</h3>
<div class="outline-text-3" id="text-1-8">
<div class='tangle-wrapper' data-tangle='src/kcats/core/boolean-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>yes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">self-inserts</span>

<span class="org-kcats-brackets">[</span>and <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 2 even? and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>2 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[]</span> 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>or <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 3 even? or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[[]</span> 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>not <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 even? not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[]</span> not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>yes not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                 <span class="org-kcats-brackets">[[[]</span> not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org1179d66" class="outline-3">
<h3 id="org1179d66"><span class="section-number-3">1.9.</span> Byte encoding and decoding</h3>
<div class="outline-text-3" id="text-1-9">
<div class='tangle-wrapper' data-tangle='src/kcats/core/encode-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>encodestring <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodenumber <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw="</span><span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>12.3 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"QCiZmZmZmZo="</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>decodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"12.01"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12.01<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"\"foo\""</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"{\"foo\": 12, \"bar\": \"baz\"}"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"[1,\"foo\"]"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>12.01 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12.01"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"\"foo\""</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association encodejson decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1,\"foo\"]"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bytes? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Zm9v"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>xor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 12 xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">10 = 01010, 12 = 01100, 00110, 6</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"bar"</span> encode xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"BA4d"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bits <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>encode <span class="org-kcats-brackets">[[</span>2 radix 8 0 pad<span class="org-kcats-brackets">]</span> each joiner<span class="org-kcats-brackets">]</span> assemble <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bits<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 1 0 0 1 1 0 0 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1<span class="org-kcats-brackets">]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/encode.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>encode <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]</span>
                        <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encodestring<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encodenumber<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>emit encode<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw="</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>radix <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>/<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span>
                       <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span>
                       <span class="org-builtin">swapdown</span> -
                       <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>prepend<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                      <span class="org-builtin">swap</span> prepend
                      <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span>
                      <span class="org-preprocessor">while</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>7 2 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 1 1<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>9 3 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 0 0<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>255 16 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>15 15<span class="org-kcats-brackets">]]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org7e2fd6e" class="outline-3">
<h3 id="org7e2fd6e"><span class="section-number-3">1.10.</span> Strings</h3>
<div class="outline-text-3" id="text-1-10">
<div class='tangle-wrapper' data-tangle='src/kcats/core/strings-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1 2 3]"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>format <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo {} bar {} baz"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span> <span class="org-string">"def"</span><span class="org-kcats-brackets">]</span> format<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo abc bar def baz"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>string? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[</span>yes string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Don't really belong here but good enough for now</span>
<span class="org-kcats-brackets">[</span>word? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>yes word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1 word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"yes"</span> word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>word <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inspect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org92607be" class="outline-3">
<h3 id="org92607be"><span class="section-number-3">1.11.</span> Error handling</h3>
<div class="outline-text-3" id="text-1-11">
<div class='tangle-wrapper' data-tangle='src/kcats/core/errors-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>error? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">handle is a special word only used to unwind the program on</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">error, if there's no error and we end up reaching this word, we</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">ignore it.</span>
<span class="org-kcats-brackets">[</span>handle <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

<span class="org-kcats-brackets">[</span>fail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/errors.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>assert <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">save stack to print in err message</span>
                       <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run the assertion under the saved stack</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if passes, drop the saved stack, dont need</span>
                       <span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[</span><span class="org-string">"assertion failed "</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">join</span> fail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">else throw err</span>
                       <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>recover <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>handle<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add handle to the end of test</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">rec test ss</span>
                        <span class="org-builtin">sink</span> <span class="org-preprocessor">inject</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">res rec</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> error?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">err? res rec</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-builtin">swap</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span><span class="org-comment-delimiter">;; </span><span class="org-comment">drop the snapshot and run recovery</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">use snapshot as stack</span>
                        <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>+<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 1
                         <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 2 +<span class="org-kcats-brackets">]</span>
                         recover<span class="org-kcats-brackets">]</span>
                        recover<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-string">"oh fudge"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>5 +<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 5<span class="org-kcats-brackets">]</span>
                         recover<span class="org-kcats-brackets">]</span>
                        <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>6 7 5<span class="org-kcats-brackets">]]]</span>

                      <span class="org-kcats-brackets">[[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> recover<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>retry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>unwound<span class="org-kcats-brackets">]</span> lookup
                      <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 <span class="org-string">"four"</span> * + handle <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 4<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> retry<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>14<span class="org-kcats-brackets">]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org9a0c614" class="outline-3">
<h3 id="org9a0c614"><span class="section-number-3">1.12.</span> Methods</h3>
<div class="outline-text-3" id="text-1-12">
<p>
We want a way of adding methods to a word that's already set up as a
simple 'decide' form. This will add the method at the beginning -
adding it at the end is not good because often there's a catchall
condition at the end, and adding beyond that means the new condition
is unreachable. Adding at the beginning is not always what the user
wants either, though. So maybe this could be improved by taking
another argument: a program to combine the item and the existing list
(that defaults to <code>prepend</code> here).
</p>
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/methods.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>addmethod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program method<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program definition<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>program newdefinition<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>pair <span class="org-comment-delimiter">;; </span><span class="org-comment">[c b] [[[...]] decide]</span>
                          <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>prepend<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-kcats-brackets">[[</span>0<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> update<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[[[</span><span class="org-function-name">count</span> 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]</span> decide<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> addmethod<span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]</span>
                           decide<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>method? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>pair?<span class="org-kcats-brackets">]</span>
                                 <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]]</span> every?<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>decide<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]]</span>
                        every?<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org24d010e" class="outline-3">
<h3 id="org24d010e"><span class="section-number-3">1.13.</span> Pipes</h3>
<div class="outline-text-3" id="text-1-13">
<div class='tangle-wrapper' data-tangle='src/kcats/core/pipes-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>pipe? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>timestamps pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>standard pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>5 pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>animate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>

<span class="org-kcats-brackets">[</span>attend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>handoff <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>receiver <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>select <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list pipes<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item pipe <span class="org-kcats-brackets">[</span>list pipes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sender <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>serversocket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>socket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>standard <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timestamps <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>database <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized params<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>

<span class="org-kcats-brackets">[</span>persist <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/pipes.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>pipe-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                        <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>value file-in<span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]]]</span>
                        decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>tunnel <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                       <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                          serversocket<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-client<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                          socket<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>pipe-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                         <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span>value file-out<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                            <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                            <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                            serversocket<span class="org-kcats-brackets">]]]</span>
                         decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>spit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item target<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pipe-in<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> encode <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>slurp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> fold string <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>print <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>standard<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-string">"\n"</span> <span class="org-function-name">join</span> encode <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-comment-delimiter">;;</span><span class="org-comment">[slurp [[spec [[[item target]] [item pipe]]]]]</span>

 <span class="org-kcats-brackets">[</span>sleep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>timer <span class="org-function-name">take</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>future <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>handoff <span class="org-builtin">swap</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">return entire stack</span>
                       <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dive</span> <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                       dictionary <span class="org-builtin">swap</span> spawn animate<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 +<span class="org-kcats-brackets">]</span> future <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>generator <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program generator-maker<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program wrapped-generator<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-preprocessor">inject</span>
                          <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">generate from the wrapped generator</span>

 <span class="org-kcats-brackets">[</span>siphon <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>receptacle output<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>receptacle output<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>description <span class="org-string">"Generates values from a wrapped generator (stacked generator inside a list), until exhausted, puts all items into the output receptacle"</span><span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">placeholder that gets dropped (next</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">iteration it will hold a copy of the last</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">element which is only needed to check if</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">the loop continues and can be dropped</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">after)</span>
                       <span class="org-kcats-brackets">[</span>empty?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">stop when generator returns</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">nothing</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the last value</span>
                        <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                        <span class="org-builtin">sink</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                       <span class="org-preprocessor">until</span>
                       <span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-builtin">sink</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the now-empty dispenser</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>integers 5 taker<span class="org-kcats-brackets">]</span> generator <span class="org-kcats-brackets">[]</span> siphon<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 2 3 4<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>close <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org746d68a" class="outline-3">
<h3 id="org746d68a"><span class="section-number-3">1.14.</span> Crypto</h3>
<div class="outline-text-3" id="text-1-14">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>random <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>key <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode key<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes message<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association key<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>verify <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes signature<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>bytes message<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>sized key<span class="org-kcats-brackets">]]</span>

                <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> encode key <span class="org-string">"we attack at dawn"</span> encode <span class="org-kcats-brackets">[</span>sign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> verify<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>delegated <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>association pubkey<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">css cs pk</span>
                            <span class="org-kcats-brackets">[[</span>hash<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated <span class="org-comment-delimiter">;; </span><span class="org-comment">css csh cs pk</span>
                             <span class="org-builtin">float</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">cs css csh pk</span>
                             <span class="org-kcats-brackets">[</span>verify<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                             <span class="org-kcats-brackets">[[]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the program to run if the child script isn't authorized</span>
                             <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">runs the child script if the sig on its hash is verified</span>
                            <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the sig and (empty) child script -&gt; pk sig msg</span>
                             <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">sig msg pk</span>
                             verify<span class="org-kcats-brackets">]</span>
                            <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[]]</span> recover<span class="org-kcats-brackets">]</span>
                          <span class="org-builtin">swap</span> prepend<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prepend the pubkey</span>

 <span class="org-kcats-brackets">[</span>hash <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>hashbytes<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encode hash<span class="org-kcats-brackets">]]]</span>
                     decide<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org74ed2fa" class="outline-3">
<h3 id="org74ed2fa"><span class="section-number-3">1.15.</span> Time and date</h3>
<div class="outline-text-3" id="text-1-15">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/time.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>milliseconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

 <span class="org-kcats-brackets">[</span>seconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>1000 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>minutes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>seconds 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>hours <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>minutes 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>days <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>hours 24 *<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgb74cd38" class="outline-3">
<h3 id="orgb74cd38"><span class="section-number-3">1.16.</span> Nested Environments</h3>
<div class="outline-text-3" id="text-1-16">
<div class='tangle-wrapper' data-tangle='src/kcats/core/environment-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>environment <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> environment eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment
                         eval-<span class="org-function-name">step</span> eval-<span class="org-function-name">step</span>
                         <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>evaluate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>14 1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>finished? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[]]]</span>
                      <span class="org-kcats-brackets">[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>using <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list modules<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/environment.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>tos <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
                   tos<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO we don't use the term 'expression' anymore so this needs renaming</span>
<span class="org-kcats-brackets">[</span>toe <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
                   toe<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>stage <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> label environment<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>spawn <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p d s</span>
                     <span class="org-kcats-brackets">[</span>program dictionary stack<span class="org-kcats-brackets">]</span> label
                     environment<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 dictionary <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> spawn<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]</span> environment<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>confine <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program module<span class="org-kcats-brackets">]</span> dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>spawn evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]]]]</span>

</pre>
</div></div>
</div>
<div id="outline-container-org2c24df6" class="outline-4">
<h4 id="org2c24df6"><span class="section-number-4">1.16.1.</span> Debugging</h4>
<div class="outline-text-4" id="text-1-16-1">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/debug.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>break <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span><span class="org-builtin">swap</span> something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">still running</span>
                        <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> not<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">check condition not true yet</span>
                       <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
                       every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
                      <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                      <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>breakpoint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
              <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

 <span class="org-kcats-brackets">[</span>sprint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>program 0<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>breakpoint<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> break
                       <span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the condition</span>
                       <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">advance past the breakpoint word if the program isn't complete</span>


 <span class="org-kcats-brackets">[</span>advance <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">count up the program length, we'll run until it's smaller than this</span>

                        <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">only stop if expr empty or shorter than we started off</span>
                         <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&lt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                        <span class="org-preprocessor">while</span>
                        <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the program length item</span>

 <span class="org-kcats-brackets">[</span>stepper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>tracer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program generator<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>stage stepper<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>dump <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-function-name">wrap</span> emit autoformat print<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>heatmap <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>tracer
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">what item is being executed</span>
                         <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">don't emit [] or the execution stops, use 0 instead</span>
                          bail 0 or<span class="org-kcats-brackets">]</span>
                         each 
                         <span class="org-kcats-brackets">[</span>word?<span class="org-kcats-brackets">]</span> keep <span class="org-comment-delimiter">;; </span><span class="org-comment">count only words, which filters out the 0's from above</span>
                         frequencies<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]]]</span>


<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
<div id="outline-container-orged98b19" class="outline-5">
<h5 id="orged98b19"><span class="section-number-5">1.16.1.1.</span> Examples</h5>
<div class="outline-text-5" id="text-1-16-1-1">
</div>
<ol class="org-ol">
<li><a id="org3691148"></a>Count the number of times each word is executed while running a program.<br />
<div class="outline-text-6" id="text-1-16-1-1-1">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment
evaluate
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>0 1 2 3 4 5 6 7 8 9 10<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span>
</pre>
</div>
<pre class="example">

[0 1 2 3 4 5 6 7 8 9 10]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>  word?
</pre>
</div>

<pre class="example">

[yes]
</pre>


<p>
"Increment the counter, or set to 1 if nothing"
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail 1 or
</pre>
</div>

<pre class="example">
1
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">empty list to put word counts in</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment
<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program, keep running</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">get the item we're about to execute</span>
 <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put it under the environment</span>
 <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">if it's a word</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span>
   <span class="org-kcats-brackets">[[</span>inc<span class="org-kcats-brackets">]</span> bail 1 or<span class="org-kcats-brackets">]</span>
   update<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the results, the count for the word about to execute</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if it's not a word, do nothing</span>
  <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
 eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
<span class="org-preprocessor">while</span>
<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the environment and just report the word counts</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span> 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">inject</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">loop</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>decorate 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> 14<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&gt; 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">while</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> 16<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> 8<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> 9<span class="org-kcats-brackets">]]</span>
</pre>
</div>
</div>
</li>
<li><a id="orgd789644"></a><span class="done CANCELED">CANCELED</span> spec checking<br />
<div class="outline-text-6" id="text-1-16-1-1-2">
<p>
clojure spec check can be replaced with predicate programs, that will
be run with <code>shield</code> before the actual word and if it returns false,
will raise an error.
</p>
</div>
</li>
<li><a id="orgdcba1ac"></a><span class="todo TODO">TODO</span> Trace output<br />
<div class="outline-text-6" id="text-1-16-1-1-3">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">results</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
<span class="org-preprocessor">while</span>

</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]</span>
 <span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>2 3 4 5<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4 5<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>3 4 5<span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 3 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 4 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>4 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>5<span class="org-kcats-brackets">]</span> 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 5 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>5 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]]]</span>
</pre>
</div>
</div>
</li>
<li><a id="orgf52da73"></a><span class="done DONE">DONE</span> Step count limiting<br />
<div class="outline-text-6" id="text-1-16-1-1-4">
<p>
When testing or debugging, limit the number of steps to avoid a
possible infinite loop.
</p>
<div class="org-src-container">
<pre class="src src-kcats">200 <span class="org-comment-delimiter">;; </span><span class="org-comment">step count remaining</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something? <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program</span>
 <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> and<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">still step budget remaining</span>
<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">decrease the step budget</span>
<span class="org-preprocessor">while</span>

<span class="org-comment-delimiter">;</span><span class="org-comment">[stack] lookup ;; return the output</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[[[</span>0 &gt;<span class="org-kcats-brackets">]</span> 4 5 6 7 8 9 10<span class="org-kcats-brackets">]</span> 4 5 6 7 8 9 10<span class="org-kcats-brackets">]]]</span> 0
</pre>
</div>
</div>
</li>
<li><a id="org797aa42"></a><span class="done DONE">DONE</span> Breakpoint<br />
<div class="outline-text-6" id="text-1-16-1-1-5">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[[</span>toe <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
   <span class="org-kcats-brackets">[</span>tos 3 &gt;<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
  every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">when to stop - when we're about to add and tos already &gt;3</span>
 <span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
 environment

 <span class="org-kcats-brackets">[[[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program</span>
   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-preprocessor">execute</span> not<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">don't stop yet</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
  every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
 <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb1c470d"></a><span class="todo TODO">TODO</span> Step over<br />
<div class="outline-text-6" id="text-1-16-1-1-6">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
 environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-comment-delimiter">;; </span><span class="org-comment">count up the program length, we'll run until it's smaller than this</span>

 <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span>
  <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&lt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">only stop if expr empty or shorter than we started off</span>
 <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgbabcb9d" class="outline-3">
<h3 id="orgbabcb9d"><span class="section-number-3">1.17.</span> Templating macro</h3>
<div class="outline-text-3" id="text-1-17">
<p>
:tangle src/kcats/stdlib/template.kcats :mkdirp yes
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>subs-point? <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[[[</span>list?<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> 2 =<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>poke splice<span class="org-kcats-brackets">]</span> set <span class="org-builtin">swap</span> contains?<span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]]]]</span>
 <span class="org-kcats-brackets">[</span>subs <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]]</span>
 <span class="org-kcats-brackets">[</span>template-inner <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[[[[</span>subs-point?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>poke<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span>
                                                <span class="org-kcats-brackets">[</span>subs <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span>
                                                <span class="org-kcats-brackets">[</span>subs<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
                                <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;;  </span><span class="org-comment">t acc v</span>
                                          <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>template-inner<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]]</span>
                                <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]]]</span>
                               decide<span class="org-kcats-brackets">]]]]</span>
 <span class="org-kcats-brackets">[</span>template <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list template<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized values<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>template-inner <span class="org-function-name">unwrap</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b bar<span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>poke a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>poke b<span class="org-kcats-brackets">]</span> x <span class="org-kcats-brackets">[</span>splice a<span class="org-kcats-brackets">]]</span> c d 1 2 3<span class="org-kcats-brackets">]</span> template<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar x foo<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeceae0d" class="outline-3">
<h3 id="orgeceae0d"><span class="section-number-3">1.18.</span> Functional environment</h3>
<div class="outline-text-3" id="text-1-18">
<p>
There are use cases for kcats where you don't want a program to be
able to mess with external resources like files, network sockets etc
nor be able to spawn new threads, the program it's running should be a
pure function and this module lets you enforce that.
</p>
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/functional.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>pipe-in pipe-out channel timeout
 handoff file-in file-out timestamps
 standard serversocket animate future
 spit tunnel database<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> unassign<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-org9a01d7d" class="outline-2">
<h2 id="org9a01d7d"><span class="section-number-2">2.</span> Issues</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org10d773b" class="outline-3">
<h3 id="org10d773b"><span class="section-number-3">2.1.</span> <span class="done DONE">DONE</span> Get rid of platform-specific definitions</h3>
</div>
<div id="outline-container-orgb535ec8" class="outline-3">
<h3 id="orgb535ec8"><span class="section-number-3">2.2.</span> <span class="done DONE">DONE</span> fix evaluate</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>1 1 +<span class="org-kcats-brackets">]]]</span> environment evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<pre class="example">

[[2]]
</pre>
</div>
</div>
<div id="outline-container-org498f557" class="outline-3">
<h3 id="org498f557"><span class="section-number-3">2.3.</span> <span class="todo TODO">TODO</span> merkle tree functions</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-function-name">join</span> hash <span class="org-string">"foobar"</span> hash =
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
First let's figure out how to represent a tree:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;</span><span class="org-comment">[5 [[3 [[1c []]</span>
<span class="org-comment-delimiter">;        </span><span class="org-comment">[2c []]]]</span>
<span class="org-comment-delimiter">;    </span><span class="org-comment">[4 [[3c []]]]]]</span>
<span class="org-kcats-brackets">[[</span>hash <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>empty-node <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span> hash node<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rawpath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [[] [take swap [child] dip path] [drop] if]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix rawpath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>parent <span class="org-kcats-brackets">[</span>butlast butlast<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
          hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">lopsidedtree n</span>
 <span class="org-kcats-brackets">[</span>balance <span class="org-kcats-brackets">[]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree cur-ct</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> path <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>parent<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree path ct</span>
       <span class="org-builtin">swapdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">node path tree ct</span>
       <span class="org-kcats-brackets">[]]]</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">insert an unbalanced node (empty sibling)</span>
       <span class="org-kcats-brackets">[</span>empty-node siblings <span class="org-kcats-brackets">[</span>path parent<span class="org-kcats-brackets">]]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise replace the empty sibling</span>
       <span class="org-kcats-brackets">[]</span>
      <span class="org-kcats-brackets">]]]</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">["" drop</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[0 []] 1 node addchild 2 node 3 node addchild addchild</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[1 0]  1 [interpose] shield swap put dropdown lookup</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"foo"  hash node "bar"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;; update the root node</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">; now add a new sibling</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"baz"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">3 path [pop zero?] [butlast butlast] [] if</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;dump</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">["quux" hash node siblings rehash ] update</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span> <span class="org-string">"quux"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>node<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-kcats-brackets">[]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
1234
</p>
<ul class="org-ul">
<li>12
<ul class="org-ul">
<li>1</li>
<li>2</li>
</ul></li>
<li>34
<ul class="org-ul">
<li>3</li>
<li>4</li>
</ul></li>
</ul>

<ul class="org-ul">
<li>5</li>
<li>6</li>
</ul></li>
</ul>
<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[]]</span>
</pre>
</div>

<p>
interpose impl
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> interpose
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 foo 3 foo 4<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>3 <span class="org-kcats-brackets">[]]]]]]</span>
  <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]</span> 1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend 0 <span class="org-function-name">put</span> <span class="org-builtin">dropdown</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>4 <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<p>
We need a function that, given a number n, gives the path in the
merkle tree. eg, 8 would be 1 1 1. Is it just <code>n-1</code> in binary?
6 would be 1 0 1. Ok so just write a function to expand binary digits:
</p>

<div class="org-src-container">
<pre class="src src-kcats">8 dec 2 radix
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]</span> <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-string">"hi"</span> <span class="org-string">"there"</span><span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-string">"there"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>hash <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [[] [take swap [child] dip path] [drop] if]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix nodepath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span> hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>

 <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]</span>
 assign<span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]]</span>
<span class="org-function-name">reverse</span> <span class="org-function-name">unwrap</span> assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">
<span class="org-kcats-brackets">[</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>nodepath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>padded <span class="org-kcats-brackets">[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
          <span class="org-builtin">swap</span> repeat
          <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[[</span>dec 2 radix<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 2 log ceiling 0 padded nodepath<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">item-ct index</span>
 <span class="org-kcats-brackets">[</span>depth <span class="org-kcats-brackets">[]]</span>

 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
          hash
          <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>2 2 partition
           <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> when
            <span class="org-function-name">unwrap</span> siblings<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span>
          assemble <span class="org-kcats-brackets">[</span>rehash<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>merkle <span class="org-kcats-brackets">[[</span>hash node<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span> <span class="org-string">"e"</span><span class="org-kcats-brackets">]</span>
 <span class="org-function-name">count</span>
 5 <span class="org-comment-delimiter">;; </span><span class="org-comment">2nd item</span>
 <span class="org-builtin">swap</span> path <span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1 0 1 0<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"FO3l6Ol62TcjJ3KPUJm5VgSjlZPKw704o0OtdiBSE+c="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"5aAf7hTg7VxIcU8iGA8lrYNltT+XefedxKPX6Tlj+Uo="</span>
                                                        <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"ypeBEsobvcr6wjGzmiPcTaeG7/gUfE5yuYB3ha/uSLs="</span> <span class="org-kcats-brackets">[]]</span>
                                                         <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"PiPoFgA5WUoziU9lZOGxNIu9egCI1CxKy3PurtWcAJ0="</span> <span class="org-kcats-brackets">[]]]]</span>
                                                       <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"v/4LNNuha8b6wXwIusVdZ2ze1aSt5B/iyZJKXd6PPls="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Ln0sA6lQeuJl7PW1NWiFpTOTogKdJBOUmXJloaJa78Y="</span>
                                                                                                              <span class="org-kcats-brackets">[]]</span>
                                                                                                             <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"GKw+c0PwFokMUQ6T+TUmEWnZ4/VlQ2Qpgw+vCTT0+OQ="</span> <span class="org-kcats-brackets">[]]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span> 5 0 <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
        <span class="org-builtin">swap</span> repeat
        <span class="org-builtin">swap</span> <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 0 1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaf6888d" class="outline-3">
<h3 id="orgaf6888d"><span class="section-number-3">2.4.</span> <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Goal: implement drop and drop-while with the same logic
</p>

<p>
Canceled - the commonality between drop and drop-while are too small to be worth trying to factor out.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
3
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span>
  <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
               <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
0 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>


<p>
This is what drop-while looks like
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the state (whether threshold reached)</span>
<span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">condition - whether we've finished dropping or not </span>
 <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">true - pass everything else through</span>
 <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prime init</span>
  <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bring pred up and exec it</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if pred passes drop the value</span>
  prime <span class="org-comment-delimiter">;; </span><span class="org-comment">after this should have value on top</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">set flag</span>
 <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">false - generate, check pred, repeat</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> prime <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> yes<span class="org-kcats-brackets">]</span>
     <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
    <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
yes <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Skyrod Vactai</p>
<p class="date">Created: 2024-07-16 Tue 22:32</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
