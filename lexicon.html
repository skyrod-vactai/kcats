<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-25 Sat 19:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The kcats Programming Language Lexicon</title>
<meta name="author" content="Skyrod Vactai" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<style> pre.src { background: black; color: white; } #content { max-width: 1000px } </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="doc-custom.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">The kcats Programming Language Lexicon</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgca0a313">1. Standard library source and documentation</a>
<ul>
<li><a href="#org9edfa86">1.1. Comparison</a></li>
<li><a href="#org3380b5e">1.2. Stack Ops</a>
<ul>
<li><a href="#org5ae1fb2">1.2.1. Motion</a></li>
</ul>
</li>
<li><a href="#org88163b7">1.3. Program execution</a></li>
<li><a href="#org1733db1">1.4. Collections</a>
<ul>
<li><a href="#org6d99d69">1.4.1. Associations</a></li>
<li><a href="#org524e610">1.4.2. Sets</a></li>
<li><a href="#orgb78bf32">1.4.3. Generators</a></li>
</ul>
</li>
<li><a href="#org202e17c">1.5. Dictionary modules</a></li>
<li><a href="#org9c3245e">1.6. Math</a></li>
<li><a href="#org9359289">1.7. Serialization</a></li>
<li><a href="#org2f98b2e">1.8. Boolean logic</a></li>
<li><a href="#org71d9511">1.9. Byte encoding and decoding</a></li>
<li><a href="#orgca5d580">1.10. Strings</a></li>
<li><a href="#org679e4e9">1.11. Error handling</a></li>
<li><a href="#org7796cb4">1.12. Methods</a></li>
<li><a href="#orgeace99a">1.13. Database</a></li>
<li><a href="#org4715a6c">1.14. Pipes</a></li>
<li><a href="#orgbff306a">1.15. Crypto</a></li>
<li><a href="#org54657bb">1.16. Time and date</a></li>
<li><a href="#orgdb161d8">1.17. Nested Environments</a>
<ul>
<li><a href="#org11a36f9">1.17.1. Debugging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8fa632e">2. Issues</a>
<ul>
<li><a href="#org877cf0d">2.1. <span class="done DONE">DONE</span> Get rid of platform-specific definitions</a></li>
<li><a href="#org062de0f">2.2. <span class="done DONE">DONE</span> fix evaluate</a></li>
<li><a href="#orgafae3f1">2.3. <span class="todo TODO">TODO</span> merkle tree functions</a></li>
<li><a href="#orgf14ba23">2.4. <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgca0a313" class="outline-2">
<h2 id="orgca0a313"><span class="section-number-2">1.</span> Standard library source and documentation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9edfa86" class="outline-3">
<h3 id="org9edfa86"><span class="section-number-3">1.1.</span> Comparison</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Words that help compare one item to another, with concepts of <code>equal</code>, <code>greater</code>, <code>less</code> etc.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span> 
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Different Numbers are not equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same numbers are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 1.0 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same value integer and float are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> &#128307; =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Number and Nothing are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same nested list with numbers are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same nested list with string are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same strings are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"there"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Different strings are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>\h \h =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same characters are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>\h \i =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Different characters are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"hi"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same bytes are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"there"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Different bytes are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#10004;&#65039; =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Different booleans unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Nested lists with different strings are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#128307; =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"'Nothing' is equal to itself"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#128307; association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"List/Association empty container types are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#128307; set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"List/Set empty container types are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Nonempty List/Association types are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]</span> set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Sets constructed from different lists are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"Needs 2 items"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"Needs 2 items"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Less than 2 stack items results in an error"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>compare <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"string lexicographical order with single character inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"a"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"string lexicographical order with single character equality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Same integer compares equal"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>2 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>greater<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> &#127851; compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/list order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/byte order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> &#127851; <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Word/string order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"foo"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"String order equaltiy"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#127851; compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrapped Nothing value equality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Nothing/emptied container equality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"Needs 2 items"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"Needs 2 items"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Less than 2 stack items results in an error"</span><span class="org-kcats-brackets">]]]]]</span>

</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>compare-by <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128101;
                          <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011; 
                          <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129668; 
                          compare<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>-1 -2 <span class="org-kcats-brackets">[</span>abs<span class="org-kcats-brackets">]</span> compare-by<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: compare non-numeric args</span>
<span class="org-kcats-brackets">[</span>&lt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> compare-by <span class="org-kcats-brackets">[</span>less<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Float is not less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>-3 2.2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Negative integer/float is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>0 2.2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Zero Integer/float is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is not less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>-1.1 -1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Negative equal floats is not less"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> compare-by <span class="org-kcats-brackets">[</span>greater<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Float is not greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>-1 -2.2 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Negative integer/float is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>0 -2.2 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Zero Integer/float is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is not greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>-1.1 -1.1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Negative equal floats is not greater"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&lt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&gt; &#9775;&#65039;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Float is not less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1 2.2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is less/equal"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&lt; &#9775;&#65039;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Float is not greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is greater/equal"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>max-by <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>compare-by &#127873;<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#9654;&#65039; <span class="org-kcats-brackets">[</span>less<span class="org-kcats-brackets">]</span> =
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>price 25<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name bar<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span>price 15<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name foo<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span>price<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> max-by<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>price 25<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name bar<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>min-by <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>compare-by &#127873;<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#9654;&#65039; <span class="org-kcats-brackets">[</span>greater<span class="org-kcats-brackets">]</span> =
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>price 25<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name bar<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span>price 15<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name foo<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span>price<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> min-by<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>price 15<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>name foo<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>min <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&lt;<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#9878;&#65039; &#9654;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two negative integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two floats &lt;1"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>max <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&gt;<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#9878;&#65039; &#9654;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two floats &lt;1"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org3380b5e" class="outline-3">
<h3 id="org3380b5e"><span class="section-number-3">1.2.</span> Stack Ops</h3>
<div class="outline-text-3" id="text-1-2">
<div class='tangle-wrapper' data-tangle='src/kcats/core/stack-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The trash can denotes throwing away a value, from the ToS."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop integer on ToS"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 2 3 <span class="org-kcats-brackets">[</span>a b c<span class="org-kcats-brackets">]</span> &#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop list on ToS"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"Nothing to drop"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"Nothing to drop"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Empty stack results in error"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128101; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The twins denote copying the ToS."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone integer on ToS"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span> &#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Clone string on ToS"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>&#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"Nothing to clone"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"Nothing to clone"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Empty stack results in error"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#129510; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list *<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The socks denote a thing that is turned inside-out. Takes a list on ToS, makes it the new stack, and takes what had</span>
<span class="org-string">              previously been the rest of the stack, and makes it a list on top</span>
<span class="org-string">              of the new stack. Used for context switching."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> &#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 5 4 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Swap a list of integers with the rest of the stack"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3 <span class="org-kcats-brackets">[</span>4 foo <span class="org-string">"bar"</span><span class="org-kcats-brackets">]</span> &#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> &#127851; 4 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Swap a list of items with the rest of the stack"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>4 5 6<span class="org-kcats-brackets">]</span> &#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 5 4 &#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap a list of integers with an empty stack"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> &#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"c"</span> <span class="org-string">"b"</span> <span class="org-string">"a"</span> &#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap a list of strings with an empty stack"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2 3 4 &#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"List is required"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"List is required"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Non-list item result in an error"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>&#129510;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"Nothing to evert"</span><span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"Nothing to evert"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Empty stack results in error"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/stack.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#8226;&#128101;  <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The twins with dot represents copying, one stack position down (copy the 2nd item)"</span><span class="org-kcats-brackets">]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128101;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#8226;&#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone the 2nd item on the stack"</span><span class="org-kcats-brackets">]]]]]</span>


<span class="org-kcats-brackets">[</span>&#8226;&#8226;&#128101; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The twins with dots represents copying, two stack positions down (copy the 3rd item)"</span><span class="org-kcats-brackets">]</span>      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#8226;&#128101;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 &#8226;&#8226;&#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone the 3rd item on the stack"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>over <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#8226;&#128101; &#128256;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 over<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Copy the 2nd item to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>under <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128101; &#8226;&#128256;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 under<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Copy the ToS to the 2nd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#128465;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The trash can with dot represents dropping, one stack position down (drop the 2nd item)"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128256; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop the 2nd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#8226;&#128465;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
      <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The trash can with dots represents dropping, two stack position down (drop the 3rd item)"</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128735; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#8226;&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop the 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128248; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The camera denotes saving the whole stack as a list, on ToS."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#129510; &#128101; &#129510; &#127851;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#128248;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Copy the stack to ToS"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>&#128248;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Copy stack to ToS when stack is empty"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>restore <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#129510; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-string">"y"</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> restore<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Replace stack with list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>&#128307; restore<span class="org-kcats-brackets">]</span> &#128307; <span class="org-string">"Replace stack with empty list"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org5ae1fb2" class="outline-4">
<h4 id="org5ae1fb2"><span class="section-number-4">1.2.1.</span> Motion</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
These words change the order of items on the stack.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The crossing arrows denote swapping the top two stack items."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#128256;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap top two items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#128256; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
      <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The crossing arrows with dot represents swapping one stack position down (2nd and 3rd items)"</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#8226;&#128256;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 1 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap 2nd and 3rd items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128735; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The buoy denotes floating the 3rd stack value to the top."</span><span class="org-kcats-brackets">]</span>     
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#128735;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Move 3rd item to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#9875; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The anchor denotes sinking the ToS to the 3rd position"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 &#9875;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Move ToS to 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>flip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128735; &#8226;&#128256;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 flip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap ToS and 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-org88163b7" class="outline-3">
<h3 id="org88163b7"><span class="section-number-3">1.3.</span> Program execution</h3>
<div class="outline-text-3" id="text-1-3">
<div class='tangle-wrapper' data-tangle='src/kcats/core/execute-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#9654;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The 'play' arrow denotes running a program"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 +<span class="org-kcats-brackets">]</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 2 &#128307; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute an empty program"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Nested execution"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8596;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span>item condition<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The left/right arrows denote choosing between two programs"</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 &#10004;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039; 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]</span> <span class="org-string">"Branch on true condition"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>6 &#128307; <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Branch on false condition"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#129668; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The magic wand denotes making ToS disappear while program runs, then reappear on ToS."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 8 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 8<span class="org-kcats-brackets">]</span> <span class="org-string">"Dipping a program under ToS"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> &#127851;
                  <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"A bare word on stack is left intact and not executed"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/execute.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#129670; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program combinator<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program exit<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program body<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The Russian dolls denote a program recurrence. Constructs a recursive program, without having to give it a name.</span>
<span class="org-string">           Takes 4 component programs as input: predicate, body, exit,</span>
<span class="org-string">           and combinator; and returns a recursive program. This program will run predicate, if false the exit program</span>
<span class="org-string">           runs and the recursive program is finished. If true, the body program runs, the whole recursive program is put on</span>
<span class="org-string">           the stack and the combinator is run."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9986;&#65039;4&#65039;&#8419;
                   <span class="org-kcats-brackets">[</span>&#9986;&#65039;3&#65039;&#8419; <span class="org-kcats-brackets">[</span>4&#65039;&#8419; 3&#65039;&#8419; 2&#65039;&#8419; 1&#65039;&#8419; &#129670; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#9986;&#65039;1&#65039;&#8419;<span class="org-kcats-brackets">]</span>
                   2&#65039;&#8419; &#8596;&#65039;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5
                  <span class="org-kcats-brackets">[</span>2 &gt;<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                  <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128101; dec<span class="org-kcats-brackets">]</span> &#128307; <span class="org-kcats-brackets">[</span>&#9654;&#65039; *<span class="org-kcats-brackets">]</span>
                  &#129670; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]</span>
                 <span class="org-string">"Recur with reduction"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#127744; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item flag<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The swirl denotes a programmatic loop with binary exit condition"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> &#128256; <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 &#10004;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039; -2 * &#128101; 50 &lt;<span class="org-kcats-brackets">]</span> &#127744; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>160<span class="org-kcats-brackets">]</span> <span class="org-string">"Looping"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>10 &#128307; <span class="org-kcats-brackets">[</span>&#128465;&#65039; -2 * &#128101; 50 &lt;<span class="org-kcats-brackets">]</span> &#127744; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Looping with false initial condition is no-op"</span><span class="org-kcats-brackets">]]]]]</span>


<span class="org-kcats-brackets">[</span>decide <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list test-expr-pairs<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Takes a list of choices (pairs of test, program) and executes the first</span>
<span class="org-string">               choice whose test passes. If none pass, it's a no-op. Stack is reset</span>
<span class="org-string">               between testing conditions."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128228;
                      <span class="org-kcats-brackets">[</span>&#127851; <span class="org-comment-delimiter">;; </span><span class="org-comment">break up the pair</span>
                       &#128256; 
                       &#128737;&#65039;
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">&#129670; </span>
                       flip <span class="org-kcats-brackets">[</span>1&#65039;&#8419; decide<span class="org-kcats-brackets">]</span> &#127890; &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the empty container</span>
                      &#8596;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>5 <span class="org-string">"five"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Decide with matching condition"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[</span>9 <span class="org-string">"something else"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Decide with matching default condition"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"seven"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>9<span class="org-kcats-brackets">]</span> <span class="org-string">"Decide with no matching condition"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: implement as axiom (which would depend on 'restore' which should also be axiom?)</span>
<span class="org-kcats-brackets">[</span>&#128737;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The shield denotes running a program, keeping top of stack produced, but protecting existing items from being consumed."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128137; <span class="org-kcats-brackets">[</span>&#128248; &#9986;&#65039;1&#65039;&#8419; <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 &#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program shielding the stack from consumption"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#128737;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The shield with dot denotes running a program, protecting all but the top stack item from being consumed."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128137; <span class="org-kcats-brackets">[</span>&#128248; &#9986;&#65039;1&#65039;&#8419; &#8226;&#128465;&#65039; <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 &#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program consuming only the original ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#8226;&#128737;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The shield with dots denotes running a program, protecting all but the top two stack items from being consumed."</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128137; <span class="org-kcats-brackets">[</span>&#128248; &#9986;&#65039;1&#65039;&#8419; &#8226;&#128465;&#65039; &#8226;&#128465;&#65039; <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>+ +<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 6<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program consuming only the original top 2 items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#9878;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The scales denote a choice between two programs, based on the binary resultof a test program"</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9986;&#65039;3&#65039;&#8419; <span class="org-comment-delimiter">;; </span><span class="org-comment">the condition</span>
                  2&#65039;&#8419; 1&#65039;&#8419; &#8596;&#65039;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>&#128101; 5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with true predicate"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>6 <span class="org-kcats-brackets">[</span>&#128101; 5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with false predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>when <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#9878;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>&#128101; odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; inc<span class="org-kcats-brackets">]</span> when &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with no false branch and true predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>3 <span class="org-kcats-brackets">[</span>&#128101; even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; inc<span class="org-kcats-brackets">]</span> when &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with no false branch and false predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>dipped <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>program program<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[</span>&#129668;<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#129668; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
              <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The magic wand with dot denotes running a program, hiding the top two items and then making them reappear after the program is finished"</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dipped dipped &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#8226;&#129668;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program under top two items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#8226;&#129668; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
               <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The magic wand with dots denotes running a program, hiding the top three items and then making them reappear after the program is finished"</span><span class="org-kcats-brackets">]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dipped dipped dipped &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#129668;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program under top 3 items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#129692; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>program program<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The ladder denotes a stepper, that iterates over a list and executes the program once per item. The rest of the list is hidden while the program runs."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#128228; &#128256; 
                    1&#65039;&#8419; &#128101; &#8226;&#129668;
                    &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                   &#128307; &#8596;&#65039;<span class="org-kcats-brackets">]</span>
                  &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]</span> <span class="org-string">"Step through numbers doing arithmetic"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1 &#128307; <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"Stepping through empty list is no-op"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128011; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The whale denotes diving - running a program 'below' the ToS (with the ToS hidden from the program), and then surfacing the result up to the ToS (above the former ToS)."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#129668; &#128256;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 9<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#128011; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The whale with dot denotes running a program beneath the top two items, and then floating the result back to the ToS."</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#8226;&#129668; &#128735;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 11<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip under top 2 items and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#8226;&#8226;&#128011; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The whale with dot denotes running a program beneath the top three items, and then floating the result back to the ToS."</span><span class="org-kcats-brackets">]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[</span>&#8226;&#128011;<span class="org-kcats-brackets">]</span> &#128279; &#129668; &#128256;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#128011;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 7 8 9<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip under top 3 items and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128137; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>program program<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The syringe represents an injection - creates a program where it injects the given program into the list below</span>
<span class="org-string">                     it (runs the program with the list as its</span>
<span class="org-string">                     stack).  Does not affect the rest of the stack."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dipped <span class="org-kcats-brackets">[</span>&#129510; &#9986;&#65039;1&#65039;&#8419; &#129510;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> &#128137; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>26<span class="org-kcats-brackets">]]</span> <span class="org-string">"Inject program into list as if it's the stack"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#9203; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The hourglass represents a conditional 'while' loop: run predicate program. If it produces logical true, run the body and repeat, otherwise stop."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128101; dec<span class="org-kcats-brackets">]</span> &#9203; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1 0<span class="org-kcats-brackets">]</span> <span class="org-string">"While loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">until</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#127917;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">reverse logic of pred</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">run body once, with dummy pred result</span>
                     &#128101; <span class="org-kcats-brackets">[[[]]</span> &#128256; &#128279; &#129668;<span class="org-kcats-brackets">]</span> &#129668; &#9203;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039; inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Until loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">times</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program body<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>1&#65039;&#8419; <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039; dec <span class="org-kcats-brackets">[</span>2&#65039;&#8419; &#128101; &#129668;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-preprocessor">times</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#9878;&#65039;
                      &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                     &#127890;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>5<span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 5 5<span class="org-kcats-brackets">]</span> <span class="org-string">"Can create an item multiple times"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>5<span class="org-kcats-brackets">]</span> 0 <span class="org-preprocessor">times</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128307; <span class="org-string">"0 times is a no-op"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>1 1 <span class="org-kcats-brackets">[</span>inc &#128256;<span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span> &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Can run a program multiple times"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>primrec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program rec1<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>program exit<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>number repetitions<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128256; &#128279; <span class="org-comment-delimiter">;; </span><span class="org-comment">add execute to rec1 to be recurs rec2</span>
                       <span class="org-kcats-brackets">[[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#128256; &#128279;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">add drop to exit condition</span>
                       <span class="org-kcats-brackets">[[</span>zero?<span class="org-kcats-brackets">]]</span> &#8226;&#129668;  <span class="org-comment-delimiter">;; </span><span class="org-comment">put the condition on bottom</span>
                       <span class="org-kcats-brackets">[[</span>&#128101; dec<span class="org-kcats-brackets">]]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">add the r1</span>
                       &#129670;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">now its generic recur</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> primrec &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]</span> <span class="org-string">"Simple countup loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>bail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128307;<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>&#128307; <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Can bail on invalid input"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Valid input doesn't bail"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>bailer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>and<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128228; &#129668;<span class="org-kcats-brackets">]</span> &#9203;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1
                      <span class="org-kcats-brackets">[[</span>&#128101; odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128101; odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; inc<span class="org-kcats-brackets">]]</span>
                      bailer &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[]]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org1733db1" class="outline-3">
<h3 id="org1733db1"><span class="section-number-3">1.4.</span> Collections</h3>
<div class="outline-text-3" id="text-1-4">
<div class='tangle-wrapper' data-tangle='src/kcats/core/collections-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#128279; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The chain denotes joining two containers together"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Join two collections of strings"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> <span class="org-string">"cd"</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two strings"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> encode <span class="org-string">"cd"</span> encode &#128279; <span class="org-string">"abcd"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Two joined byte seqs are equal to the combined literal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-kcats-brackets">[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a g<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Joining list+assoc -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association  &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Joining assoc+list -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b c d<span class="org-kcats-brackets">]</span> set &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join list with set -&gt; set"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">""</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two empty strings -&gt; empty string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo bar baz<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join empty string + list -&gt; list (identity)"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-kcats-brackets">[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with a list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bcdea"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a list of chars with string -&gt; string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join an empty string with list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> <span class="org-kcats-brackets">[</span>\d 101 <span class="org-string">"not-char"</span> -1.1<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>\a \b \c \d 101 <span class="org-string">"not-char"</span> -1.1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join a string with (non-char) list -&gt; list"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> &#128307; &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> &#128307; &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join empty string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>4 4 4<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128228; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item dispenser<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The outbox denotes taking an item from a container."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> &#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take a string from a list"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> &#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Take a number from a list"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[[</span>a <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> &#128228; &#8226;&#128465;&#65039; <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take an entry from association is nondeterministic"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 3 5 7 9<span class="org-kcats-brackets">]</span> set &#128228; &#8226;&#128465;&#65039; odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Take item from set is nondeterministic"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128238; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item receptacle<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The postbox denotes putting an item into a container"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>&#128307; 1 &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into empty list"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into list"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> \d &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"food"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put character into string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode 32 &#128238; string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo "</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put byte into byte array"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128207; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The ruler denotes getting the length of a container (number of items)"</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"cd"</span><span class="org-kcats-brackets">]</span> &#128207;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Count list of strings"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> &#128207;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count chars in string"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> encode &#128207;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count bytes in byte array"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association &#128207;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Count entries in association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-string">"Get second item of list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get second item of string"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Get second item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">last</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>3 4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]</span> <span class="org-string">"Get last item of list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">last</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get last item of string"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Get last item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item ordered<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Pop last string from list"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Pop last number from list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The wrapped package denotes wrapping an item in a (list) container."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 &#127873;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Wrap a number"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> &#127873;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Wrap a list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#127851; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The unwrapped chocolate bar denotes unwrapping a container to place all the items inside on the stack."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of one item"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of strings with existing stack items"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307; &#127851;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap an empty list is a no-op"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of multiple items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Reverse a list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"321"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Reverse a string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-string">"bar"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Reverse a list of string"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>slice <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foobar"</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a string with valid indices"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 0 7 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a string with index past end -&gt; Nothing"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a byte array with valid indices"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a b c d e<span class="org-kcats-brackets">]</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c<span class="org-kcats-brackets">]]</span> <span class="org-string">"Slice a list with valid indices"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>cut <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span> &#128737;&#65039; slice<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>0 &#128256; slice<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128668;
                   <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span> &#129668; &#127851;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcdefghijklmnopqrstuvwxyz"</span> 5 cut<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"fghijklmnopqrstuvwxyz"</span> <span class="org-string">"abcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Cut string at index"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>empty <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from byte array"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307; association<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from association"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307; set<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from set"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>range <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 5 1 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step of 1"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>3 13 3 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 6 9 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step greater than 1"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>empty? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>&#128307; empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>1 empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Number is not empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty string is empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Non-empty list is not empty"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>list? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list is a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty list is a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>5 list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is not a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A string is not a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; association list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty association is not a list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>sort-indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2<span class="org-kcats-brackets">]]</span> sort-indexed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Sorting a list of key-value pairs by key"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#127890; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list template<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The backpack denotes filling a template, with items from the stack. Use 1&#65039;&#8419;, 2&#65039;&#8419; etc for the first, second etc items from the stack. You can also splice a container item into the 'backpack', with &#9986;&#65039;1&#65039;&#8419;, &#9986;&#65039;2&#65039;&#8419; etc. The number of stack items consumed is whatever is the highest index placeholder. So a 'backpack' of [1&#65039;&#8419; 4&#65039;&#8419;] consumes 4 items even though 2&#65039;&#8419; and 3&#65039;&#8419; are not present."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar<span class="org-kcats-brackets">]</span> &#127851;
                  <span class="org-kcats-brackets">[</span>2&#65039;&#8419; <span class="org-kcats-brackets">[</span> 1&#65039;&#8419; x &#9986;&#65039;2&#65039;&#8419;<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar x foo<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]]</span>
                 <span class="org-string">"Packing values from the stack, into a template"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#127890; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list template<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The backpack denotes filling a template, with items from the stack. Use 1&#65039;&#8419;, 2&#65039;&#8419; etc for the first, second etc items from the stack. You can also splice a container item into the 'backpack', with &#9986;&#65039;1&#65039;&#8419;, &#9986;&#65039;2&#65039;&#8419; etc. The number of stack items consumed is whatever is the highest index placeholder. So a 'backpack' of [1&#65039;&#8419; 4&#65039;&#8419;] consumes 4 items even though 2&#65039;&#8419; and 3&#65039;&#8419; are not present."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar<span class="org-kcats-brackets">]</span> &#127851; <span class="org-kcats-brackets">[</span>2&#65039;&#8419; <span class="org-kcats-brackets">[</span>1&#65039;&#8419; x &#9986;&#65039;2&#65039;&#8419;<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]</span>
                 &#127890;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar x foo<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]]</span>
                <span class="org-string">"Packing values from the stack, into a template"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>sort-indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>2 2<span class="org-kcats-brackets">]]</span>
                            sort-indexed<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Sorting a list of key-value pairs by key"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>list? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> list?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list is a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; list?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty list is a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>5 list?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is not a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> list?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A string is not a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; association list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty association is not a list"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>empty? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>&#128307; empty?<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>1 empty?<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Number is not empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> empty?<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty string is empty"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> empty?<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Non-empty list is not empty"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>range <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 5 1 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step of 1"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3
                                                                                       13 3 range<span class="org-kcats-brackets">]</span>
                                                                                      <span class="org-kcats-brackets">[[</span>3 6 9 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step greater than 1"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>empty <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> empty<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Create empty container from byte array"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> empty<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                     association empty<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>&#128307; association<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Create empty container from association"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307; set<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Create empty container from set"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>cut <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer sized<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span>
                     &#128737;&#65039; slice<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>0 &#128256; slice<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128668; <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span>
                   &#129668; &#127851;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcdefghijklmnopqrstuvwxyz"</span> 5 cut<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"fghijklmnopqrstuvwxyz"</span> <span class="org-string">"abcde"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-string">"Cut string at index"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>slice <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foobar"</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a string with valid indices"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span>
                                                                                        0 7 slice<span class="org-kcats-brackets">]</span>
                                                                                       <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a string with index past end -&gt; Nothing"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Slice a byte array with valid indices"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a b c d e<span class="org-kcats-brackets">]</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c<span class="org-kcats-brackets">]]</span> <span class="org-string">"Slice a list with valid indices"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Reverse a list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span><span class="org-string">"321"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Reverse a string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-string">"bar"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Reverse a list of string"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#127851; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The unwrapped chocolate bar denotes unwrapping a container to place all the items inside on the stack."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of one item"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span>
                 &#127851;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of strings with existing stack items"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307; &#127851;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap an empty list is a no-op"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span>
                                                                        <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of multiple items"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The wrapped package denotes wrapping an item in a (list) container."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 &#127873;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Wrap a number"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span>
                 &#127873;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Wrap a list"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item ordered<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-string">"Pop last string from list"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]</span>
                   3<span class="org-kcats-brackets">]</span>
                  <span class="org-string">"Pop last number from list"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">last</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>3 4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]</span> <span class="org-string">"Get last item of list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">last</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get last item of string"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Get last item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-string">"Get second item of list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get second item of string"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Get second item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#128207; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The ruler denotes getting the length of a container (number of items)"</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"cd"</span><span class="org-kcats-brackets">]</span> &#128207;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Count list of strings"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> &#128207;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count chars in string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> encode &#128207;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count bytes in byte array"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span>
                                                                      <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                                                                     association &#128207;<span class="org-kcats-brackets">]</span>
                                                                    <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Count entries in association"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#128238; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item receptacle<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The postbox denotes putting an item into a container"</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>&#128307; 1 &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into empty list"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3
                                                                              4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into list"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> \d &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"food"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put character into string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode 32 &#128238; string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo "</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put byte into byte array"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#128228; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item dispenser<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The outbox denotes taking an item from a container."</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> &#128228;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-string">"a"</span><span class="org-kcats-brackets">]</span>
                <span class="org-string">"Take a string from a list"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> &#128228;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span>
                 1<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Take a number from a list"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[[</span>a <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>b <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>c <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
                 &#128228; &#8226;&#128465;&#65039; <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take an entry from association is nondeterministic"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 3 5 7 9<span class="org-kcats-brackets">]</span> set &#128228; &#8226;&#128465;&#65039; odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Take item from set is nondeterministic"</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span>&#128279; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The chain denotes joining two containers together"</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span><span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]</span>
                 &#128279;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Join two collections of strings"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> <span class="org-string">"cd"</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two strings"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> encode <span class="org-string">"cd"</span> encode &#128279; <span class="org-string">"abcd"</span> encode
                                                             =<span class="org-kcats-brackets">]</span>
                                                            <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Two joined byte seqs are equal to the combined literal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                 association <span class="org-kcats-brackets">[[</span>e f<span class="org-kcats-brackets">]</span>
                              <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span>
                 &#128279;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>a g<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]]</span>
                 association<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Joining list+assoc -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[[</span>e f<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                 association &#128279;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                 association<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Joining assoc+list -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span>
                 &#128279;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>a e<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>a b c d<span class="org-kcats-brackets">]</span> set &#128279;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Join list with set -&gt; set"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">""</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two empty strings -&gt; empty string"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>foo bar baz<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span>
                                                                          <span class="org-kcats-brackets">[[</span>foo bar baz<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join empty string + list -&gt; list (identity)"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-kcats-brackets">[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with a list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bcdea"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a list of chars with string -&gt; string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>\b \c 100 101<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join an empty string with list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> <span class="org-kcats-brackets">[</span>\d \e 102 <span class="org-string">"not-char"</span> -1.1<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>\a \b \c \d \e 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join a string with (non-char) list -&gt; list"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> &#128307; &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> &#128307; &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join empty string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>4 4 4<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span>
                <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/collections.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">DEPRECATE - this is redundant, all logical operators can take the item directly</span>
<span class="org-kcats-brackets">[</span>something? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span> 
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>empty? &#9775;&#65039;<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is something"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>&#128307; something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is not something"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty string is not something"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128228; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Get the first item of a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\f<span class="org-kcats-brackets">]</span> <span class="org-string">"The first item of a string is the first character"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"The first item of an empty list is Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128228; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Take rest of list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"oo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take rest of string"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>butlast <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> butlast<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Take all but last of list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>prepend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item sized<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#127873; &#128256; &#128279;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2<span class="org-kcats-brackets">]</span> 3 prepend<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Prepend to list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"oo"</span> \f prepend<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Prepend to string"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128175; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The '100' (percent) denotes creating a consensus program from a predicate program. The returned program will check whether all the items in the container match the predicate program. Each item is placed on the stack (with remaining items hidden), and the predicate program is run. If it returns logical true, repeat with the next item, otherwise stop and return logical false."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#8226;&#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">protect the rest of stack</span>
                  <span class="org-kcats-brackets">[[</span>&#128228; &#128256; 1&#65039;&#8419; &#128011; &#128101;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">more items</span>
                   <span class="org-kcats-brackets">[</span>&#128307; &#10004;&#65039; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">empty list, return &#10004;&#65039;</span>
                   &#8596;&#65039;<span class="org-kcats-brackets">]</span> &#127890;
                  <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Every number matches predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>2 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Not every number matches predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Every item in empty list matches any predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> &#128307; &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Every item in list matches empty predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 &#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Can shield stack from predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>12 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12 &#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Can check list of predicates with execute predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128227; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> boolean<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The megaphone denotes creating a existence program from a predicate program. (The megaphone represents amplifying from a single element to the whole). The returned program will check whether any of the items in the container match the predicate program. Each item is placed on the stack (with remaining items hidden), and the predicate program is run. If it returns logical false, repeat with the next item, otherwise stop and return logical true."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#128228; &#128256; 1&#65039;&#8419; &#128011; &#128101; &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">more items</span>
                   <span class="org-kcats-brackets">[</span>&#128307; &#128307; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">empty list, return []</span>
                   &#8596;&#65039;<span class="org-kcats-brackets">]</span> &#127890;
                  <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Any number matches predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>3 5 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"No number matches predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"No item in empty list matches any predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>&#128307; 2 4 6<span class="org-kcats-brackets">]</span> &#128307; &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty predicate returns first truthy item"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>3 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 &#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Stack is shielded from predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>-15 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128227; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-15 &#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Can check list of predicates with execute predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#127917; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The performing arts masks denote logically complementing a program: create a new program that returns the logical opposite of what the original program did."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>1&#65039;&#8419; &#9654;&#65039; &#9775;&#65039;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> &#127917; <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-string">"even"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"odd"</span><span class="org-kcats-brackets">]</span> &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span><span class="org-string">"even"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>&#128668; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program transform<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The tractor denotes creating an item-by-item transformation. The returned program will run the transform on each item in the container on ToS. Each item is placed on the stack with remaining items hidden, and the transform program is run. Its stack effects are erased for the next item."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#128256; 1&#65039;&#8419; &#8226;&#128737;&#65039; &#129668; &#128256; &#128238;<span class="org-kcats-brackets">]</span> &#129692;
                   &#128307; &#9875; <span class="org-comment-delimiter">;; </span><span class="org-comment">put empty results below list</span>
                   &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                  &#127890;<span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pass each item through a program"</span><span class="org-kcats-brackets">]</span>

                <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Program has access to rest of stack"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ *<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>70 77 84<span class="org-kcats-brackets">]]</span> <span class="org-string">"Stack is shielded from mapping program"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>7 7 7<span class="org-kcats-brackets">]]</span> <span class="org-string">"Result of program can be lower stack items"</span><span class="org-kcats-brackets">]</span>

                <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#128307; &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]]</span> <span class="org-string">"Empty program is a no-op"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>+<span class="org-kcats-brackets">]</span> &#128668; <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span> &#129668; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>10 11 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create a map program and use later"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&#129522; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program predicate<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The magnet denotes a filtering. The returned program will filter a list on ToS and leave only those items for which the predicate returns logical true."</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">run the predicate with no stack effect</span>
                  <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#9878;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">if match, drop the pred result and put the original item in result list</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">if not, just drop the original</span>
                  &#129692; 
                  <span class="org-kcats-brackets">[</span>1&#65039;&#8419; &#128307; &#9875; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">place the empty result container beneath</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> &#129522; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Filter a list with predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> &#129522; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Filter with predicate that matches no items"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>33 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 + odd?<span class="org-kcats-brackets">]</span> &#129522; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Filter predicate uses existing stack items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>sort <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128101; &#9986;&#65039;1&#65039;&#8419; pair<span class="org-kcats-brackets">]</span> &#127890;
                    &#128668; &#9654;&#65039; sort-indexed<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 3 2<span class="org-kcats-brackets">]</span> &#128307; sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort a list of numbers"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Carol"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> &#128307; sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Alice"</span> <span class="org-string">"Bob"</span> <span class="org-string">"Carol"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort a list of strings"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Charlie"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128207;<span class="org-kcats-brackets">]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Bob"</span> <span class="org-string">"Alice"</span> <span class="org-string">"Charlie"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort list of strings by length"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>repetition <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                     item<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#9875; <span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> 3 repetition &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> <span class="org-string">"hi"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Create a list of repeated items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039; 0 &#128256; 1 range &#128256; zip<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> indexed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Index a list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011;
                          <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#9654;&#65039; <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[]]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>indexer collect<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Index a generator"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexof <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>indexer<span class="org-kcats-brackets">]</span> &#129668;
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">use wrap so we can find index of words,</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise the word gets &#9654;&#65039;d</span>
                       <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> &#127873; =<span class="org-kcats-brackets">]</span> &#128256; &#127873; &#128238; <span class="org-kcats-brackets">[[</span>&#8226;&#128256;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> &#128137;
                       keep generate <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> &#127851; indexof<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Get the index of first matching item"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> &#127851; indexof<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"No matching item -&gt; Nothing"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[[</span>a b c d c e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> &#127851; indexof<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Multiple matches returns index of first match"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>interpose <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; flip
                         <span class="org-kcats-brackets">[</span>&#128256; pair &#128279; <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#129692;
                         &#128465;&#65039; <span class="org-function-name">pop</span> &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo bar baz<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo <span class="org-string">"hi"</span> bar <span class="org-string">"hi"</span> baz<span class="org-kcats-brackets">]]</span> <span class="org-string">"Interpose string between words"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is a no-op"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]]</span> <span class="org-string">"Single item list is a no-op"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>starts? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>ordered prefix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered target<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>zip <span class="org-kcats-brackets">[</span>&#127851; =<span class="org-kcats-brackets">]</span> &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the items at matching indexes are equal</span>
                        <span class="org-kcats-brackets">[[</span>&#128207;<span class="org-kcats-brackets">]</span> both &gt;=<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the prefix is shorter than the target</span>
                       <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#128175; &#9654;&#65039;
                       &#8226;&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the originals</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"ab"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"String starts with matching string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"String starts with empty string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">"ab"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty string doesn't start with a string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"String doesn't start with non-matching string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"List starts with matching list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>ends? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> both starts?<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"cd"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"String ends with matching string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"String ends with empty string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"String doesn't end with non-matching string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"List ends with matching list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>pair <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#127873;<span class="org-kcats-brackets">]</span> &#129668; &#128238;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pair up two numbers into a list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]</span> <span class="org-string">"Pair up two lists into a new list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>pair? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128207; 2 =<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>asked<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span>sized?<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; <span class="org-kcats-brackets">[]]</span>
                     <span class="org-kcats-brackets">[[]]</span> &#9878;&#65039; &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"ab"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"2-character string is a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"2-item list is a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"3-character string is not a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Nothing is not a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>7 pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Number is not a pair"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>triplet <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> &#129668; &#128238;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Make a 3-item list from 3 stack items"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]</span> triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]</span> <span class="org-string">"Make a 3-item list from smaller lists"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>both? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#9875; pair &#128256; &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Test two items for predicate when not all match"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>1 3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Test two items for predicate when all match"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>both <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> &#129668; &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Run program on two stack items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>walk <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program item-transform<span class="org-kcats-brackets">]</span> list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition  <span class="org-kcats-brackets">[[</span>&#128465;&#65039; &#9986;&#65039;1&#65039;&#8419;<span class="org-kcats-brackets">]</span> &#127890; <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the result of the predicate which we won't want</span>
                     <span class="org-kcats-brackets">[</span>list? &#9775;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256;
                     <span class="org-kcats-brackets">[</span>&#128307; &#128256;<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>&#128279;<span class="org-kcats-brackets">]</span> &#128279; &#129692; &#9654;&#65039; &#127873;<span class="org-kcats-brackets">]</span>
                     &#129670; <span class="org-kcats-brackets">[</span>&#127851;<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>inc &#127873;<span class="org-kcats-brackets">]</span> walk &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 <span class="org-kcats-brackets">[</span>4 <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> 7<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Walk a nested list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#128101; inc pair<span class="org-kcats-brackets">]</span> walk &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 2 3 <span class="org-kcats-brackets">[</span>3 4 <span class="org-kcats-brackets">[</span>4 5 5 6<span class="org-kcats-brackets">]</span> 6 7<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Walk a nested list and splice results"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>flatten <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#128256; <span class="org-kcats-brackets">[</span>list?<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#129692; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]</span> f<span class="org-kcats-brackets">]</span> g<span class="org-kcats-brackets">]</span> flatten<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e f g<span class="org-kcats-brackets">]]</span> <span class="org-string">"Flatten a nested list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>pad <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item padding<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer newsize<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011; -<span class="org-kcats-brackets">]</span> &#129668;
                   &#128256; repetition
                   &#128256; &#128279;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 5 0 pad<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 0 1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pad a list at front, to given size"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 6<span class="org-kcats-brackets">]</span> 5 0 pad<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4 5 6<span class="org-kcats-brackets">]]</span> <span class="org-string">"Padding a list to smaller than original size is a no-op"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org6d99d69" class="outline-4">
<h4 id="org6d99d69"><span class="section-number-4">1.4.1.</span> Associations</h4>
<div class="outline-text-4" id="text-1-4-1">
<div class='tangle-wrapper' data-tangle='src/kcats/core/associations-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>get <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> &#127851; get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Get a key from an association"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>10 11 12 13<span class="org-kcats-brackets">]</span> 1 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]</span> <span class="org-string">"Get an item by index from a list"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\b<span class="org-kcats-brackets">]</span> <span class="org-string">"Get a character by index from a string"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>98<span class="org-kcats-brackets">]</span> <span class="org-string">"Get an integer by index from a byte array"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[[</span>a 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b<span class="org-kcats-brackets">]</span> &#127851; get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Get a nonexistent key -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>assign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item value<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span>
                 sized<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new value to an existing key"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new value to a new key"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c &#128307;<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d 5<span class="org-kcats-brackets">]]</span> association assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new nested key, promoting to nested association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>1 1 0<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]</span> <span class="org-string">"Assign a new index in a nested list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 0<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Assign a new index in a nested list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>a 0<span class="org-kcats-brackets">]</span> 10 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>10 2 3<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a nested key in a mixed structure of association and list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>&#128307; &#128307; <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Assign an index creating placeholders for missing list items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>unassign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item key<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign a key from an association, promoting from list"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign a key that doesn't exist, only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign multiple keys that don't exist only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>f g<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c x<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>f g<span class="org-kcats-brackets">]]</span> association assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign multiple keys where last doesn't exist, only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>a d<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128307; association <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> &#127851; assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign associative keylist from nested structure, promoted to association"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[</span>0 1 2 <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>3 c<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>0 1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association &#128238;<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign mixed keylist from nested structure, inner only is promoted to association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>association? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"Association is an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list is not an association, even if it's possible to promote"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>1 association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is not an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>&#128307; association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty list is not an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>&#128307; association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty association is an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 1 assign association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list promoted to association by assignment, is an association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>association <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list can be promoted to association"</span><span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association and list are not the same, even if keys/vals are the same"</span><span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association is not the same as the list it was promoted from"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/associations.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">Associative words</span>
<span class="org-kcats-brackets">[</span>update <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#8226;&#128737;&#65039;
                      <span class="org-kcats-brackets">[</span>lookup<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#129668;
                      &#9654;&#65039; assign<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 3<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in an association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in a nested association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 3 5 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>1 3 6 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in a mixed association/list structure"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span>
                      <span class="org-kcats-brackets">[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; 10 15<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-string">"hi"</span> 15<span class="org-kcats-brackets">]</span> <span class="org-string">"Update function can't destroy stack items"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update creates new key when it doesn't exist"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6 +<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]</span> <span class="org-string">"Update function can ignore previous value"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>lookup <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list keys<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; <span class="org-comment-delimiter">;; </span><span class="org-comment">keylist not empty</span>
                      <span class="org-kcats-brackets">[</span>&#128228; &#128256; <span class="org-kcats-brackets">[</span>get<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">extract the first key and lookup</span>
                      &#9203; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>b<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup the value of a key in an association"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>b<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup the value of a key, promoting a list to association"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"Looking up a key that doesn't exist returns Nothing"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>outer <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>outer c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup in a nested structure, with promotion"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: fix the case where you just want a value [[type foo]] - only</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">one item but you want the value, not key</span>
<span class="org-kcats-brackets">[</span>type <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>error?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>set<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[[[</span>&#128207; 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039;
                                                    <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>type<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                                                    <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                                                    <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                                                    &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
                                         <span class="org-kcats-brackets">[[[</span>type<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
                                         <span class="org-kcats-brackets">[[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> &#127851; &#8226;&#128465;&#65039; &#8226;&#128465;&#65039; dump<span class="org-kcats-brackets">]]]</span> decide
                                      &#127873; <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[]</span> &#128735;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]]]</span>
                     <span class="org-kcats-brackets">[[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]]]]</span>
                    decide &#127851; &#8226;&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association with one key assumes it is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Integers are of type number"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1.0 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Floats are of type number"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>&#128307; type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is of type nothing"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"A byte array is of type bytes"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"A string is of type string"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>set<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"A set is of type set"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>&#128307; environment type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An environment is of type environment"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association with a single type key, the value is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association with a single type key, the value is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>attr1 foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr2 <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association with multiple keys and no type key, is of type association"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>url<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]</span> <span class="org-string">"An association with type/value keys, uses the type key for its type"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>value <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128207; 1 =<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">if it's a single item</span>
                     <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the value is the value of that first item</span>
                     <span class="org-kcats-brackets">[[</span>value<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise look up the key 'value'</span>
                     &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"The value of a single-entry association is the value of the key-value pair"</span><span class="org-kcats-brackets">]</span>

                   <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"The value of an object is the value key"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>zip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dispenser values<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dispenser keys<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#9875; <span class="org-comment-delimiter">;; </span><span class="org-comment">save accumulator below args</span>
                   <span class="org-kcats-brackets">[[]</span> both?<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">stop when either list is empty</span>
                   <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> both &#8226;&#128256; pair <span class="org-comment-delimiter">;; </span><span class="org-comment">take from each list and pair them up</span>
                    &#9875; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#8226;&#129668;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put them into the accumulator</span>
                   &#9203; &#9654;&#65039;
                   &#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the empty containers</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> zip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Zip two lists together into a single list of pairs"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> zip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Zip two lists of unequal size pads with Nothing values"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>label <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized labels<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#128256; <span class="org-comment-delimiter">;; </span><span class="org-comment">labels acc</span>
                     <span class="org-kcats-brackets">[</span>&#127873; &#128735; assign<span class="org-kcats-brackets">]</span> &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"Alice"</span> 23 <span class="org-string">"123 Main St"</span> <span class="org-kcats-brackets">[</span>address age name<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>address <span class="org-string">"123 Main St"</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>age 23<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Label values on the stack as an association"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org524e610" class="outline-4">
<h4 id="org524e610"><span class="section-number-4">1.4.2.</span> Sets</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class='tangle-wrapper' data-tangle='src/kcats/core/sets-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">TODO add 'set' type for spec?</span>
<span class="org-kcats-brackets">[</span>set <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Promote a list to a set"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"hello"</span> set<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"helo"</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Promote a string to a set"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>set? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A set is a set"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list is not a set"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>contains? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item container<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"List contains a number"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>1 2 3 3 5<span class="org-kcats-brackets">]</span> set 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A set contains a number"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list doesn't contain a number"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>5 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is atomic and doesn't contain anything"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> &#127851; \o contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A word is atomic and doesn't contain anything"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-string">"food"</span> <span class="org-string">"foo"</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A string contains a sub-string"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list doesn't contain a sub-list (due to ambiguity with what 'contains' means with lists)"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A list contains another list"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> d<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A set contains a list"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-string">"food"</span> \o contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-string">"A string contains a character"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>intersection <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> intersection<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Intersection of two lists expressed as set"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgb78bf32" class="outline-4">
<h4 id="orgb78bf32"><span class="section-number-4">1.4.3.</span> Generators</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/generators.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">infinite sequence (generators) functions</span>

<span class="org-kcats-brackets">[[</span>generator <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>program program<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>liberator <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128228;<span class="org-kcats-brackets">]</span> generator<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>reap <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>description <span class="org-string">"Generates a value from a wrapped generator (stacked generator inside a list)"</span><span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#128256; &#128137; &#9654;&#65039; <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the now-empty dispenser</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers generator 5 taker collect<span class="org-kcats-brackets">]</span> reap<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 2 3 4<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>assemble <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>liberator &#9986;&#65039;1&#65039;&#8419;<span class="org-kcats-brackets">]</span> &#127890;
                         <span class="org-kcats-brackets">[</span>&#127873;<span class="org-kcats-brackets">]</span> &#129668; &#128137; &#9654;&#65039; <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span> keep
                          collect<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>1 3 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>produce <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list wrapped-generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list item<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128137; &#9654;&#65039; &#128228;<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>integers generator
                        <span class="org-kcats-brackets">[</span>&#128101; *<span class="org-kcats-brackets">]</span> each
                        10 dropper
                        <span class="org-kcats-brackets">[]</span> &#129510; 
                        produce &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>100<span class="org-kcats-brackets">]]]]]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">DEPRECATED</span>
 <span class="org-kcats-brackets">[</span>prime <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program init<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128101; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> &#8226;&#128011; &#128279; &#9203;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> &#128307; <span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> prime &#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span>
                     <span class="org-string">"Prime executes init before each time through the loop"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>&#129529; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>doc <span class="org-string">"The broom denotes a gathering - the returned program will repeatedly call the given program to generate items, and put them into the container below it."</span><span class="org-kcats-brackets">]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#9203;<span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>\a \b \c \d<span class="org-kcats-brackets">]</span> liberator <span class="org-string">""</span> &#129529; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[]</span> <span class="org-string">"abcd"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Sweep into an empty string"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>0 10 1 range liberator
                   5 dropper
                   <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                   &#128307; &#129529; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>50 60 70 80 90<span class="org-kcats-brackets">]]</span> <span class="org-string">"Generate a sequence and put it into the given container"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>collect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#129529; &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> liberator collect<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                      <span class="org-kcats-brackets">[[[</span>0 10 1 range liberator
                         5 dropper
                         <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                         collect<span class="org-kcats-brackets">]</span>
                        &#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>50 60 70 80 90<span class="org-kcats-brackets">]]</span> <span class="org-string">"Collect from a generator into an empty list"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>each <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#8226;&#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">prevent mapping program from overwriting stack</span>
                     <span class="org-kcats-brackets">[</span>&#9654;&#65039; 1&#65039;&#8419; bail<span class="org-kcats-brackets">]</span> &#127890; <span class="org-comment-delimiter">;; </span><span class="org-comment">only execute the mapping program if parent produces value</span>
                     &#128307; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span> 
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> liberator
                     <span class="org-kcats-brackets">[</span>&#128101; *<span class="org-kcats-brackets">]</span> each
                     collect<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>1 4 9 16<span class="org-kcats-brackets">]]</span> <span class="org-string">"Generate a sequence transforming each value"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>reason <span class="org-string">"Deprecated, see 'expected' for what to use instead"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>expected <span class="org-kcats-brackets">[[</span>&#128279;<span class="org-kcats-brackets">]</span> fold<span class="org-kcats-brackets">]]]</span> fail<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 9<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span>
                       assemble<span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 6 7 8 9<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>taker <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">counter still positive?</span>
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011; <span class="org-comment-delimiter">;; </span><span class="org-comment">run the parent generator</span>
                       &#128307; <span class="org-kcats-brackets">[</span>&#128307; &#128307;<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add padding to drop later</span>
                      <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#9878;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise return nothing</span>
                      <span class="org-kcats-brackets">[[</span>dec<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">decrement counter</span>
                      <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">discard the counter and parent, all done</span>
                      <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> liberator
                      3 taker
                      collect<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> liberator
                      6 taker
                      collect<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>catcher <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011; <span class="org-comment-delimiter">;; </span><span class="org-comment">get value from parent</span>
                         <span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> bail <span class="org-comment-delimiter">;; </span><span class="org-comment">only check pred iff we get a value, preserve pred</span>
                         &#128307;
                         <span class="org-kcats-brackets">[</span>&#128307; &#128307; &#128307;<span class="org-kcats-brackets">]</span> &#8596;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">place some dummy values to drop if we didn't get a value</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128256;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">iff pred matches drop the pred result </span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; &#128465;&#65039; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise drop all the stuff we no longer need</span>
                        &#9878;&#65039; &#128307;
                        <span class="org-kcats-brackets">[[</span>&#128307;<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 -4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> catcher collect<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> catcher collect<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>dropper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">condition</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011; <span class="org-comment-delimiter">;; </span><span class="org-comment">call parent </span>
                         &#128307; <span class="org-comment-delimiter">;; </span><span class="org-comment">if we get something, we're done</span>
                         <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#128307; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise signal stop with empty generator</span>
                         &#8596;&#65039;<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#9654;&#65039; &#128307;<span class="org-kcats-brackets">]</span> &#9878;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">if counter reaches zero we're done dropping </span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; dec<span class="org-kcats-brackets">]</span> &#9203;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">decrement the counter and drop the value we got</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 dropper collect<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]]]</span>
                      <span class="org-kcats-brackets">[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 dropper collect<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>skipper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">get the item from parent</span>
                        <span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run the pred on it, keep the pred</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128307; &#128307;<span class="org-kcats-brackets">]</span> &#9878;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">when parent is empty, leave negative on the stack</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#9203; &#9654;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">keep consuming items while they match pred</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">first value that doesn't match pred, drop pred,</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">leave an empty generator that falls through to the value below</span>
                        <span class="org-kcats-brackets">[[</span>&#128307;<span class="org-kcats-brackets">]]</span> &#8596;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if parent ran out, leave a generator that produces end-of-stream</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 -3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> skipper collect<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>-3 4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>keep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9654;&#65039;  <span class="org-comment-delimiter">;; </span><span class="org-comment">exec the generator below to get value v</span>
                      <span class="org-kcats-brackets">[</span>1&#65039;&#8419; &#128737;&#65039; &#9654;&#65039; &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">check if v does NOT match given pred, </span>
                      <span class="org-kcats-brackets">[</span>&#128307; &#128307;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if generator below is finished, return 2 empty values </span>
                      &#8596;&#65039;<span class="org-kcats-brackets">]</span> &#127890;
                     <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop both the value v and the result of pred</span>
                     &#9203; <span class="org-comment-delimiter">;; </span><span class="org-comment">repeat until generator below is finished</span>
                     &#128307; <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> liberator
                     <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> keep
                     collect<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>1 3 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>group <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program group-by<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128737;&#65039;
                      <span class="org-kcats-brackets">[</span>1&#65039;&#8419; &#9654;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">k v state</span>
                       &#127873; &#128256;   <span class="org-comment-delimiter">;;  </span><span class="org-comment">v k state</span>
                       &#127873; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#128279; update<span class="org-kcats-brackets">]</span> &#127890;
                      &#128307; association <span class="org-comment-delimiter">;; </span><span class="org-comment">state f</span>
                      &#128256; cram<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> liberator <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> group<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[[</span>&#10004;&#65039; <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>2 4<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO rewrite in terms of parse</span>
 <span class="org-kcats-brackets">[</span>split <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program sized sized<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#8226;&#128011; &#128737;&#65039;<span class="org-kcats-brackets">]</span> decorated
                      <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> &#8226;&#128011; <span class="org-kcats-brackets">[</span>&#128101; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128256; ends? &#9775;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> prime
                       &#128465;&#65039;
                       <span class="org-kcats-brackets">[</span>&#128256; ends?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011;
                        <span class="org-kcats-brackets">[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011; &#128256; - <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> &#129668; slice<span class="org-kcats-brackets">]</span>
                       when
                       <span class="org-kcats-brackets">[</span>empty<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256;<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcabc"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"b"</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"ca"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3 4 2 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>parse <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program partial-parser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program parser<span class="org-kcats-brackets">]]]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"A stream parser. On the stack should be a program that takes 2 args:</span>
<span class="org-string">               parsed object output sequence (on top), and unparsed input sequence. The function should</span>
<span class="org-string">               return a new input and output sequence, with the input no larger, and</span>
<span class="org-string">               output no smaller than before. The function can also no-op if there isn't</span>
<span class="org-string">               enough input to parse a complete object."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; &#128307;            <span class="org-comment-delimiter">;; </span><span class="org-comment">state - parsed object output (on top) and unparsed input </span>
                      <span class="org-kcats-brackets">[[</span>&#128101; &#9775;&#65039;<span class="org-kcats-brackets">]</span>         <span class="org-comment-delimiter">;; </span><span class="org-comment">there's no output</span>
                       <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#128011;<span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">exec parent generator </span>
                       <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#9878;&#65039;         <span class="org-comment-delimiter">;; </span><span class="org-comment">leave an empty value to be consumed by outer &#9203; exiting</span>
                       <span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[</span>&#128279;<span class="org-kcats-brackets">]</span> &#129668;     <span class="org-comment-delimiter">;; </span><span class="org-comment">new input to previous input</span>
                        <span class="org-kcats-brackets">[</span>&#128101;<span class="org-kcats-brackets">]</span> &#8226;&#128011; &#9654;&#65039;<span class="org-kcats-brackets">]</span>   <span class="org-comment-delimiter">;; </span><span class="org-comment">exec a copy of parser program: output input parser</span>
                       &#9203; &#9654;&#65039;<span class="org-kcats-brackets">]</span>          <span class="org-comment-delimiter">;; </span><span class="org-comment">leave the output on top for the recurrence condition check</span>
                      <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> &#129670;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[[</span>104 101 108 108 111<span class="org-kcats-brackets">]</span>              <span class="org-comment-delimiter">;; </span><span class="org-comment">"hello" (all ASCII)</span>
                        <span class="org-kcats-brackets">[</span>228 189 160 229 165 189<span class="org-kcats-brackets">]</span>          <span class="org-comment-delimiter">;; </span><span class="org-comment">"&#20320;&#22909;" (two complete Chinese chars)</span>
                        <span class="org-kcats-brackets">[</span>104 105 226<span class="org-kcats-brackets">]</span>                      <span class="org-comment-delimiter">;; </span><span class="org-comment">"hi" + start of "&#8364;"</span>
                        <span class="org-kcats-brackets">[</span>130 172<span class="org-kcats-brackets">]</span>                          <span class="org-comment-delimiter">;; </span><span class="org-comment">completion of "&#8364;"</span>
                        <span class="org-kcats-brackets">[</span>240 159 145<span class="org-kcats-brackets">]</span>                      <span class="org-comment-delimiter">;; </span><span class="org-comment">start of "&#128081;"</span>
                        <span class="org-kcats-brackets">[</span>145<span class="org-kcats-brackets">]</span>                              <span class="org-comment-delimiter">;; </span><span class="org-comment">completion of "&#128081;"</span>
                        <span class="org-kcats-brackets">[</span>97 98 99 240<span class="org-kcats-brackets">]</span>                     <span class="org-comment-delimiter">;; </span><span class="org-comment">"abc" + start of "&#127752;"</span>
                        <span class="org-kcats-brackets">[</span>159 140 136<span class="org-kcats-brackets">]]</span>                     <span class="org-comment-delimiter">;; </span><span class="org-comment">completion of "&#127752;"</span>

                       liberator
                       <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span> &#128256; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#129692; &#9654;&#65039;<span class="org-kcats-brackets">]</span> each <span class="org-comment-delimiter">;; </span><span class="org-comment">convert lists of ints to byte arrays</span>
                       <span class="org-kcats-brackets">[</span>parse-utf8<span class="org-kcats-brackets">]</span>
                       parse <span class="org-string">""</span> &#129529; &#9654;&#65039;<span class="org-kcats-brackets">]</span> reap<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-string">"hello&#20320;&#22909;hi&#8364;&#128081;abc&#127752;"</span><span class="org-kcats-brackets">]]</span>

                    <span class="org-kcats-brackets">[[[[</span><span class="org-string">"[foo] [bar] [ba"</span>
                        <span class="org-string">"z] [quux"</span>
                        <span class="org-string">"] [[this] "</span>
                        <span class="org-string">"[that]]"</span>
                        <span class="org-string">"[foo"</span> <span class="org-string">"]"</span><span class="org-kcats-brackets">]</span> liberator
                       <span class="org-kcats-brackets">[</span>parse-edn<span class="org-kcats-brackets">]</span> parse collect<span class="org-kcats-brackets">]</span>
                      reap<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>baz<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>quux<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>this<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>that<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>combinations <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039; -1 <span class="org-comment-delimiter">;; </span><span class="org-comment">l idx i</span>
                             <span class="org-kcats-brackets">[[[</span>&#128256; &#128207; =<span class="org-kcats-brackets">]</span> &#128011;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; &#128228; 0 &#128256;<span class="org-kcats-brackets">]</span> when
                              <span class="org-kcats-brackets">[[</span>&#127873; lookup<span class="org-kcats-brackets">]</span> &#128011; <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> &#8226;&#129668;<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>combinations<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>frequencies <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128307; association
                            <span class="org-kcats-brackets">[</span>&#127873; <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> &#9878;&#65039;<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                            cram<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"Hello there!"</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> frequencies<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[[</span>\space 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\! 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\H 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\e 3<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\h 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\l 2<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\o 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\r 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\t 1<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>fold <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">generate the first item below the reducer</span>
                     cram<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers generator
                      1 dropper
                      10 taker
                      <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> fold<span class="org-kcats-brackets">]</span> reap<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>cram <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>item initial-value<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">check that we generated another item</span>
                     <span class="org-kcats-brackets">[</span>&#128256; <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039; &#9875; &#8226;&#128465;&#65039; &#8226;&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if so, run the reducer shielded and drop component items</span>
                     &#128307; <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise stop</span>
                     <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129670;
                     &#9654;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers generator
                      1 dropper
                      10 taker
                      0 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> cram<span class="org-kcats-brackets">]</span>
                     reap<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>integers <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>-1 <span class="org-kcats-brackets">[</span>inc &#128101;<span class="org-kcats-brackets">]]]]]]</span>
&#128279;
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/more-generators.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">partition</span>
<span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the spec</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">construct the dynamic definition for partition</span>

<span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[[</span>taker collect
               &#8226;&#128465;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">drop the used-up taker generator</span>
              &#128279; &#8226;&#8226;&#128011;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>shift <span class="org-kcats-brackets">[[[</span>&#128207; &lt;=<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>&#128256; 0 slice<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#9878;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256;<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[</span>&#128307;
 <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span>&#128279; shift<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> &#128011; <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk &#128256; &#128465;&#65039; shift<span class="org-kcats-brackets">]</span>
 &#9878;&#65039;<span class="org-kcats-brackets">]</span> let 
<span class="org-comment-delimiter">;; </span><span class="org-comment">add an empty list for the partition state</span>
<span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#128256; &#128238; <span class="org-comment-delimiter">;; </span><span class="org-comment">the definition</span>

<span class="org-kcats-brackets">[[[[</span>1 2 3 4 5 6 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">examples</span>

<span class="org-kcats-brackets">[</span>examples definition spec<span class="org-kcats-brackets">]</span> label <span class="org-kcats-brackets">[</span>partition<span class="org-kcats-brackets">]</span> &#128256; assign
<span class="org-kcats-brackets">[[</span>pairwise <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128307; &#129510; <span class="org-comment-delimiter">;; </span><span class="org-comment">capture stack</span>
                          <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">pair up stack items</span>
                         &#128137; <span class="org-comment-delimiter">;; </span><span class="org-comment">run the program on the pairs</span>
                         <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> assemble <span class="org-comment-delimiter">;; </span><span class="org-comment">unpair the items</span>
                         <span class="org-function-name">unwrap</span> &#128307; &#128256; &#129510; &#128465;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">restore as the stack</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 4 5 2 3<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span>&#128735;<span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4 5 1<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[[[</span>+<span class="org-kcats-brackets">]</span> &#128137;<span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 5 9<span class="org-kcats-brackets">]]]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-org202e17c" class="outline-3">
<h3 id="org202e17c"><span class="section-number-3">1.5.</span> Dictionary modules</h3>
<div class="outline-text-3" id="text-1-5">
<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>dictionary <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>cache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>decache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>hashbytes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode hashbytes<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> &#9654;&#65039; =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode hashbytes
                         <span class="org-string">"fop"</span> encode hashbytes
                         =<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>resolve <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>+<span class="org-kcats-brackets">]</span> &#127851; resolve<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>core/+<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>namespace <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo<span class="org-kcats-brackets">]</span> &#127851; #b64 <span class="org-string">"quux"</span> namespace<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>quux/foo<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>unnamespace <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes word<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>quux/foo<span class="org-kcats-brackets">]</span> &#127851; unnamespace<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo #b64 <span class="org-string">"quux"</span><span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dictmerge <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dictionary module<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dictionary original<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>updates <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized word-updates<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program single-update<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#128228;<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#127873;<span class="org-kcats-brackets">]</span> update <span class="org-comment-delimiter">;; </span><span class="org-comment">wrap the word name to get a path to update</span>
                         <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> &#128279;<span class="org-kcats-brackets">]</span> each
                        joiner generate<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>entry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program definition<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>association full-entry<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>definition<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>words <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dictionary <span class="org-kcats-brackets">[</span>words<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>module <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item wrapped-module-alias-or-hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"reads a cached module from disk and puts it on the stack as a program"</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>decache string read<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[</span>
          <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> encode <span class="org-kcats-brackets">[</span>crypto<span class="org-kcats-brackets">]</span> stdmod <span class="org-kcats-brackets">[</span>hash<span class="org-kcats-brackets">]</span> confine<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"_1vRbfFezlcTCUfQCjC1FKukWLoOAeBuvxNXUDbFKSk"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inscribe <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes raw-module<span class="org-kcats-brackets">]</span> dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>hashbytes<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">calculate module hash</span>
                         <span class="org-kcats-brackets">[</span>string read <span class="org-kcats-brackets">[</span>words<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">install the module in the dictionary</span>
                        <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">fork </span>
                        &#8226;&#128465;&#65039; &#127851; &#8226;&#128256; dictmerge<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>draft <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized definitions<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program dictionary-updater<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>entry<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span> &#128668; &#9654;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">create full entries for each definition</span>
                    <span class="org-kcats-brackets">[</span>1&#65039;&#8419; &#128279;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">add 'join' to join the entries with the existing dictionary</span>

<span class="org-kcats-brackets">[</span>let <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>sized entries<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>draft dictionary &#128256; <span class="org-kcats-brackets">[</span>emit encode hashbytes<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039; 
                    <span class="org-kcats-brackets">[[[</span>words<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9654;&#65039; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> &#129668;
                    &#9875; <span class="org-kcats-brackets">[</span>dictmerge<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#129668;
                   &#128735; &#127873; <span class="org-kcats-brackets">[</span>&#128238;<span class="org-kcats-brackets">]</span> &#128279;
                   &#8226;&#128256; <span class="org-kcats-brackets">[</span>modules<span class="org-kcats-brackets">]</span> &#128256; update
                   <span class="org-kcats-brackets">[</span>dictionary program<span class="org-kcats-brackets">]</span> label environment
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO try using confine here</span>
                   <span class="org-kcats-brackets">[</span>1&#65039;&#8419; capture evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span> 
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>times5 <span class="org-kcats-brackets">[</span>5 *<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>doubledec <span class="org-kcats-brackets">[</span>dec dec<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span>3 times5 doubledec<span class="org-kcats-brackets">]</span> let &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>13<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[[</span>&#128256; <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> &#128256;<span class="org-kcats-brackets">]</span>
                   let &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> 5<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[[</span>foo <span class="org-kcats-brackets">[</span><span class="org-string">"outer"</span><span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-string">"inner"</span><span class="org-kcats-brackets">]</span> let
                   <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> label
                   <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> let &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"inner"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>cache &#9986;&#65039;1&#65039;&#8419; definition<span class="org-kcats-brackets">]</span> &#127890; dictionary &#128256; lookup<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]</span> definition &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Fetch the definition of a builtin word and use it"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>1 2 3 <span class="org-kcats-brackets">[</span>flip<span class="org-kcats-brackets">]</span> definition &#9654;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Fetch the definition of a word and use it"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org9c3245e" class="outline-3">
<h3 id="org9c3245e"><span class="section-number-3">1.6.</span> Math</h3>
<div class="outline-text-3" id="text-1-6">
<div class='tangle-wrapper' data-tangle='src/kcats/core/math-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 + 3.3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3.2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>- <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 -<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 - -1.1 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 - 1.2 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>10 1.5 * 15 0.0001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 0 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 -1 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>/ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 3 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>15 1.5 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10.0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>0 1 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 0 / handle <span class="org-kcats-brackets">[</span>reason<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 <span class="org-string">"division by zero"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>quot <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>16 5 quot<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>rem <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 rem<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>mod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 mod<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>exp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 5 exp<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>32<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>log <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>32 2 log<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>floor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 floor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>ceiling <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 ceiling<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>round <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 round<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sqrt <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>9 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>81 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>9<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inc <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>99 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>100<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>100 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>99<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>abs <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2.1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-0.2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>odd? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>-1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>4 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>even? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>3 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>zero? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>0.0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-0.00001 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1.1 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>number? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>&#128307; number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>5 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>5.01 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>number <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"-11.1"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-11.1<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-function-name">first</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>97<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/math.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>positive? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>negative? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &lt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>within? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>- abs<span class="org-kcats-brackets">]</span> &#129668; &lt;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1.0 2.0 + 3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/fib.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>fibonacci <span class="org-kcats-brackets">[[</span>definition <span class="org-kcats-brackets">[</span>1 0 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; &#9654;&#65039; &#128256; &#128101;<span class="org-kcats-brackets">]]]]]]</span>
&#128279; 
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org9359289" class="outline-3">
<h3 id="org9359289"><span class="section-number-3">1.7.</span> Serialization</h3>
<div class="outline-text-3" id="text-1-7">
<div class='tangle-wrapper' data-tangle='src/kcats/core/serialize-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>read <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[1 [2] 3]"</span> read<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>emit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]</span> emit<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1 [2] 3"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>parse-edn <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list current-output-sequence<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string input-to-parse<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>list updated-output-sequence<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string remaining-input<span class="org-kcats-brackets">]]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[foo] [ba"</span> &#128307; parse-edn<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">" [ba"</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]]]]]]]]</span>

<span class="org-kcats-brackets">[</span>autoformat <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[[foo bar] [baz [[quux floop] [toop zoop]]]]"</span> autoformat<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"[[foo bar]\n [baz [[quux floop]\n       [toop zoop]]]]"</span><span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org2f98b2e" class="outline-3">
<h3 id="org2f98b2e"><span class="section-number-3">1.8.</span> Boolean logic</h3>
<div class="outline-text-3" id="text-1-8">
<div class='tangle-wrapper' data-tangle='src/kcats/core/boolean-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>&#10004;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">self-inserts</span>

<span class="org-kcats-brackets">[</span>and <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 2 even? and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>2 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>&#128307; 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>or <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 3 even? or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>&#128307; 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>&#128307; &#128307; or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>&#9775;&#65039; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 even? &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>&#10004;&#65039; &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>&#128307; &#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org71d9511" class="outline-3">
<h3 id="org71d9511"><span class="section-number-3">1.9.</span> Byte encoding and decoding</h3>
<div class="outline-text-3" id="text-1-9">
<div class='tangle-wrapper' data-tangle='src/kcats/core/encode-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>character <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>character<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>97 character<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\a<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>128526 character<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\&#128526;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodestring <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodenumber <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw"</span><span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>12.3 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"QCiZmZmZmZo"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>decodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"12.01"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12.01<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"\"foo\""</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"{\"foo\": 12, \"bar\": \"baz\"}"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"[1,\"foo\"]"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>12.01 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12.01"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"\"foo\""</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association encodejson decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1,\"foo\"]"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bytes? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Zm9v"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>xor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 12 xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">10 = 01010, 12 = 01100, 00110, 6</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"bar"</span> encode xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"BA4d"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bits <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>encode <span class="org-kcats-brackets">[[</span>2 radix 8 0 pad<span class="org-kcats-brackets">]</span> each joiner<span class="org-kcats-brackets">]</span> assemble &#127851;<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bits<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 1 0 0 1 1 0 0 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1<span class="org-kcats-brackets">]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/encode.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>encode <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; encodestring<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; encodenumber<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; emit encode<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>radix <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>/<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256;
                       <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039;
                       &#8226;&#128256; -
                       &#128256; <span class="org-kcats-brackets">[</span>prepend<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span>
                      &#128256; prepend
                      <span class="org-kcats-brackets">[</span>&#128307; &#128256; <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]]</span> &#129668;
                      &#9203; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>7 2 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 1 1<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>9 3 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 0 0<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>255 16 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>15 15<span class="org-kcats-brackets">]]]]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgca5d580" class="outline-3">
<h3 id="orgca5d580"><span class="section-number-3">1.10.</span> Strings</h3>
<div class="outline-text-3" id="text-1-10">
<div class='tangle-wrapper' data-tangle='src/kcats/core/strings-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1 2 3]"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>&#128307; string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>format <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo {} bar {} baz"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span> <span class="org-string">"def"</span><span class="org-kcats-brackets">]</span> format<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo abc bar def baz"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>parse-utf8 <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized current-output<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes input<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>string updated-output-sequence<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes remaining-input<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>#b64 <span class="org-string">"aGni"</span> <span class="org-string">""</span> parse-utf8<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"4g"</span> <span class="org-string">"hi"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"aGVsbG8"</span> <span class="org-string">""</span> parse-utf8<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span> <span class="org-string">"hello"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>string? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>&#10004;&#65039; string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Don't really belong here but good enough for now</span>
<span class="org-kcats-brackets">[</span>word? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo<span class="org-kcats-brackets">]</span> &#127851; word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>&#10004;&#65039; word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1 word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"&#10004;&#65039;"</span> word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>word <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> &#127851;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inspect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org679e4e9" class="outline-3">
<h3 id="org679e4e9"><span class="section-number-3">1.11.</span> Error handling</h3>
<div class="outline-text-3" id="text-1-11">
<div class='tangle-wrapper' data-tangle='src/kcats/core/errors-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>error? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">handle is a special word only used to unwind the program on</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">error, if there's no error and we end up reaching this word, we</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">ignore it.</span>
<span class="org-kcats-brackets">[</span>handle <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; &#128307;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>definition &#128307;<span class="org-kcats-brackets">]]]</span>

<span class="org-kcats-brackets">[</span>fail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/errors.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>assert <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128248; <span class="org-comment-delimiter">;; </span><span class="org-comment">save stack to print in err message</span>
                       <span class="org-kcats-brackets">[</span>&#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011; <span class="org-comment-delimiter">;; </span><span class="org-comment">run the assertion under the saved stack</span>
                       <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if passes, drop the saved stack, dont need</span>
                       <span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[</span><span class="org-string">"assertion failed "</span><span class="org-kcats-brackets">]</span> &#129668; &#128279; fail<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">else throw err</span>

 <span class="org-kcats-brackets">[</span>&#129657; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program error-handler<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program to-attempt<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#128248;<span class="org-kcats-brackets">]</span> &#128011;
                         &#128256; <span class="org-kcats-brackets">[</span>handle<span class="org-kcats-brackets">]</span> &#128279; &#128137; &#9654;&#65039; 
                         <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> error?<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                         <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-function-name">first</span> &#9986;&#65039;1&#65039;&#8419;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span>&#129510; &#128465;&#65039;<span class="org-kcats-brackets">]</span>
                         &#9878;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#127890;<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>+<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; 1
                         <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; 2 +<span class="org-kcats-brackets">]</span>
                         &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                        &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-string">"oh fudge"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>5 +<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; 5<span class="org-kcats-brackets">]</span>
                        &#129657;
                        <span class="org-kcats-brackets">[</span>&#127873;<span class="org-kcats-brackets">]</span> &#129668; &#128279; <span class="org-comment-delimiter">;; </span><span class="org-comment">curry the mapping function too</span>
                        &#128668; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>6 7 5<span class="org-kcats-brackets">]]]</span>

                      <span class="org-kcats-brackets">[[[</span>&#128256;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128256;<span class="org-kcats-brackets">]</span> &#129657; &#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128256;<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>retry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>unwound<span class="org-kcats-brackets">]</span> lookup
                      &#9654;&#65039;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 <span class="org-string">"four"</span> * + handle <span class="org-kcats-brackets">[</span>&#128465;&#65039; 4<span class="org-kcats-brackets">]</span> &#129668; retry<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>14<span class="org-kcats-brackets">]]]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org7796cb4" class="outline-3">
<h3 id="org7796cb4"><span class="section-number-3">1.12.</span> Methods</h3>
<div class="outline-text-3" id="text-1-12">
<p>
We want a way of adding methods to a word that's already set up as a
simple 'decide' form. This will add the method at the beginning -
adding it at the end is not good because often there's a catchall
condition at the end, and adding beyond that means the new condition
is unreachable. Adding at the beginning is not always what the user
wants either, though. So maybe this could be improved by taking
another argument: a program to combine the item and the existing list
(that defaults to <code>prepend</code> here).
</p>
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/methods.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>addmethod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program method<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program definition<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>program newdefinition<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>2&#65039;&#8419; 1&#65039;&#8419;<span class="org-kcats-brackets">]</span> prepend<span class="org-kcats-brackets">]</span> &#127890;
                          <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[[[</span>&#128207; 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> &#128238;<span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>&#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128238;<span class="org-kcats-brackets">]]]</span> decide<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>&#128207; 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> addmethod<span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[[</span>&#128207; 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>&#128207; 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> &#128238;<span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>&#9775;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128238;<span class="org-kcats-brackets">]]]</span>
                           decide<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>method? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>pair?<span class="org-kcats-brackets">]</span>
                                 <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]]</span> every?<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>decide<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]]</span>
                        every?<span class="org-kcats-brackets">]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgeace99a" class="outline-3">
<h3 id="orgeace99a"><span class="section-number-3">1.13.</span> Database</h3>
<div class="outline-text-3" id="text-1-13">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/database.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>list selection<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list constraints<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]</span>

<span class="org-kcats-brackets">[[</span>fork <span class="org-kcats-brackets">[[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>triangle <span class="org-kcats-brackets">[[</span>&#128307; <span class="org-kcats-brackets">[[</span>&#128228;<span class="org-kcats-brackets">]</span> &#129668; &#128256; <span class="org-kcats-brackets">[[</span>&#128238;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#9875; &#128256; pair<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> collect<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>indexed-as-property <span class="org-kcats-brackets">[</span>&#128256; indexed
                       <span class="org-kcats-brackets">[</span>&#127851; &#9875; assign<span class="org-kcats-brackets">]</span> &#128668; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span>-all <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> empty<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256; <span class="org-kcats-brackets">[</span>&#128279;<span class="org-kcats-brackets">]</span> &#129692;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>selectkeys <span class="org-kcats-brackets">[</span>set <span class="org-kcats-brackets">[</span>1&#65039;&#8419; <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#128011; contains?<span class="org-kcats-brackets">]</span> &#127890; &#129522;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>invert <span class="org-kcats-brackets">[[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> &#128668; association<span class="org-kcats-brackets">]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">datalog variables</span>
 <span class="org-kcats-brackets">[</span>variable? <span class="org-kcats-brackets">[[[</span>word?<span class="org-kcats-brackets">]</span>
              <span class="org-kcats-brackets">[</span>string <span class="org-function-name">last</span> \? =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>variable= <span class="org-kcats-brackets">[[[</span>pair <span class="org-kcats-brackets">[</span>variable?<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]]</span> 

 <span class="org-comment-delimiter">;; </span><span class="org-comment">datalog constraints</span>
 <span class="org-kcats-brackets">[</span>slots <span class="org-kcats-brackets">[[</span>entity attribute value<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>slot-combos <span class="org-kcats-brackets">[</span>slots <span class="org-kcats-brackets">[</span>slots <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]</span> &#128668; <span class="org-function-name">join</span>-all<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>constraint <span class="org-kcats-brackets">[</span>&#127851; slots <span class="org-function-name">reverse</span> label<span class="org-kcats-brackets">]]</span> 

 <span class="org-comment-delimiter">;; </span><span class="org-comment">links between datalog constraints</span>
 <span class="org-kcats-brackets">[</span>links <span class="org-kcats-brackets">[</span>slot-combos
         <span class="org-kcats-brackets">[[</span>&#127873;<span class="org-kcats-brackets">]</span> &#128668; &#127851; &#8226;&#128256; 
          <span class="org-kcats-brackets">[[[</span>lookup<span class="org-kcats-brackets">]</span> &#128137;<span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> pairwise 
          variable=<span class="org-kcats-brackets">]</span>
         &#129522;    
         <span class="org-kcats-brackets">[</span>&#127851; pair &#9875; pair
          <span class="org-kcats-brackets">[[</span>index<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#128668; &#128256; zip<span class="org-kcats-brackets">]</span>
         &#128668;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>all-links <span class="org-kcats-brackets">[</span>&#128307; &#9875;
             <span class="org-kcats-brackets">[[[[</span>index<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> both <span class="org-comment-delimiter">;; </span><span class="org-comment">lookup the indices of both constraints</span>
              <span class="org-kcats-brackets">[</span>&#8226;&#128256;<span class="org-kcats-brackets">]</span> &#129668; &#9875; <span class="org-comment-delimiter">;; </span><span class="org-comment">move the indices under the constraints</span>
              <span class="org-kcats-brackets">[</span>links<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039;
              &#128256; <span class="org-kcats-brackets">[</span>&#8226;&#128465;&#65039; &#8226;&#128465;&#65039; &#128279;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span> 

             &#129692; &#128465;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>format-link <span class="org-kcats-brackets">[[</span>&#128279;<span class="org-kcats-brackets">]</span> &#128137; &#127851; <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]</span> &#128668;
               <span class="org-string">"c{0}.{1} = c{2}.{3}"</span> &#128256; format<span class="org-kcats-brackets">]]</span> 

 <span class="org-comment-delimiter">;; </span><span class="org-comment">formatting pieces of query data into text</span>
 <span class="org-kcats-brackets">[</span>anded-together <span class="org-kcats-brackets">[</span><span class="org-string">" AND "</span> interpose <span class="org-function-name">join</span>-all<span class="org-kcats-brackets">]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">where clause data processing</span>
 <span class="org-kcats-brackets">[</span>where-data <span class="org-kcats-brackets">[[[</span>index<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256; 
              <span class="org-kcats-brackets">[[[</span><span class="org-function-name">second</span> variable? &#9775;&#65039;<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>index<span class="org-kcats-brackets">]</span> &#127851; = &#9775;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]</span> &#129522; 
              <span class="org-kcats-brackets">[</span>&#128256; prepend<span class="org-kcats-brackets">]</span> &#128668; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>format-where <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> &#128668; 
                <span class="org-string">"c{0}.{1} = :c{0}{1}"</span> &#128256; format<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>make-where <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>where<span class="org-kcats-brackets">]</span> lookup anded-together<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>format-<span class="org-function-name">join</span> <span class="org-kcats-brackets">[[[[</span>on<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>where<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>index<span class="org-kcats-brackets">]</span> lookup string<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128668;
               <span class="org-kcats-brackets">[</span>&#128279; anded-together<span class="org-kcats-brackets">]</span> &#128137; 
               <span class="org-string">"JOIN EAV c{1} ON {0}"</span> &#128256; format<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>make-query <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span> <span class="org-kcats-brackets">[[</span>on<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>format-link<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]</span> update
                    <span class="org-kcats-brackets">[</span>format-<span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span>&#128279;<span class="org-kcats-brackets">]</span> &#128256; assign<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">SQL parameters for rusqlite</span>
 <span class="org-kcats-brackets">[</span>param-name <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> &#128668; <span class="org-string">":c{0}{1}"</span> &#128256; format<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>extract-params <span class="org-kcats-brackets">[</span>&#128307; association &#128256; <span class="org-kcats-brackets">[[</span>params<span class="org-kcats-brackets">]</span> lookup &#128279;<span class="org-kcats-brackets">]</span> &#129692;<span class="org-kcats-brackets">]]</span>


 <span class="org-comment-delimiter">;; </span><span class="org-comment">SELECT clause</span>
 <span class="org-kcats-brackets">[</span>wordval? <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> word?<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>invert <span class="org-kcats-brackets">[[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> &#128668; association<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>validate <span class="org-kcats-brackets">[[[</span><span class="org-function-name">second</span> &#9775;&#65039;<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-string">"All selected query variables must appear somewhere in constraints"</span>
              <span class="org-kcats-brackets">[</span>reason variable<span class="org-kcats-brackets">]</span> label fail<span class="org-kcats-brackets">]</span>
             when<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>select-data <span class="org-kcats-brackets">[</span>&#128256;
               <span class="org-kcats-brackets">[[</span>slots selectkeys invert<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                <span class="org-kcats-brackets">[</span>wordval?<span class="org-kcats-brackets">]</span> &#129522; &#128279; association<span class="org-kcats-brackets">]</span> &#128668;
               &#128256;
               <span class="org-kcats-brackets">[[[[</span>index 1&#65039;&#8419;<span class="org-kcats-brackets">]</span> selectkeys<span class="org-kcats-brackets">]</span> &#127890; <span class="org-comment-delimiter">;; </span><span class="org-comment">make the program to cut down </span>
                 &#128668; 
                 <span class="org-kcats-brackets">[</span>&#128207; 2 =<span class="org-kcats-brackets">]</span> &#129522; <span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> &#128668;
                 <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">items are in random order due to coming from association, fix the order</span>
                &#128668;<span class="org-kcats-brackets">]</span>
               &#128737;&#65039; &#8226;&#8226;&#128465;&#65039; zip
               validate<span class="org-kcats-brackets">]]</span>

 <span class="org-comment-delimiter">;; </span><span class="org-comment">query </span>
 <span class="org-kcats-brackets">[</span>extract-data <span class="org-kcats-brackets">[[[[</span>&#127851; all-links<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> where-data   <span class="org-comment-delimiter">; </span><span class="org-comment">[&#128279;] &#128137; &#127851;</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">build the query param &#128668;</span>
                   <span class="org-kcats-brackets">[[</span>&#128307; &#128256;
                     <span class="org-kcats-brackets">[[</span>param-name<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> &#129668; &#127873; &#128256; assign<span class="org-kcats-brackets">]</span>
                     &#129692;<span class="org-kcats-brackets">]</span>
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">build the actual query where clauses</span>
                    <span class="org-kcats-brackets">[[</span>format-where<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]]</span>
                   fork<span class="org-kcats-brackets">]]</span>
                 fork<span class="org-kcats-brackets">]</span> &#128737;&#65039;
                <span class="org-comment-delimiter">;; </span><span class="org-comment">combine extracted items</span>

                <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">keep the original constraint to add properties to</span>
                &#127851; &#127851; <span class="org-kcats-brackets">[</span>where params on<span class="org-kcats-brackets">]</span> label &#128279;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>format-select <span class="org-kcats-brackets">[[</span>&#127851; &#128256;
                  string butlast <span class="org-comment-delimiter">;; </span><span class="org-comment">remove the ? from the variable name for result column</span>
                  &#128238;
                  <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]</span> &#128668; %
                  <span class="org-string">"c{1}.{0} as {2}"</span> &#128256; format<span class="org-kcats-brackets">]</span> &#128668; <span class="org-string">", "</span> interpose <span class="org-function-name">join</span>-all<span class="org-kcats-brackets">]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This is the program we need to modify that is `query`</span>

<span class="org-kcats-brackets">[</span>&#128256;
 <span class="org-comment-delimiter">;; </span><span class="org-comment">expand all combinations of constraints</span>
 <span class="org-kcats-brackets">[</span>constraint<span class="org-kcats-brackets">]</span> &#128668;
 <span class="org-comment-delimiter">;;</span><span class="org-comment">&#128307; prepend ;; an empty constraint to represent the orignal EAV table we're joining with</span>
 <span class="org-kcats-brackets">[</span>index<span class="org-kcats-brackets">]</span> indexed-as-property
 triangle
 <span class="org-comment-delimiter">;; </span><span class="org-comment">for each pair of constraints, build the "ON" clause data for the JOIN</span>
 <span class="org-kcats-brackets">[</span>extract-data<span class="org-kcats-brackets">]</span> &#128668;
 <span class="org-kcats-brackets">[[</span>extract-params<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>make-query<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>make-where<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>&#128256; select-data<span class="org-kcats-brackets">]]</span> fork 
 &#8226;&#128465;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">don't need original anymore</span>
 &#127851; &#128735;
 <span class="org-kcats-brackets">[[</span>&#128279;<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#128668;  
 &#128256; format-select 
 <span class="org-kcats-brackets">[</span><span class="org-string">" "</span> interpose <span class="org-function-name">join</span>-all<span class="org-kcats-brackets">]</span> &#129668; triplet <span class="org-function-name">reverse</span>
 <span class="org-string">"SELECT {0} from EAV as c0 {1} WHERE {2}"</span> &#128256; format
 &#128256; &#8226;&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span>

let
<span class="org-kcats-brackets">[</span>definition spec<span class="org-kcats-brackets">]</span> label
<span class="org-kcats-brackets">[</span>query<span class="org-kcats-brackets">]</span> &#128256; assign
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org4715a6c" class="outline-3">
<h3 id="org4715a6c"><span class="section-number-3">1.14.</span> Pipes</h3>
<div class="outline-text-3" id="text-1-14">
<div class='tangle-wrapper' data-tangle='src/kcats/core/pipes-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>pipe? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>timestamps pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>standard pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>5 pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>animate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>attend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>handoff <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>receiver <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>select <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list pipes<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item pipe <span class="org-kcats-brackets">[</span>list pipes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sender <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>serversocket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>socket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>standard <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timestamps <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>database <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized params<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>persist <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/pipes.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>pipe-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                        <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>value file-in<span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]]]</span>
                        decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>tunnel <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                       <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span>&#128101;
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#129668;
                          serversocket<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-client<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span>&#128101;
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#129668;
                          socket<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>pipe-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                         <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span>value file-out<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> &#127851; =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span>&#128101;
                            <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                            <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> &#129668;
                            serversocket<span class="org-kcats-brackets">]]]</span>
                         decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>spit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item target<span class="org-kcats-brackets">]]</span> &#128307;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pipe-in<span class="org-kcats-brackets">]</span> &#129668; encode &#128238; &#128465;&#65039;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>slurp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128228;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128279;<span class="org-kcats-brackets">]</span> fold string <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>print <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>standard<span class="org-kcats-brackets">]</span> &#129668; <span class="org-string">"\n"</span> &#128279; encodestring &#128238; &#128465;&#65039;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-comment-delimiter">;;</span><span class="org-comment">[slurp [[spec [[[item target]] [item pipe]]]]]</span>

 <span class="org-kcats-brackets">[</span>sleep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>timer &#128228; &#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>future <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>handoff &#128256;
                       <span class="org-kcats-brackets">[[</span>&#9986;&#65039;1&#65039;&#8419; &#128248;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">return entire stack</span>
                        &#128011; &#128238; &#128465;&#65039;<span class="org-kcats-brackets">]</span> &#127890;
                       dictionary &#128256; spawn animate<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 +<span class="org-kcats-brackets">]</span> future &#128228; &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>close <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> &#128307;<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgbff306a" class="outline-3">
<h3 id="orgbff306a"><span class="section-number-3">1.15.</span> Crypto</h3>
<div class="outline-text-3" id="text-1-15">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>random <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>key <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode key<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes message<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association key<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>verify <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes signature<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>bytes message<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>sized key<span class="org-kcats-brackets">]]</span>

                <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> encode key <span class="org-string">"we attack at dawn"</span> encode <span class="org-kcats-brackets">[</span>sign<span class="org-kcats-brackets">]</span> &#128737;&#65039; verify<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>delegated <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>association pubkey<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>&#9875; <span class="org-comment-delimiter">;; </span><span class="org-comment">css cs pk</span>
                            <span class="org-kcats-brackets">[[</span>hash<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128737;&#65039; &#129668;<span class="org-kcats-brackets">]</span> decorated <span class="org-comment-delimiter">;; </span><span class="org-comment">css csh cs pk</span>
                             &#128735; <span class="org-comment-delimiter">;; </span><span class="org-comment">cs css csh pk</span>
                             <span class="org-kcats-brackets">[</span>verify<span class="org-kcats-brackets">]</span> &#129668;
                             <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the program to run if the child script isn't authorized</span>
                             &#8596;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">runs the child script if the sig on its hash is verified</span>
                            <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">the sig and (empty) child script -&gt; pk sig msg</span>
                             &#9875; <span class="org-comment-delimiter">;; </span><span class="org-comment">sig msg pk</span>
                             verify<span class="org-kcats-brackets">]</span>
                            <span class="org-kcats-brackets">[</span>&#128101;<span class="org-kcats-brackets">]</span> &#8226;&#129668; &#8596;&#65039;<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]</span> &#129657;<span class="org-kcats-brackets">]</span>
                          &#128256; prepend<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prepend the pubkey</span>

 <span class="org-kcats-brackets">[</span>hash <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>hashbytes<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span>&#10004;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encode hash<span class="org-kcats-brackets">]]]</span>
                     decide<span class="org-kcats-brackets">]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org54657bb" class="outline-3">
<h3 id="org54657bb"><span class="section-number-3">1.16.</span> Time and date</h3>
<div class="outline-text-3" id="text-1-16">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/time.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>milliseconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition &#128307;<span class="org-kcats-brackets">]]]</span>

 <span class="org-kcats-brackets">[</span>seconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>1000 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>minutes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>seconds 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>hours <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>minutes 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>days <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>hours 24 *<span class="org-kcats-brackets">]]]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgdb161d8" class="outline-3">
<h3 id="orgdb161d8"><span class="section-number-3">1.17.</span> Nested Environments</h3>
<div class="outline-text-3" id="text-1-17">
<div class='tangle-wrapper' data-tangle='src/kcats/core/environment-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>environment <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> environment eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>environment? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment
                         eval-<span class="org-function-name">step</span> eval-<span class="org-function-name">step</span>
                         <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>evaluate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>14 1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>finished? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128307;<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#10004;&#65039;<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>using <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list modules<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized env<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>use <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program <span class="org-kcats-brackets">[</span>list modules<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>stage &#128256; <span class="org-comment-delimiter">;; </span><span class="org-comment">lm env</span>
                   <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128248;<span class="org-kcats-brackets">]</span> &#8226;&#128011; assign<span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">capture the stack at runtime</span>
                   using <span class="org-comment-delimiter">;; </span><span class="org-comment">set up the resolver </span>
                   evaluate <span class="org-comment-delimiter">;; </span><span class="org-comment">execute the program in the inner environment</span>
                   <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">replace the stack with the result from the inner env</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/environment.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>tos <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> &#129692;<span class="org-kcats-brackets">]]]</span>
                   tos<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>top <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> &#129692;<span class="org-kcats-brackets">]]]</span>
                   toe<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>stage <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> label environment<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>capture <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Capture the outer stack and assign it to the inner env's stack"</span><span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>&#128248;<span class="org-kcats-brackets">]</span> &#8226;&#128011;
                       assign<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>spawn <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&#128248;<span class="org-kcats-brackets">]</span> &#8226;&#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">p d s</span>
                     <span class="org-kcats-brackets">[</span>program dictionary stack<span class="org-kcats-brackets">]</span> label
                     environment<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 dictionary <span class="org-kcats-brackets">[</span>&#128256; &#128101;<span class="org-kcats-brackets">]</span> spawn<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>&#128256; &#128101;<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]</span> environment<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>confine <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program module<span class="org-kcats-brackets">]</span> dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>spawn evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org11a36f9" class="outline-4">
<h4 id="org11a36f9"><span class="section-number-4">1.17.1.</span> Debugging</h4>
<div class="outline-text-4" id="text-1-17-1">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/debug.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>break <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>&#128256; something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">still running</span>
                        <span class="org-kcats-brackets">[</span>&#9654;&#65039; &#9775;&#65039;<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">check condition not true yet</span>
                       <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span>
                       every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
                      <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> &#129668;<span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                      &#9203;<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>breakpoint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; &#128307;<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[</span>definition &#128307;<span class="org-kcats-brackets">]]]</span>

 <span class="org-kcats-brackets">[</span>sprint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>program 0<span class="org-kcats-brackets">]</span> lookup &#127873; <span class="org-kcats-brackets">[</span>breakpoint<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> break
                       &#128465;&#65039; <span class="org-comment-delimiter">;; </span><span class="org-comment">the condition</span>
                       &#128307; <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">advance past the breakpoint word if the program isn't complete</span>


 <span class="org-kcats-brackets">[</span>advance <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128101; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]</span> lookup &#128207; &#128256; <span class="org-comment-delimiter">;; </span><span class="org-comment">count up the program length, we'll run until it's smaller than this</span>
                        <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup &#128207; <span class="org-comment-delimiter">;; </span><span class="org-comment">only stop if env's program empty or shorter than we started off</span>
                         <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&lt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>&#128737;&#65039; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175; &#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128737;&#65039; 
                        <span class="org-kcats-brackets">[</span>&#128465;&#65039; eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                        &#9203; &#9654;&#65039;
                        &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the program length item</span>

 <span class="org-kcats-brackets">[</span>stepper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span> &#128101;<span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>tracer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program generator<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>stage stepper<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>dump <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[</span>&#128307; &#128307;<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>&#128248; &#127873; emit autoformat print<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>heatmap <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>tracer
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">what item is being &#9654;&#65039;d</span>
                         <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">don't emit &#128307; or the execution stops, use 0 instead</span>
                          bail 0 or<span class="org-kcats-brackets">]</span>
                         each 
                         <span class="org-kcats-brackets">[</span>word?<span class="org-kcats-brackets">]</span> keep <span class="org-comment-delimiter">;; </span><span class="org-comment">count only words, which filters out the 0's from above</span>
                         frequencies<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039;<span class="org-kcats-brackets">]]]]]</span>


&#128279;
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/debug-step.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>evaluating? <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span>evaluate<span class="org-kcats-brackets">]</span> starts?<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>with-innermost <span class="org-kcats-brackets">[[</span>&#128307; &#128256;
                   <span class="org-kcats-brackets">[[</span>evaluating?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>stack 0<span class="org-kcats-brackets">]</span> &#128101; <span class="org-kcats-brackets">[</span>lookup<span class="org-kcats-brackets">]</span> &#129668; &#128256; <span class="org-kcats-brackets">[</span>&#128279;<span class="org-kcats-brackets">]</span> &#129668; <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">append the next part of the path to the accumulator</span>
                    &#9203; &#128256;<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#8226;&#8226;&#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">under the stepping prog</span>
                  <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; flip &#128465;&#65039;

                  <span class="org-comment-delimiter">;; </span><span class="org-comment">find which envs are finished and remove</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">'evaluate' from parent</span>
                  <span class="org-kcats-brackets">[</span>0 -2 slice &#128101;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>collect<span class="org-kcats-brackets">]</span> &#8226;&#8226;&#128737;&#65039; 
                  <span class="org-kcats-brackets">[[[[[</span>evaluating?<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span>stack 0<span class="org-kcats-brackets">]</span> lookup finished?<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[</span>&#9654;&#65039;<span class="org-kcats-brackets">]</span> &#128175;<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                    when<span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> &#8226;&#128737;&#65039; flip &#128465;&#65039; &#128465;&#65039;<span class="org-kcats-brackets">]</span>
                  &#129692;<span class="org-kcats-brackets">]]]</span>
&#128279;
</pre>
</div></div>
</div>
</div>
</div>
</div>
<div id="outline-container-org8fa632e" class="outline-2">
<h2 id="org8fa632e"><span class="section-number-2">2.</span> Issues</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org877cf0d" class="outline-3">
<h3 id="org877cf0d"><span class="section-number-3">2.1.</span> <span class="done DONE">DONE</span> Get rid of platform-specific definitions</h3>
</div>
<div id="outline-container-org062de0f" class="outline-3">
<h3 id="org062de0f"><span class="section-number-3">2.2.</span> <span class="done DONE">DONE</span> fix evaluate</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>1 1 +<span class="org-kcats-brackets">]]]</span> environment evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<pre class="example">

[[2]]
</pre>
</div>
</div>
<div id="outline-container-orgafae3f1" class="outline-3">
<h3 id="orgafae3f1"><span class="section-number-3">2.3.</span> <span class="todo TODO">TODO</span> merkle tree functions</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-function-name">join</span> hash <span class="org-string">"foobar"</span> hash =
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
First let's figure out how to represent a tree:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;</span><span class="org-comment">[5 [[3 [[1c &#128307;]</span>
<span class="org-comment-delimiter">;        </span><span class="org-comment">[2c &#128307;]]]</span>
<span class="org-comment-delimiter">;    </span><span class="org-comment">[4 [[3c &#128307;]]]]]</span>
<span class="org-kcats-brackets">[[</span>hash &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[</span>&#128307; pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>empty-node <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span> hash node<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> &#129668; get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> &#129668; &#128238; &#128238;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rawpath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256; prepend &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[</span>&#128307; node &#9875; <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> &#129668; addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [&#128307; [&#128228; &#128256; [child] &#129668; path] [drop] &#9878;&#65039;]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix rawpath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>parent <span class="org-kcats-brackets">[</span>butlast butlast<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]</span> &#128737;&#65039;
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#128737;&#65039; empty &#128256; <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> &#129692;
          hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">lopsidedtree n</span>
 <span class="org-kcats-brackets">[</span>balance &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree cur-ct</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span>&#128101; path <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>parent<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> &#8226;&#129668;  <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree path ct</span>
       &#8226;&#128256; <span class="org-comment-delimiter">;; </span><span class="org-comment">node path tree ct</span>
       &#128307;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">insert an unbalanced node (empty sibling)</span>
       <span class="org-kcats-brackets">[</span>empty-node siblings <span class="org-kcats-brackets">[</span>path parent<span class="org-kcats-brackets">]]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise replace the empty sibling</span>
       &#128307;
      <span class="org-kcats-brackets">]]]</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">["" drop</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[0 &#128307;] 1 node addchild 2 node 3 node addchild addchild</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[1 0]  1 [interpose] shield &#128256; &#128238; &#8226;&#128465;&#65039; lookup</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"foo"  hash node "bar"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;; update the root node</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">; now add a new sibling</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"baz"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">3 path [pop zero?] [butlast butlast] &#128307; &#9878;&#65039;</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;dump</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">["quux" hash node siblings rehash ] update</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span> <span class="org-string">"quux"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>node<span class="org-kcats-brackets">]</span> &#128668; &#128307;
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
1234
</p>
<ul class="org-ul">
<li>12
<ul class="org-ul">
<li>1</li>
<li>2</li>
</ul></li>
<li>34
<ul class="org-ul">
<li>3</li>
<li>4</li>
</ul></li>
</ul>

<ul class="org-ul">
<li>5</li>
<li>6</li>
</ul></li>
</ul>
<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-string">""</span> &#128307;<span class="org-kcats-brackets">]</span>
</pre>
</div>

<p>
interpose impl
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> interpose
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 foo 3 foo 4<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 &#128307;<span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>3 &#128307;<span class="org-kcats-brackets">]]]]]</span>
  <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]</span> 1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256; prepend 0 &#128238; &#8226;&#128465;&#65039; <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 &#128307;<span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>4 &#128307;<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div>

<p>
We need a function that, given a number n, gives the path in the
merkle tree. eg, 8 would be 1 1 1. Is it just <code>n-1</code> in binary?
6 would be 1 0 1. Ok so just write a function to expand binary digits:
</p>

<div class="org-src-container">
<pre class="src src-kcats">8 dec 2 radix
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128465;&#65039; &#128465;&#65039; <span class="org-string">"hi"</span> <span class="org-string">"there"</span><span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
              <span class="org-string">"there"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>hash &#128307;<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[</span>&#128307; pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> &#129668; get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> &#129668; &#128238; &#128238;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[</span>&#128307; node &#9875; <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> &#129668; addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [&#128307; [&#128228; &#128256; [child] &#129668; path] [&#128465;&#65039;] &#9878;&#65039;]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix nodepath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]</span> &#128737;&#65039; <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#128737;&#65039; empty &#128256; <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> &#129692; hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>

 <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
 assign<span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]]]]</span>
<span class="org-function-name">reverse</span> <span class="org-function-name">unwrap</span> assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> &#128307;<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> &#128307;<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> &#128307;<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> &#128307;<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">
<span class="org-kcats-brackets">[</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[</span>&#128307; pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> &#129668; &#128238; &#128238;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[</span>&#128307; node &#9875; <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> &#129668; addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>nodepath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> &#128737;&#65039; &#128256; prepend &#8226;&#128465;&#65039;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>padded <span class="org-kcats-brackets">[[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011; -<span class="org-kcats-brackets">]</span> &#129668;
          &#128256; repetition
          &#128256; <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[[</span>dec 2 radix<span class="org-kcats-brackets">]</span> &#129668; 2 log ceiling 0 padded nodepath<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">item-ct index</span>
 <span class="org-kcats-brackets">[</span>depth &#128307;<span class="org-kcats-brackets">]</span>

 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]</span> &#128737;&#65039;
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> &#128737;&#65039; empty &#128256;
          <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> &#129692;
          hash
          <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> &#128256; update<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>2 2 partition
           <span class="org-kcats-brackets">[[</span>&#128207; 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128307; &#128238;<span class="org-kcats-brackets">]</span> when
            <span class="org-function-name">unwrap</span> siblings<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span>
          assemble <span class="org-kcats-brackets">[</span>rehash<span class="org-kcats-brackets">]</span> &#128668;<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>merkle <span class="org-kcats-brackets">[[</span>hash node<span class="org-kcats-brackets">]</span> &#128668;
          <span class="org-kcats-brackets">[</span>&#128207; 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> &#9203;<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span> <span class="org-string">"e"</span><span class="org-kcats-brackets">]</span>
 &#128207;
 5 <span class="org-comment-delimiter">;; </span><span class="org-comment">2nd item</span>
 &#128256; path <span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1 0 1 0<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"FO3l6Ol62TcjJ3KPUJm5VgSjlZPKw704o0OtdiBSE+c="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"5aAf7hTg7VxIcU8iGA8lrYNltT+XefedxKPX6Tlj+Uo="</span>
                                                        <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"ypeBEsobvcr6wjGzmiPcTaeG7/gUfE5yuYB3ha/uSLs="</span> &#128307;<span class="org-kcats-brackets">]</span>
                                                         <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"PiPoFgA5WUoziU9lZOGxNIu9egCI1CxKy3PurtWcAJ0="</span> &#128307;<span class="org-kcats-brackets">]]]</span>
                                                       <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"v/4LNNuha8b6wXwIusVdZ2ze1aSt5B/iyZJKXd6PPls="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Ln0sA6lQeuJl7PW1NWiFpTOTogKdJBOUmXJloaJa78Y="</span>
                                                                                                              &#128307;<span class="org-kcats-brackets">]</span>
                                                                                                             <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"GKw+c0PwFokMUQ6T+TUmEWnZ4/VlQ2Qpgw+vCTT0+OQ="</span> &#128307;<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span> 5 0 <span class="org-kcats-brackets">[[[</span>&#128207;<span class="org-kcats-brackets">]</span> &#128737;&#65039;<span class="org-kcats-brackets">]</span> &#128011; -<span class="org-kcats-brackets">]</span> &#129668;
        &#128256; repetition
        &#128256; <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 0 1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf14ba23" class="outline-3">
<h3 id="orgf14ba23"><span class="section-number-3">2.4.</span> <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Goal: implement drop and drop-while with the same logic
</p>

<p>
Canceled - the commonality between drop and drop-while are too small to be worth trying to factor out.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span>
3
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[</span>generate &#128465;&#65039;<span class="org-kcats-brackets">]</span> &#129668; dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span>
  <span class="org-kcats-brackets">[</span>generate &#128256;<span class="org-kcats-brackets">]</span> &#129668; &#128735;<span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>generate &#128465;&#65039;<span class="org-kcats-brackets">]</span>
               &#129668; dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[</span>generate &#128256;<span class="org-kcats-brackets">]</span>
  &#129668; &#128735;<span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
0 <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> &#128307;
</pre>
</div>


<p>
This is what drop-while looks like
</p>
<div class="org-src-container">
<pre class="src src-kcats">&#128307; <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span>
&#128307; <span class="org-comment-delimiter">;; </span><span class="org-comment">the state (whether threshold reached)</span>
<span class="org-kcats-brackets">[</span>&#128307; <span class="org-comment-delimiter">;; </span><span class="org-comment">condition - whether we've finished dropping or not </span>
 <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">true - pass everything else through</span>
 <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prime init</span>
  <span class="org-kcats-brackets">[[[</span>&#128101;<span class="org-kcats-brackets">]</span> &#8226;&#128011; <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bring pred up and exec it</span>
  <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if pred passes drop the value</span>
  prime <span class="org-comment-delimiter">;; </span><span class="org-comment">after this should have value on top</span>
  <span class="org-kcats-brackets">[</span>&#128465;&#65039; <span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> &#129668; <span class="org-comment-delimiter">;; </span><span class="org-comment">set flag</span>
 <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">false - generate, check pred, repeat</span>
 &#9878;&#65039;<span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">&#128307; <span class="org-kcats-brackets">[</span>&#128307; <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> &#8226;&#128011;<span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[[[</span>&#128101;<span class="org-kcats-brackets">]</span> &#8226;&#128011; <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span>&#128465;&#65039;<span class="org-kcats-brackets">]</span> prime <span class="org-kcats-brackets">[</span>&#128465;&#65039; yes<span class="org-kcats-brackets">]</span>
     &#129668;<span class="org-kcats-brackets">]</span>
    &#9878;&#65039;<span class="org-kcats-brackets">]</span>
yes <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&#128228;<span class="org-kcats-brackets">]</span> &#128307;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Skyrod Vactai</p>
<p class="date">Created: 2025-01-25 Sat 19:42</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
