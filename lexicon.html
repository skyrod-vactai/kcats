<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-10-10 Thu 15:52 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The kcats Programming Language Lexicon</title>
<meta name="author" content="Skyrod Vactai" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<style> pre.src { background: black; color: white; } #content { max-width: 1000px } </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="doc-custom.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">The kcats Programming Language Lexicon</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga617384">1. Standard library source and documentation</a>
<ul>
<li><a href="#org666911b">1.1. Comparison</a></li>
<li><a href="#orgfc3da18">1.2. Stack Ops</a>
<ul>
<li><a href="#org960089c">1.2.1. Motion</a></li>
</ul>
</li>
<li><a href="#org2016852">1.3. Program execution</a></li>
<li><a href="#orgb213e11">1.4. Collections</a>
<ul>
<li><a href="#orgb5822fe">1.4.1. Associations</a></li>
<li><a href="#orgafc2456">1.4.2. Sets</a></li>
<li><a href="#org550dd82">1.4.3. Generators</a></li>
</ul>
</li>
<li><a href="#orgf5a0269">1.5. Dictionary modules</a></li>
<li><a href="#org4495514">1.6. Math</a></li>
<li><a href="#orga1ad13e">1.7. Serialization</a></li>
<li><a href="#org908dee5">1.8. Boolean logic</a></li>
<li><a href="#org36fa4fe">1.9. Byte encoding and decoding</a></li>
<li><a href="#org03a2d32">1.10. Strings</a></li>
<li><a href="#org289a3ef">1.11. Error handling</a></li>
<li><a href="#orgf95f04f">1.12. Methods</a></li>
<li><a href="#org5c11fb0">1.13. Pipes</a></li>
<li><a href="#orgaf150de">1.14. Crypto</a></li>
<li><a href="#orgbb8a371">1.15. Time and date</a></li>
<li><a href="#org4ed1352">1.16. Nested Environments</a>
<ul>
<li><a href="#org6c1655d">1.16.1. Debugging</a>
<ul>
<li><a href="#orge15863a">1.16.1.1. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd061511">1.17. <span class="todo TODO">TODO</span> Functional environment</a></li>
</ul>
</li>
<li><a href="#orgbe193e1">2. Issues</a>
<ul>
<li><a href="#org460d4ae">2.1. <span class="done DONE">DONE</span> Get rid of platform-specific definitions</a></li>
<li><a href="#orgd867e7a">2.2. <span class="done DONE">DONE</span> fix evaluate</a></li>
<li><a href="#orga9e6e8c">2.3. <span class="todo TODO">TODO</span> merkle tree functions</a></li>
<li><a href="#org5b439fa">2.4. <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga617384" class="outline-2">
<h2 id="orga617384"><span class="section-number-2">1.</span> Standard library source and documentation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org666911b" class="outline-3">
<h3 id="org666911b"><span class="section-number-3">1.1.</span> Comparison</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Words that help compare one item to another, with concepts of <code>equal</code>, <code>greater</code>, <code>less</code> etc.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Different Numbers are not equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same numbers are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 1.0 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same value integer and float are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Number and Nothing are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[[]]]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[[]]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same nested list with numbers are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same nested list with string are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same strings are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"there"</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Different strings are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>\h \h =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same characters are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>\h \i =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Different characters are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"hi"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Same bytes are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> encode <span class="org-string">"there"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Different bytes are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[]</span> yes =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Different booleans unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>1.0 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]</span> =<span class="org-kcats-brackets">]</span>  <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Nested lists with different strings are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"'Nothing' is equal to itself"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"List/Association empty container types are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"List/Set empty container types are equal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Nonempty List/Association types are unequal"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]</span> set =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Sets constructed from different lists are equal"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>compare <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"string lexicographical order with single character inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"a"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"string lexicographical order with single character equality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Same integer compares equal"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>2 1 compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>greater<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Integer order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/list order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/byte order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> <span class="org-string">"foo"</span> encode compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Word/string order inequality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"foo"</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>less<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"String order equaltiy"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-function-name">unwrap</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrapped Nothing value equality"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span> compare<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>equal<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Nothing/emptied container equality"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO these should be in terms of compare and not limited to numbers</span>
<span class="org-kcats-brackets">[</span>&lt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Float is not less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is less"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Equal floats is not less"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt; <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Float is not greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is greater"</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Equal floats is not greater"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&lt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Float is not less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1 2.2 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is less/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is less/equal"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>&gt;= <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer is greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 2.2 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Float is not greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>2.2 1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Integer/float is greater/equal"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>1.1 1.1 &gt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Equal floats is greater/equal"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/compare.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>min <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&lt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two negative integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 min<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]</span> <span class="org-string">"Smaller of two floats &lt;1"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>max <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>&gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>-5 -3 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two positive integers"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>0.3 0.2 max<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.3<span class="org-kcats-brackets">]</span> <span class="org-string">"Larger of two floats &lt;1"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgfc3da18" class="outline-3">
<h3 id="orgfc3da18"><span class="section-number-3">1.2.</span> Stack Ops</h3>
<div class="outline-text-3" id="text-1-2">
<div class='tangle-wrapper' data-tangle='src/kcats/core/stack-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop integer on ToS"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 2 3 <span class="org-kcats-brackets">[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop list on ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone integer on ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list *<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-builtin">evert</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 5 4 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Evert a list of integers with the stack"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/stack.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>clonedown <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 clonedown<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone the 2nd item on the stack"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>clonedeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>clonedown<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 clonedeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-string">"Clone the 3rd item on the stack"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>over <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>clonedown <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 over<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Copy the 2nd item to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>under <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-builtin">sink</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 under<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Copy the ToS to the 2nd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop the 2nd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>dropdeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 dropdeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Drop the 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Save the whole stack as a list on the stack"</span><span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">evert</span> <span class="org-builtin">clone</span> <span class="org-builtin">evert</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Copy the stack to ToS"</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Copy stack to ToS when stack is empty"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>restore <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-string">"y"</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> restore<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Replace stack with list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[]</span> restore<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-string">"Replace stack with empty list"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org960089c" class="outline-4">
<h4 id="org960089c"><span class="section-number-4">1.2.1.</span> Motion</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
These words change the order of items on the stack.
</p>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap top two items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 1 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap 2nd and 3rd items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Move 3rd item to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-builtin">sink</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Move ToS to 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/motion.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>flip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>item c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 flip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Swap ToS and 3rd item"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-org2016852" class="outline-3">
<h3 id="org2016852"><span class="section-number-3">1.3.</span> Program execution</h3>
<div class="outline-text-3" id="text-1-3">
<div class='tangle-wrapper' data-tangle='src/kcats/core/execute-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[]</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute an empty program"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Nested execution"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">branch</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>item condition<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 yes <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]</span> <span class="org-string">"Branch on true condition"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>6 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Branch on false condition"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">recur</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program rec2<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program rec1<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3
                     <span class="org-kcats-brackets">[</span>1 &lt;=<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> *<span class="org-kcats-brackets">]</span>
                     <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]</span>
                   <span class="org-string">"Recur with reduction"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">loop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item flag<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 yes <span class="org-kcats-brackets">[</span>-2 * <span class="org-builtin">clone</span> 50 &lt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>160<span class="org-kcats-brackets">]</span> <span class="org-string">"Looping"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>10 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>-2 * <span class="org-builtin">clone</span> 50 &lt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Looping with false initial condition is no-op"</span><span class="org-kcats-brackets">]]]]]</span>


<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 8 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 8<span class="org-kcats-brackets">]</span> <span class="org-string">"Dipping a program under ToS"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>1 2 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>
                   <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"A bare word on stack is left intact and not executed"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: This depends on `if` so might need to move elsewhere, maybe Methods?</span>
<span class="org-kcats-brackets">[</span>decide <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list test-expr-pairs<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Takes a list of choices (pairs of test, program) and</span>
<span class="org-string">                executes the first program whose test passes. if none</span>
<span class="org-string">                pass, returns 'nothing'. Stack is reset between</span>
<span class="org-string">                testing conditions."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>5 <span class="org-string">"five"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Decide with matching condition"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"something else"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[</span>9 <span class="org-string">"something else"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Decide with matching default condition"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>9 <span class="org-kcats-brackets">[[[</span>3 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"three"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"five"</span><span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>7 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"seven"</span><span class="org-kcats-brackets">]]]</span>
                      decide<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>9 <span class="org-kcats-brackets">[]]</span> <span class="org-string">"Decide with no matching condition"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/execute.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>decorate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>foo bar<span class="org-kcats-brackets">]</span> decorate<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>1 inc<span class="org-kcats-brackets">]</span> foo<span class="org-kcats-brackets">]</span> bar<span class="org-kcats-brackets">]]</span>
                       <span class="org-string">"Decorate a program with a series of modifiers"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>decorated <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>decorate <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bail <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a decorated program"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: implement as axiom (which would depend on 'restore' which should also be axiom?)</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Runs program keeping top of stack produced but protects existing items from being consumed."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-preprocessor">inject</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[]]</span> <span class="org-string">"Execute a program shielding the stack from consumption"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>=<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 <span class="org-kcats-brackets">[]]</span> <span class="org-string">"Execute a program consuming only the original ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddeep</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program p<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item consumed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item consumed<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>item result<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>+ +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 6<span class="org-kcats-brackets">]</span> <span class="org-string">"Execute a program consuming only the original top 2 items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">if</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program no-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
             <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>15<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with true predicate"</span><span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>6 <span class="org-kcats-brackets">[</span>5 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with false predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>when <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program yes-<span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
               <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]]</span>
              <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with no false branch and true predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>3 <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Conditional with no false branch and false predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: drop dependency on 'decorated'</span>
<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
                  <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">dip</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program under top two items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>dipdeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program
                  <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> dipdeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program under top 3 items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 9<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip program and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 11<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip under top 2 items and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>divedeep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[</span>item <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item c<span class="org-kcats-brackets">]</span> *<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 5 6 7 8 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> divedeep<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6 7 8 9<span class="org-kcats-brackets">]</span> <span class="org-string">"Dip under top 3 items and move result to ToS"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">inject</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program list<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"Inject the quoted program into the list below</span>
<span class="org-string">                     it (runs the program with the list as its</span>
<span class="org-string">                     stack).  Does not affect the rest of the stack."</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">evert</span> <span class="org-function-name">take</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">evert</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>* +<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[</span>26<span class="org-kcats-brackets">]]</span> <span class="org-string">"Inject program into list as if it's the stack"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">add shield to the pred program</span>
                     <span class="org-builtin">clone</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run it on the previous ToS</span>
                     <span class="org-function-name">join</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>3 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1 0<span class="org-kcats-brackets">]</span> <span class="org-string">"While loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">until</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pred body</span>
                     <span class="org-kcats-brackets">[</span>not<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">reverse logic</span>
                     <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorate <span class="org-comment-delimiter">;; </span><span class="org-comment">add shield to the pred program -&gt; pred body</span>
                     <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">[body ..  pred]</span>
                     yes <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run at least once</span>
                     <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">until</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Until loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-preprocessor">times</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program body<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span>
                     <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">build [dec body dip]</span>
                     <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                     <span class="org-preprocessor">while</span>
                     <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>5<span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 5 5<span class="org-kcats-brackets">]</span> <span class="org-string">"Can create an item multiple times"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>5<span class="org-kcats-brackets">]</span> 0 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-string">"0 times is a no-op"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>1 1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> 3 <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Can run a program multiple times"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>primrec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program rec1<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>program exit<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>number repetitions<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add execute to rec1 to be recurs rec2</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add drop to exit condition</span>
                       <span class="org-kcats-brackets">[[</span>zero?<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dipdown</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">put the condition on bottom</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add the r1</span>
                       <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">now its generic recur</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>5 <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> primrec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]</span> <span class="org-string">"Simple countup loop"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>bail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Can bail on invalid input"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Valid input doesn't bail"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgb213e11" class="outline-3">
<h3 id="orgb213e11"><span class="section-number-3">1.4.</span> Collections</h3>
<div class="outline-text-3" id="text-1-4">
<div class='tangle-wrapper' data-tangle='src/kcats/core/collections-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Join two collections of strings"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> <span class="org-string">"cd"</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two strings"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"ab"</span> encode <span class="org-string">"cd"</span> encode <span class="org-function-name">join</span> <span class="org-string">"abcd"</span> encode =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Two joined byte seqs are equal to the combined literal"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-kcats-brackets">[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a g<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Joining list+assoc -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a g<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association  <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Joining assoc+list -&gt; assoc, 2nd arg keys take priority"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b c d<span class="org-kcats-brackets">]</span> set <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join list with set -&gt; set"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">""</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join two empty strings -&gt; empty string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join empty string + list -&gt; list (identity)"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-kcats-brackets">[</span>\b \c<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with a list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>\b \c<span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bca"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a list of chars with string -&gt; string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[</span>\b \c<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bc"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join an empty string with list of chars -&gt; string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> <span class="org-kcats-brackets">[</span>\d \e 12<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>\a \b \c \d \e 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Join a string with list -&gt; list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> <span class="org-kcats-brackets">[]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join a string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Join empty string with empty list -&gt; string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>4 4 4<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Join set with list -&gt; set"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item receptacle<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>receptacle<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> 1 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into empty list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Put integer into list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> \d <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"food"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put character into string"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode 32 <span class="org-function-name">put</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo "</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Put byte into byte array"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"cd"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Count list of strings"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count chars in string"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> encode <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Count bytes in byte array"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Count entries in association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-string">"Get second item of list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get second item of string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Get second item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">last</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>3 4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]</span> <span class="org-string">"Get last item of list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">last</span> <span class="org-kcats-brackets">[</span>\o<span class="org-kcats-brackets">]]</span> <span class="org-string">"Get last item of string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">last</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Get last item of empty list -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]</span> <span class="org-string">"Step through numbers doing arithmetic"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"Stepping through empty list is no-op"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item dispenser<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take a string from a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Take a number from a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[[</span>a <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take an entry from association is nondeterministic"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 3 5 7 9<span class="org-kcats-brackets">]</span> set <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span> odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Take item from set is nondeterministic"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item ordered<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Pop last string from list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Pop last number from list"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Wrap a number"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Wrap a list"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of one item"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-string">"Unwrap an empty list is a no-op"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Unwrap a list of multiple items"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span><span class="org-function-name">reverse</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 2 1<span class="org-kcats-brackets">]]</span> <span class="org-string">"Reverse a list"</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> <span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"321"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Reverse a string"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>slice <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foobar"</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a string with valid indices"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 0 7 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Slice a string with index past end -&gt; Nothing"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span> <span class="org-string">"Slice a byte array with valid indices"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>a b c d e<span class="org-kcats-brackets">]</span> 0 3 slice<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c<span class="org-kcats-brackets">]]</span> <span class="org-string">"Slice a list with valid indices"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>cut <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> slice<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>0 <span class="org-builtin">swap</span> slice<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
                    <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcdefghijklmnopqrstuvwxyz"</span> 5 cut<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"fghijklmnopqrstuvwxyz"</span> <span class="org-string">"abcde"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Cut string at index"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>empty <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from string"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from byte array"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Create empty container from list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from association"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Create empty container from set"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>range <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 5 1 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step of 1"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>3 13 3 range<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 6 9 12<span class="org-kcats-brackets">]]</span> <span class="org-string">"Create integer range with step greater than 1"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>empty? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[]</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is empty"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Number is not empty"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty string is empty"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Non-empty list is not empty"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>pad <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item padding<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer newsize<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                    <span class="org-builtin">swap</span> repeat
                    <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 5 0 pad<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 0 1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pad a list at front, to given size"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 6<span class="org-kcats-brackets">]</span> 5 0 pad<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3 4 5 6<span class="org-kcats-brackets">]]</span> <span class="org-string">"Padding a list to smaller than original size is a no-op"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>list? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A list is a list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[]</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty list is a list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>5 list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A number is not a list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A string is not a list"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[]</span> association list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"An empty association is not a list"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>sort-indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2<span class="org-kcats-brackets">]]</span> sort-indexed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Sorting a list of key-value pairs by key"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>pack <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list template<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>
                         <span class="org-kcats-brackets">[</span>*2 <span class="org-kcats-brackets">[</span>*1 x **2<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]</span> pack<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span><span class="org-string">"x"</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bar x foo<span class="org-kcats-brackets">]</span> c d 1 2 3<span class="org-kcats-brackets">]]</span>
                       <span class="org-string">"Packing values from the stack, into a template"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/collections.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>something? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span> 
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>empty? not<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A number is something"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[]</span> something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Empty list is not something"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Empty string is not something"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Get the first item of a list"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\f<span class="org-kcats-brackets">]</span> <span class="org-string">"The first item of a string is the first character"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[]</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"The first item of an empty list is Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Take rest of list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"oo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Take rest of string"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>butlast <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> butlast<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Take all but last of list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>prepend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item sized<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2<span class="org-kcats-brackets">]</span> 3 prepend<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>3 1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Prepend to list"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"oo"</span> \f prepend<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Prepend to string"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>every? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                       <span class="org-kcats-brackets">[]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> every?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> yes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Every number matches predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Not every number matches predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[[]]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Every item in empty list matches any predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Every item in list matches empty predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Stack is shielded from predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>12 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12 yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Can check list of predicates with execute predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>any? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> boolean<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                     <span class="org-kcats-brackets">[]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> any?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Any number matches predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>3 5 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>even?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"No number matches predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"No item in empty list matches any predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[]</span> 2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Empty predicate returns first truthy item"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>11 <span class="org-kcats-brackets">[</span>3 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ odd?<span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11 yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Stack is shielded from predicate"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>-15 <span class="org-kcats-brackets">[[</span>even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 mod 0 =<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-15 yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Can check list of predicates with execute predicate"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">map</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put empty results below list</span>
                   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>*1 <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> pack
                   <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>

      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pass each item through a program"</span><span class="org-kcats-brackets">]</span>

                 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]]</span> <span class="org-string">"Program has access to rest of stack"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+ *<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>70 77 84<span class="org-kcats-brackets">]]</span> <span class="org-string">"Stack is shielded from mapping program"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>7 7 7<span class="org-kcats-brackets">]]</span> <span class="org-string">"Result of program can be lower stack items"</span><span class="org-kcats-brackets">]</span>

                 <span class="org-kcats-brackets">[[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 9 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]]</span> <span class="org-string">"Empty program is a no-op"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span><span class="org-function-name">filter</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put empty results below list</span>
                      <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>*1 <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span>
                       <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span>
                       <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                      pack
                      <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Filter a list with predicate"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>2 4 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Filter with predicate that matches no items"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>33 <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 + odd?<span class="org-kcats-brackets">]</span> <span class="org-function-name">filter</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>33 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Filter predicate uses existing stack items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>sort <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> **1 pair<span class="org-kcats-brackets">]</span> pack
                    <span class="org-function-name">map</span> sort-indexed<span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 3 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort a list of numbers"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Carol"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Alice"</span> <span class="org-string">"Bob"</span> <span class="org-string">"Carol"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort a list of strings"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"Charlie"</span> <span class="org-string">"Alice"</span> <span class="org-string">"bob"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> sort<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"Bob"</span> <span class="org-string">"Alice"</span> <span class="org-string">"Charlie"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Sort list of strings by length"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>repeat <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>integer howmany<span class="org-kcats-brackets">]</span>
                 item<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-preprocessor">times</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> 3 repeat<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span> <span class="org-string">"hi"</span> <span class="org-string">"hi"</span><span class="org-kcats-brackets">]]</span> <span class="org-string">"Create a list of repeated items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexed <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 1 range <span class="org-builtin">swap</span> zip<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> indexed<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Index a list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>indexer<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>0 a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 c<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Index a generator"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>indexof <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>indexer<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">use wrap so we can find index of words,</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise the word gets executed</span>
                       <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-function-name">wrap</span> =<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> <span class="org-function-name">wrap</span> <span class="org-function-name">put</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">swapdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span>
                       keep generate <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> indexof<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Get the index of first matching item"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> indexof<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"No matching item -&gt; Nothing"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[[</span>a b c d c e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> indexof<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> <span class="org-string">"Multiple matches returns index of first match"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>interpose <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> flip
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> pair <span class="org-function-name">join</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
                         <span class="org-builtin">drop</span> <span class="org-function-name">pop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo bar baz<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo <span class="org-string">"hi"</span> bar <span class="org-string">"hi"</span> baz<span class="org-kcats-brackets">]]</span> <span class="org-string">"Interpose string between words"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Empty list is a no-op"</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-string">"hi"</span> interpose<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]]</span> <span class="org-string">"Single item list is a no-op"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>starts? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>ordered prefix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>ordered target<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>zip <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the items at matching indexes are equal</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> both &gt;=<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the prefix is shorter than the target</span>
                       <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every? 
                       <span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the originals</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"ab"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"String starts with matching string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"String starts with empty string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> <span class="org-string">"ab"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Empty string doesn't start with a string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"String doesn't start with non-matching string"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> starts?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"List starts with matching list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>ends? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>ordered ordered<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">reverse</span><span class="org-kcats-brackets">]</span> both starts?<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcd"</span> <span class="org-string">"cd"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"String ends with matching string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">""</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"String ends with empty string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abcd"</span> <span class="org-string">"bb"</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"String doesn't end with non-matching string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> ends?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"List ends with matching list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>pair <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2<span class="org-kcats-brackets">]]</span> <span class="org-string">"Pair up two numbers into a list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> pair<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]</span> <span class="org-string">"Pair up two lists into a new list"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>pair? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 2 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span> recover<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"ab"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"2-character string is a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"2-item list is a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"abc"</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"3-character string is not a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[]</span> pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Nothing is not a pair"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>7 pair?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Number is not a pair"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>triplet <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Make a 3-item list from 3 stack items"</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]</span> triplet<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"there"</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span><span class="org-kcats-brackets">]]]</span> <span class="org-string">"Make a 3-item list from smaller lists"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>both? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">sink</span> pair <span class="org-builtin">swap</span> every?<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Test two items for predicate when not all match"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[</span>1 3 <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Test two items for predicate when all match"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>both <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>item a<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pair<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]</span> <span class="org-string">"Run program on two stack items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>walk <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program item-transform<span class="org-kcats-brackets">]</span> list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>list? not<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                    <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-function-name">step</span> <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span>
                    <span class="org-preprocessor">recur</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>inc <span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> walk<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3 <span class="org-kcats-brackets">[</span>4 <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> 7<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Walk a nested list"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> inc pair<span class="org-kcats-brackets">]</span> walk<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 2 3 <span class="org-kcats-brackets">[</span>3 4 <span class="org-kcats-brackets">[</span>4 5 5 6<span class="org-kcats-brackets">]</span> 6 7<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Walk a nested list and splice results"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">; </span><span class="org-comment">[template [[spec [[[list template]] [list]]]</span>
<span class="org-comment-delimiter">;            </span><span class="org-comment">[definition [[snapshot</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">;; build a map of word like *1, *2 etc to values on the stack</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">;; Do a separate entry for **1, **2, etc which means to splice the value</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">[count] shield inc 1 1 swapdown range</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">["*" "**"] [swap [string join word] map] map</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">unwrap join dropdown </span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">[clone [wrap] map swap join] dip swap zip association] dive</span>

<span class="org-comment-delimiter">;                         </span><span class="org-comment">;; save copy of template</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">[clone] dive</span>

<span class="org-comment-delimiter">;                         </span><span class="org-comment">[[swap get] swap prepend wrap</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">[shield </span>
<span class="org-comment-delimiter">;                           </span><span class="org-comment">[] [dropdown] [drop wrap] if] join</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">walk] dip</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">;; find the highest index placeholder</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">flatten set 0 swap </span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">[[word?]</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">;; try to parse as a placeholder and get the index</span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">[string ["*" starts?] [take drop] while</span>
<span class="org-comment-delimiter">;                           </span><span class="org-comment">[number max] [drop drop] recover] </span>
<span class="org-comment-delimiter">;                          </span><span class="org-comment">[drop] if] step</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">;; drop that many items from the stack</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">[drop] swap float [times] dip]]</span>
<span class="org-comment-delimiter">;            </span><span class="org-comment">[examples [[["x" [foo] [bar] unwrap</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">[*2 [*1 x **2] c d 1 2 3] template]</span>
<span class="org-comment-delimiter">;                        </span><span class="org-comment">["x" [[foo] [bar x foo] c d 1 2 3] ]]]]]]</span>

<span class="org-kcats-brackets">[</span>flatten <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>list? not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">recur</span><span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]</span> f<span class="org-kcats-brackets">]</span> g<span class="org-kcats-brackets">]</span> flatten<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b c d e f g<span class="org-kcats-brackets">]]</span> <span class="org-string">"Flatten a nested list"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-orgb5822fe" class="outline-4">
<h4 id="orgb5822fe"><span class="section-number-4">1.4.1.</span> Associations</h4>
<div class="outline-text-4" id="text-1-4-1">
<div class='tangle-wrapper' data-tangle='src/kcats/core/associations-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>get <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]</span> <span class="org-string">"Get a key from an association"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>10 11 12 13<span class="org-kcats-brackets">]</span> 1 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]</span> <span class="org-string">"Get an item by index from a list"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>\b<span class="org-kcats-brackets">]</span> <span class="org-string">"Get a character by index from a string"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> encode 3 get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>98<span class="org-kcats-brackets">]</span> <span class="org-string">"Get an integer by index from a byte array"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[[</span>a 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> get<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Get a nonexistent key -&gt; Nothing"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>assign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item value<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span>
                 sized<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new value to an existing key"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>e 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new value to a new key"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[]]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d 5<span class="org-kcats-brackets">]]</span> association assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a new nested key, promoting to nested association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>1 1 0<span class="org-kcats-brackets">]</span> 5 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]</span> <span class="org-string">"Assign a new index in a nested list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 0<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Assign a new index in a nested list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>a 0<span class="org-kcats-brackets">]</span> 10 assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>10 2 3<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Assign a nested key in a mixed structure of association and list"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-string">"foo"</span> assign<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]</span> <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]</span> <span class="org-string">"Assign an index creating placeholders for missing list items"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>unassign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item key<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign a key from an association, promoting from list"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign a key that doesn't exist, only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e f<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign multiple keys that don't exist only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>f g<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>c x<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span>a b<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>f g<span class="org-kcats-brackets">]]</span> association assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign multiple keys where last doesn't exist, only promotes"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d e<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>a d<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[]</span> association <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> assign<span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign associative keylist from nested structure, promoted to association"</span><span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[</span>0 1 2 <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>3 c<span class="org-kcats-brackets">]</span> unassign<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>0 1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]]</span> association <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Unassign mixed keylist from nested structure, inner only is promoted to association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>association? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"Association is an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A list is not an association, even if it's possible to promote"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>1 association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A number is not an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[[]</span> association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"An empty list is not an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[[]</span> association association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"An empty association is an association"</span><span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> 1 assign association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A list promoted to association by assignment, is an association"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>association <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A list can be promoted to association"</span><span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"An association and list are not the same, even if keys/vals are the same"</span><span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span>
                           <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"An association is not the same as the list it was promoted from"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/associations.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">Associative words</span>
<span class="org-kcats-brackets">[</span>update <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>list keys<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized into-association<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">m ks v p</span>
                      <span class="org-preprocessor">shielddown</span>
                      assign<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 3<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in an association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in a nested association"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[</span>1 3 5 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>1 3 6 7<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update a value in a mixed association/list structure"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span><span class="org-string">"hi"</span>
                      <span class="org-kcats-brackets">[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> 10 15<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-string">"hi"</span> 15<span class="org-kcats-brackets">]</span> <span class="org-string">"Update function can't destroy stack items"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span> <span class="org-string">"Update creates new key when it doesn't exist"</span><span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[[[</span>a <span class="org-kcats-brackets">[[</span>c 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>d 5<span class="org-kcats-brackets">]]]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6 +<span class="org-kcats-brackets">]</span> update
                      <span class="org-kcats-brackets">[</span>a e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[</span>11<span class="org-kcats-brackets">]</span> <span class="org-string">"Update function can ignore previous value"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>lookup <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list keys<span class="org-kcats-brackets">]</span> sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">keylist not empty</span>
                      <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>get<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">extract the first key and lookup</span>
                      <span class="org-preprocessor">while</span>
                      <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> association <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>b<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup the value of a key in an association"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>a<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>b<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup the value of a key, promoting a list to association"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"Looking up a key that doesn't exist returns Nothing"</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[[</span>outer <span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]]]]</span> <span class="org-kcats-brackets">[</span>outer c<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>d<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Lookup in a nested structure, with promotion"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: fix the case where you just want a value [[type foo]] - only</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">one item but you want the value, not key</span>
<span class="org-kcats-brackets">[</span>type <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>empty?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>error?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>set<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>association?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[[</span>type<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                                       <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span>
                                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>type<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                                         <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span>
                                         <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                                         <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                                        <span class="org-kcats-brackets">[[]]</span>
                                        <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
                                       <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
                                      <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> any?<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]</span>
                    decide <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An association with one key assumes it is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Integers are of type number"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>1.0 type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Floats are of type number"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[]</span> type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-keyword">nothing</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Empty list is of type nothing"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"A byte array is of type bytes"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"A string is of type string"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>set<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"A set is of type set"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[]</span> environment type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An environment is of type environment"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An association with a single type key, the value is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An association with a single type key, the value is its type"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>attr1 foo<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>attr2 <span class="org-string">"blah"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>association<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An association with multiple keys and no type key, is of type association"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> association type<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>url<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]</span> <span class="org-string">"An association with type/value keys, uses the type key for its type"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>value <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized into-association<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if it's a single item</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-function-name">second</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the value is the value of that first item</span>
                     <span class="org-kcats-brackets">[[</span>value<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise look up the key 'value'</span>
                     <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>foo 1<span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-string">"The value of a single-entry association is the value of the key-value pair"</span><span class="org-kcats-brackets">]</span>

                   <span class="org-kcats-brackets">[[[[</span>type url<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>value <span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]]</span> value<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">"http://foo.com"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"The value of an object is the value key"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>zip <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dispenser values<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dispenser keys<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">save accumulator below args</span>
                   <span class="org-kcats-brackets">[[</span>something?<span class="org-kcats-brackets">]</span> both?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">stop when either list is empty</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> both <span class="org-builtin">swapdown</span> pair <span class="org-comment-delimiter">;; </span><span class="org-comment">take from each list and pair them up</span>
                    <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put them into the accumulator</span>
                   <span class="org-preprocessor">while</span>
                   <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the empty containers</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>a b c<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> zip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Zip two lists together into a single list of pairs"</span><span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span> zip<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>a 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]]]</span> <span class="org-string">"Zip two lists of unequal size pads with Nothing values"</span><span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>label <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized labels<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">labels acc</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-builtin">float</span> assign<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"Alice"</span> 23 <span class="org-string">"123 Main St"</span> <span class="org-kcats-brackets">[</span>address age name<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[[</span>address <span class="org-string">"123 Main St"</span><span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>age 23<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>name <span class="org-string">"Alice"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]</span>
                    <span class="org-string">"Label values on the stack as an association"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<p>
Better zip implementation
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>a b c d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span> <span class="org-builtin">sink</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> both <span class="org-builtin">swapdown</span> pair <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>b 2<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>c 3<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>d <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>e <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"asd"</span> <span class="org-kcats-brackets">[</span>\a \b 1<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>\a \s \d \a \b 1<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>\b \c<span class="org-kcats-brackets">]</span> <span class="org-string">"a"</span>  <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-string">"bca"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgafc2456" class="outline-4">
<h4 id="orgafc2456"><span class="section-number-4">1.4.2.</span> Sets</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/sets-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">TODO add 'set' type for spec?</span>
<span class="org-kcats-brackets">[[</span>set <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Promote a list to a set"</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"hello"</span> set<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"helo"</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Promote a string to a set"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>set? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A set is a set"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> set?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A list is not a set"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>contains? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item container<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"List contains a number"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>1 2 3 3 5<span class="org-kcats-brackets">]</span> set 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A set contains a number"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> 4 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A list doesn't contain a number"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>5 3 contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A number is atomic and doesn't contain anything"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> \o contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A word is atomic and doesn't contain anything"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"food"</span> <span class="org-string">"foo"</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A string contains a sub-string"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>a b c d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-string">"A list doesn't contain a sub-list (due to ambiguity with what 'contains' means with lists)"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A list contains another list"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[[</span>a <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> d<span class="org-kcats-brackets">]</span> set <span class="org-kcats-brackets">[</span>b c<span class="org-kcats-brackets">]</span> contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A set contains a list"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"food"</span> \o contains?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]</span> <span class="org-string">"A string contains a character"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>intersection <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4<span class="org-kcats-brackets">]</span> intersection<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 3<span class="org-kcats-brackets">]</span> set<span class="org-kcats-brackets">]</span> <span class="org-string">"Intersection of two lists expressed as set"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org550dd82" class="outline-4">
<h4 id="org550dd82"><span class="section-number-4">1.4.3.</span> Generators</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/generators.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">infinite sequence (generators) functions</span>

<span class="org-kcats-brackets">[[</span>generate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program item<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> generate<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]</span> <span class="org-string">"Generate a value from state"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>liberate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>assemble <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program generators<span class="org-kcats-brackets">]</span> dispenser<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>*2 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> **1 collect<span class="org-kcats-brackets">]</span> pack <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span> keep <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2 4 6<span class="org-kcats-brackets">]]</span>
                        <span class="org-string">"Assemble a sequence from a dispenser and a stack of generators"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>prime <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program body<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program pred<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>program init<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-builtin">float</span> <span class="org-function-name">join</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> prime <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10<span class="org-kcats-brackets">]</span>
                     <span class="org-string">"Prime executes init before each time through the loop"</span><span class="org-kcats-brackets">]]]]]</span>


 <span class="org-kcats-brackets">[</span>into <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">n</span>
                     <span class="org-builtin">swap</span> <span class="org-builtin">clone</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">n n r</span>
                     <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r</span>
                      <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">r n</span>
                      <span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">n n r</span>
                     <span class="org-preprocessor">loop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>\a \b \c \d<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-string">""</span> into<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span><span class="org-string">"abcd"</span><span class="org-kcats-brackets">]</span> <span class="org-string">"Generate into an empty string"</span><span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[[[</span>0 10 1 range <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                      5 dropper
                      <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                      <span class="org-kcats-brackets">[]</span> into<span class="org-kcats-brackets">]</span>
                     <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>50 60 70 80 90<span class="org-kcats-brackets">]]</span> <span class="org-string">"Generate a sequence and put it into the given container"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>collect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> into<span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4<span class="org-kcats-brackets">]]]</span>
                      <span class="org-kcats-brackets">[[[</span>0 10 1 range <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                         5 dropper
                         <span class="org-kcats-brackets">[</span>10 *<span class="org-kcats-brackets">]</span> each
                         collect<span class="org-kcats-brackets">]</span>
                        <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>50 60 70 80 90<span class="org-kcats-brackets">]]</span> <span class="org-string">"Collect from a generator into an empty list"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>each <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span>
                     <span class="org-kcats-brackets">[</span>bail <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span> decorate
                     <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> *<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span>
                     assemble<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>1 4 9 16<span class="org-kcats-brackets">]]</span> <span class="org-string">"Generate a sequence transforming each value"</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>generate <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span>
                        <span class="org-kcats-brackets">[]</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span>
                         <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span>
                        <span class="org-preprocessor">while</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7 8 9<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span>
                       assemble<span class="org-kcats-brackets">]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 6 7 8 9<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>taker <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[</span>3 taker<span class="org-kcats-brackets">]</span>
                      assemble<span class="org-kcats-brackets">]</span>

                     <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>catcher <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                         <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail not<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-kcats-brackets">[]]</span>
                         when<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 -4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> catcher<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>1 2 3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>dropper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>positive?<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
                          <span class="org-preprocessor">while</span>
                          <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
                         bail<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>3 dropper<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>skipper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the state (whether threshold reached)</span>
                        <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">condition - whether we've finished dropping or not</span>
                         <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">true - pass everything else through</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">false - generate, check pred, repeat</span>
                         <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prime init</span>
                          <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bring pred up and exec it</span>
                          <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if pred passes drop the value</span>
                          prime <span class="org-comment-delimiter">;; </span><span class="org-comment">after this should have value on top</span>
                          <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                         <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 -3 4 5<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> skipper<span class="org-kcats-brackets">]</span>
                        assemble<span class="org-kcats-brackets">]</span>

                       <span class="org-kcats-brackets">[[</span>-3 4 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>keep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>**1 not<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> pack
                     <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                      <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pred 1</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> generate<span class="org-kcats-brackets">]</span>
                       <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
                      <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span> keep<span class="org-kcats-brackets">]</span>
                     assemble<span class="org-kcats-brackets">]</span>

                    <span class="org-kcats-brackets">[[</span>1 3 5<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>group <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program group-by<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>*1 <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">k v state</span>
                       <span class="org-function-name">wrap</span> <span class="org-builtin">swap</span>  <span class="org-comment-delimiter">;;  </span><span class="org-comment">v k state</span>
                       <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> update<span class="org-kcats-brackets">]</span> pack
                      <span class="org-kcats-brackets">[]</span> association <span class="org-comment-delimiter">;; </span><span class="org-comment">state f</span>
                      <span class="org-builtin">swap</span> cram<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>1 2 3 4<span class="org-kcats-brackets">]</span> liberate <span class="org-kcats-brackets">[</span>odd?<span class="org-kcats-brackets">]</span> group<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>yes <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>2 4<span class="org-kcats-brackets">]]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>split <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program sized sized<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>empty<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">divedown</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> decorated
                      <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span> ends? not<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> prime
                       <span class="org-builtin">drop</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> ends?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-builtin">swap</span> - <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> slice<span class="org-kcats-brackets">]</span>
                       when
                       <span class="org-kcats-brackets">[</span>empty<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"abcabc"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"b"</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"ca"</span> <span class="org-string">"c"</span><span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3 4 2 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]</span> split<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>combinations <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> -1 <span class="org-comment-delimiter">;; </span><span class="org-comment">l idx i</span>
                             <span class="org-kcats-brackets">[[[</span><span class="org-builtin">swap</span> <span class="org-function-name">count</span> =<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-function-name">take</span> 0 <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> when
                              <span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[</span>pair<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span><span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 2 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>combinations<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3<span class="org-kcats-brackets">]]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>frequencies <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> association
                            <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                            cram<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"Hello there!"</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> frequencies<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[[</span>\space 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\! 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\H 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\e 3<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\h 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\l 2<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\o 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\r 1<span class="org-kcats-brackets">]</span>
                             <span class="org-kcats-brackets">[</span>\t 1<span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>fold <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>**1 <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> pack
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">generate the first item under the loop body</span>
                     <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                     <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers 1 dropper 10 taker <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> fold<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>cram <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program reducing-function<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>item initial-value<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span>
                     <span class="org-kcats-brackets">[]</span>
                     <span class="org-builtin">float</span> prime <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>integers 1 dropper 10 taker 0 <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> cram<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>55<span class="org-kcats-brackets">]]]]]]</span>



 <span class="org-kcats-brackets">[</span>integers <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>-1 <span class="org-kcats-brackets">[</span>inc <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/more-generators.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;; </span><span class="org-comment">partition</span>
<span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the spec</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">construct the dynamic definition for partition</span>

<span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[[</span>taker collect
               <span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">drop the used-up taker generator</span>
              <span class="org-function-name">join</span> divedeep<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>shift <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span> &lt;=<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 0 slice<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[]</span>
 <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> shift<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> shift<span class="org-kcats-brackets">]</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> let 
<span class="org-comment-delimiter">;; </span><span class="org-comment">add an empty list for the partition state</span>
<span class="org-kcats-brackets">[[]]</span> <span class="org-builtin">swap</span> <span class="org-function-name">put</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the definition</span>

<span class="org-kcats-brackets">[[[[</span>1 2 3 4 5 6 7<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[[</span>1 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5 6<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>7<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">examples</span>

<span class="org-kcats-brackets">[</span>examples definition spec<span class="org-kcats-brackets">]</span> label <span class="org-kcats-brackets">[</span>partition<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> assign
<span class="org-kcats-brackets">[[</span>pairwise <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[]</span> <span class="org-builtin">evert</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">capture stack</span>
                          <span class="org-kcats-brackets">[</span>2 2 partition<span class="org-kcats-brackets">]</span> assemble<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">pair up stack items</span>
                         <span class="org-preprocessor">inject</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run the program on the pairs</span>
                         <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> assemble <span class="org-comment-delimiter">;; </span><span class="org-comment">unpair the items</span>
                         <span class="org-function-name">unwrap</span> <span class="org-kcats-brackets">[]</span> <span class="org-builtin">swap</span> <span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">restore as the stack</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 4 5 2 3<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[</span><span class="org-builtin">float</span><span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4 5 1<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span>1 2 3 4 5 <span class="org-kcats-brackets">[[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span><span class="org-kcats-brackets">]</span> both<span class="org-kcats-brackets">]</span> pairwise<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 5 9<span class="org-kcats-brackets">]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-orgf5a0269" class="outline-3">
<h3 id="orgf5a0269"><span class="section-number-3">1.5.</span> Dictionary modules</h3>
<div class="outline-text-3" id="text-1-5">
<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>dictionary <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>cache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>decache <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>hashbytes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode hashbytes<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                       <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode hashbytes
                         <span class="org-string">"fop"</span> encode hashbytes
                         =<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>resolve <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>dictmerge <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>dictionary module<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dictionary original<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/dictionary.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>updates <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized word-updates<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program single-update<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>0<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> update <span class="org-comment-delimiter">;; </span><span class="org-comment">wrap the word name to get a path to update</span>
                         <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> each
                        joiner generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>entry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program definition<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>association full-entry<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>definition<span class="org-kcats-brackets">]</span> label<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>words <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>dictionary <span class="org-kcats-brackets">[</span>words<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>module <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>item wrapped-module-alias-or-hash<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>doc <span class="org-string">"reads a cached module from disk and puts it on the stack as a program"</span><span class="org-kcats-brackets">]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>decache string read<span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[</span>
          <span class="org-kcats-brackets">[[</span><span class="org-string">"123"</span> encode <span class="org-kcats-brackets">[</span>crypto<span class="org-kcats-brackets">]</span> stdmod <span class="org-kcats-brackets">[</span>hash<span class="org-kcats-brackets">]</span> confine<span class="org-kcats-brackets">]</span>
           <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"_1vRbfFezlcTCUfQCjC1FKukWLoOAeBuvxNXUDbFKSk"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inscribe <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes raw-module<span class="org-kcats-brackets">]</span> dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>hashbytes<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">calculate module hash</span>
                         <span class="org-kcats-brackets">[</span>string read <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">install the module in the dictionary</span>
                        <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">fork </span>
                        <span class="org-builtin">dropdown</span> <span class="org-function-name">unwrap</span> <span class="org-builtin">swapdown</span> dictmerge<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>draft <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized definitions<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program dictionary-updater<span class="org-kcats-brackets">]]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>entry<span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">create full entries for each definition</span>
                     <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">add 'join' to join the entries with the existing dictionary</span>

<span class="org-kcats-brackets">[</span>let <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>sized entries<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>draft dictionary <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>emit encode hashbytes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
                    <span class="org-kcats-brackets">[[[</span>words<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                    <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>dictmerge<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                   <span class="org-builtin">float</span> <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
                   <span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[</span>modules<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update
                   <span class="org-kcats-brackets">[</span>dictionary program<span class="org-kcats-brackets">]</span> label environment
                   <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">grab a snapshot</span>
                         <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> assign <span class="org-comment-delimiter">;; </span><span class="org-comment">set the env's stack to that value</span>
                         environment <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO this shouldn't be needed - investigate why sometimes it is</span>
                         evaluate
                         <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">promote the result</span>
                   <span class="org-function-name">join</span> <span class="org-kcats-brackets">]]</span> 
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>times5 <span class="org-kcats-brackets">[</span>5 *<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>doubledec <span class="org-kcats-brackets">[</span>dec dec<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span>3 times5 doubledec<span class="org-kcats-brackets">]</span> let <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>13<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[[</span><span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
                   let <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> 5<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[[</span>foo <span class="org-kcats-brackets">[</span><span class="org-string">"outer"</span><span class="org-kcats-brackets">]]]</span>
                   <span class="org-kcats-brackets">[</span><span class="org-string">"inner"</span><span class="org-kcats-brackets">]</span> let
                   <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> label
                   <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> let <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"inner"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>words **1 definition<span class="org-kcats-brackets">]</span> pack dictionary <span class="org-builtin">swap</span> lookup<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 <span class="org-kcats-brackets">[</span>flip<span class="org-kcats-brackets">]</span> definition <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]</span> <span class="org-string">"Fetch the definition of a word and use it"</span><span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>plus2 <span class="org-kcats-brackets">[</span>2 +<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[</span>5 plus2<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>draft dictionary <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>emit encode hashbytes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
 <span class="org-kcats-brackets">[[[</span>entries<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
 <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>dictmerge<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span> <span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
<span class="org-builtin">float</span> <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span>
<span class="org-builtin">swapdown</span> <span class="org-kcats-brackets">[</span>modules<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update 
<span class="org-kcats-brackets">[</span>dictionary program<span class="org-kcats-brackets">]</span> label environment
<span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">grab a snapshot</span>
      <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> assign <span class="org-comment-delimiter">;; </span><span class="org-comment">set the env's stack to that value</span>
      evaluate
      <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">promote the result</span>
<span class="org-function-name">join</span> 
<span class="org-preprocessor">execute</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">[0 dictionary entries] lookup [first [plus2] unwrap =] filter inspect</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">7
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"foo"</span> <span class="org-string">"bar"</span>
<span class="org-kcats-brackets">[[</span>foop <span class="org-kcats-brackets">[</span>3 * plus2<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>plus2 <span class="org-kcats-brackets">[</span>2 +<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[</span>5 foop<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>draft dictionary <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>emit encode hashbytes<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
 <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>dictmerge<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">under the let program ;; prog dict hash</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">wrap the hash to make a list of 1 namespace</span>

<span class="org-kcats-brackets">[</span>program dictionary<span class="org-kcats-brackets">]</span> label environment <span class="org-builtin">swap</span> pair <span class="org-comment-delimiter">;; </span><span class="org-comment">creates closure</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">when the closure executes, capture the outer stack first</span>
<span class="org-kcats-brackets">[[[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> assign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> using evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span> <span class="org-preprocessor">execute</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">wrap  [[stack] [snapshot] divedown assign evaluate [stack] lookup restore] join ; execute</span>
</pre>
</div>


<div class="org-src-container results">
<pre class="src src-kcats">
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>a b c d e<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> 2 2 <span class="org-kcats-brackets">[]</span>


<span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[[</span>taker collect
               <span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">drop the used-up taker generator</span>
              <span class="org-function-name">join</span> divedeep<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>shift <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span> &lt;=<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 0 slice<span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[]</span>
 <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> shift<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> shift<span class="org-kcats-brackets">]</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> let
<span class="org-comment-delimiter">;; </span><span class="org-comment">add an empty list for the partition state</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">[[]] swap put</span>

collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>a b<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>c d<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>e<span class="org-kcats-brackets">]]</span>
<span class="org-kcats-brackets">[[[</span>dictionary dictionary_redacted<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> shift<span class="org-kcats-brackets">]</span>
                bail<span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> shift<span class="org-kcats-brackets">]</span>
            <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span>resolver <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"yO3LwN0ITlhqAj8T1IKcUqNoiQmEAyrBwbFpGixDtQ8="</span><span class="org-kcats-brackets">]]]</span>
 <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> assign environment evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span> 2 2 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>a b c d e<span class="org-kcats-brackets">]</span> 2 
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>a b<span class="org-kcats-brackets">]</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[[</span>taker collect
                 <span class="org-builtin">dropdown</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">drop the used-up taker generator</span>
                <span class="org-function-name">join</span> divedeep<span class="org-kcats-brackets">]]</span>
   <span class="org-kcats-brackets">[</span>shift <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span> &lt;=<span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 0 slice<span class="org-kcats-brackets">]</span>
            <span class="org-kcats-brackets">[[]]</span> <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[]</span>
   <span class="org-kcats-brackets">[</span>over <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> shift<span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
   <span class="org-kcats-brackets">[[</span>over<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-function-name">wrap</span> <span class="org-function-name">take</span>-chunk <span class="org-builtin">swap</span> <span class="org-builtin">drop</span> shift<span class="org-kcats-brackets">]</span>
   <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> let

partition <span class="org-builtin">dropdown</span>  <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span>dictionary<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> set<span class="org-kcats-brackets">]</span> both
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>* + - / &lt; &lt;= = &gt; &gt;= abs addmethod and animate any? assert assign association association?
 attend autoformat
 bail bits both both? <span class="org-preprocessor">branch</span> butlast bytes? cache ceiling <span class="org-builtin">clone</span> clonedeep clonedown
 close compare confine contains? <span class="org-function-name">count</span> cut database days
 dec decache decide decodejson decorate decorated definition dictionary dictmerge
 <span class="org-preprocessor">dip</span> dipdeep <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">dive</span> divedeep <span class="org-preprocessor">divedown</span> draft <span class="org-builtin">drop</span> dropdeep <span class="org-builtin">dropdown</span> emit
 empty empty? encode encodejson encodenumber encodestring ends? entry environment
 error? eval-<span class="org-function-name">step</span> evaluate even? <span class="org-builtin">evert</span> every? <span class="org-preprocessor">execute</span> exp fail file-in file-out
 <span class="org-function-name">filter</span> finished? <span class="org-function-name">first</span> flatten flip <span class="org-builtin">float</span> floor format future generator get handle
 handoff hashbytes hours <span class="org-preprocessor">if</span> inc indexed indexer indexof
 <span class="org-preprocessor">inject</span> inscribe inspect interpose intersection <span class="org-function-name">join</span> label <span class="org-function-name">last</span> let list? log lookup
 <span class="org-preprocessor">loop</span> <span class="org-function-name">map</span> max method? milliseconds min minutes mod
 module negative? not number number? odd? or over pad pair pair? persist pipe-in pipe-out
 pipe? <span class="org-function-name">pop</span> positive? prepend prime primrec
 print <span class="org-function-name">put</span> quot radix range read receiver recover <span class="org-preprocessor">recur</span> rem repeat <span class="org-function-name">rest</span> restore retry
 <span class="org-function-name">reverse</span> round <span class="org-function-name">second</span> seconds select sender
 serversocket set set? <span class="org-preprocessor">shield</span> <span class="org-preprocessor">shielddeep</span> <span class="org-preprocessor">shielddown</span> shift <span class="org-builtin">sink</span> siphon sleep slice
 slurp <span class="org-builtin">snapshot</span> socket something? sort sort-indexed spawn spit sqrt
 stage standard starts? <span class="org-function-name">step</span> string string? <span class="org-builtin">swap</span> <span class="org-builtin">swapdown</span> <span class="org-function-name">take</span> <span class="org-function-name">take</span>-chunk template
 timer <span class="org-preprocessor">times</span> timestamps toe tos triplet tunnel type unassign
 under <span class="org-preprocessor">until</span> <span class="org-function-name">unwrap</span> update updates using value walk when <span class="org-preprocessor">while</span> within? word word?
 <span class="org-function-name">wrap</span> xor yes zero? zip<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>* + - / &lt; &lt;= = &gt; &gt;= abs addmethod advance and animate any? assemble assert assign
 association association?
 attend autoformat bail bits both both? <span class="org-preprocessor">branch</span> break breakpoint butlast bytes? cache
 catcher ceiling <span class="org-builtin">clone</span> clonedeep clonedown close collect combinations
 compare confine contains? <span class="org-function-name">count</span> cram cut database days dec decache decide decodejson
 decorate decorated definition dictionary dictmerge <span class="org-preprocessor">dip</span> dipdeep <span class="org-preprocessor">dipdown</span>
 <span class="org-preprocessor">dive</span> divedeep <span class="org-preprocessor">divedown</span> draft <span class="org-builtin">drop</span> dropdeep <span class="org-builtin">dropdown</span> dropper dump each emit empty
 empty? encode encodejson encodenumber encodestring ends? entry environment
 error? eval-<span class="org-function-name">step</span> evaluate even? <span class="org-builtin">evert</span> every? <span class="org-preprocessor">execute</span> exp fail file-in file-out <span class="org-function-name">filter</span>
 finished? <span class="org-function-name">first</span> flatten flip <span class="org-builtin">float</span> floor fold format
 frequencies future generate generator get group handle handoff hashbytes heatmap
 hours <span class="org-preprocessor">if</span> inc indexed indexer indexof <span class="org-preprocessor">inject</span> inscribe inspect integers
 interpose intersection into <span class="org-function-name">join</span> joiner keep label <span class="org-function-name">last</span> let liberate list? log lookup
 <span class="org-preprocessor">loop</span> <span class="org-function-name">map</span> max method? milliseconds min minutes
 mod module negative? not number number? odd? or over pad pair pair? pairwise partition
 persist pipe-in pipe-out pipe? <span class="org-function-name">pop</span> positive?
 prepend prime primrec print <span class="org-function-name">put</span> quot radix range read receiver recover <span class="org-preprocessor">recur</span> rem
 repeat <span class="org-function-name">rest</span> restore retry <span class="org-function-name">reverse</span> round <span class="org-function-name">second</span>
 seconds select sender serversocket set set? <span class="org-preprocessor">shield</span> <span class="org-preprocessor">shielddeep</span> <span class="org-preprocessor">shielddown</span> shift <span class="org-builtin">sink</span>
 siphon skipper sleep slice slurp <span class="org-builtin">snapshot</span> socket something? sort
 sort-indexed spawn spit split sprint sqrt stage standard starts? <span class="org-function-name">step</span> stepper string
 string? <span class="org-builtin">swap</span> <span class="org-builtin">swapdown</span> <span class="org-function-name">take</span> <span class="org-function-name">take</span>-chunk taker template timer
 <span class="org-preprocessor">times</span> timestamps toe tos tracer triplet tunnel type unassign under <span class="org-preprocessor">until</span> <span class="org-function-name">unwrap</span> update
 updates using value walk when <span class="org-preprocessor">while</span> within?
 word word? <span class="org-function-name">wrap</span> xor yes zero? zip<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4495514" class="outline-3">
<h3 id="org4495514"><span class="section-number-3">1.6.</span> Math</h3>
<div class="outline-text-3" id="text-1-6">
<div class='tangle-wrapper' data-tangle='src/kcats/core/math-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>+ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 + 3.3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 2.2 +<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3.2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>- <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 1 -<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1.1 2.2 - -1.1 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>2.2 1 - 1.2 0.00001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>4 3 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>10 1.5 * 15 0.0001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 0 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>5 -1 *<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>/ <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
    <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 3 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>15 1.5 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>10.0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>0 1 /<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
               <span class="org-kcats-brackets">[[</span>1 0 / handle <span class="org-kcats-brackets">[</span>reason<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 0 <span class="org-string">"division by zero"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>quot <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>16 5 quot<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>rem <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 rem<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>mod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>17 5 mod<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>exp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 5 exp<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>32<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>log <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>32 2 log<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>floor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 floor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>ceiling <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 ceiling<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>round <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 round<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sqrt <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>9 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>81 sqrt<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>9<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inc <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-1 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>99 inc<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>100<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>dec <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>100 dec<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>99<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>abs <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2.1 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2.1<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-0.2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0.2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>-2 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>0 abs<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>odd? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>-1 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                  <span class="org-kcats-brackets">[[</span>4 odd?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>even? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-2 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>3 even?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>zero? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>0.0 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>-0.00001 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>1.1 zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>number? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1<span class="org-kcats-brackets">]</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[[]</span> number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[</span>5 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span>5.01 number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>number <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>number<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"-11.1"</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>-11.1<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-function-name">first</span> number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>97<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/math.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>positive? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>negative? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>0 &lt;<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>within? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>- abs<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> &lt;<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1.0 2.0 + 3 0.001 within?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orga1ad13e" class="outline-3">
<h3 id="orga1ad13e"><span class="section-number-3">1.7.</span> Serialization</h3>
<div class="outline-text-3" id="text-1-7">
<div class='tangle-wrapper' data-tangle='src/kcats/core/serialize-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>read <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[1 [2] 3]"</span> read<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>emit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>1 <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]</span> 3<span class="org-kcats-brackets">]</span> emit<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1 [2] 3"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>autoformat <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"[[foo bar] [baz [[quux floop] [toop zoop]]]]"</span> autoformat<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"[[foo bar]\n [baz [[quux floop]\n       [toop zoop]]]]"</span><span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org908dee5" class="outline-3">
<h3 id="org908dee5"><span class="section-number-3">1.8.</span> Boolean logic</h3>
<div class="outline-text-3" id="text-1-8">
<div class='tangle-wrapper' data-tangle='src/kcats/core/boolean-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>yes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">self-inserts</span>

<span class="org-kcats-brackets">[</span>and <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 2 even? and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>2 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[]</span> 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                 <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> 3 and<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>or <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
     <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 odd? 3 even? or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span>1 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[[]</span> 2 or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[[]</span> <span class="org-kcats-brackets">[]</span> or<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>not <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 even? not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[[]</span> not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                 <span class="org-kcats-brackets">[[</span>yes not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                 <span class="org-kcats-brackets">[[[]</span> not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org36fa4fe" class="outline-3">
<h3 id="org36fa4fe"><span class="section-number-3">1.9.</span> Byte encoding and decoding</h3>
<div class="outline-text-3" id="text-1-9">
<div class='tangle-wrapper' data-tangle='src/kcats/core/encode-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>encodestring <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encodestring<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodenumber <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>number<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw"</span><span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>12.3 encodenumber<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"QCiZmZmZmZo"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>decodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"12"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"12.01"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>12.01<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"\"foo\""</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"{\"foo\": 12, \"bar\": \"baz\"}"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"[1,\"foo\"]"</span> decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>encodejson <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>12.01 encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"12.01"</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"\"foo\""</span><span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association encodejson decodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> 12<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-string">"baz"</span><span class="org-kcats-brackets">]]</span> association<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[[</span>1 <span class="org-string">"foo"</span><span class="org-kcats-brackets">]</span> encodejson<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1,\"foo\"]"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bytes? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Zm9v"</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]</span> bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                    <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>xor <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>10 12 xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">10 = 01010, 12 = 01100, 00110, 6</span>
                  <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode <span class="org-string">"bar"</span> encode xor<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"BA4d"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>bits <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>encode <span class="org-kcats-brackets">[[</span>2 radix 8 0 pad<span class="org-kcats-brackets">]</span> each joiner<span class="org-kcats-brackets">]</span> assemble <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> bits<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 1 0 0 1 1 0 0 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1<span class="org-kcats-brackets">]]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/encode.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>encode <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]</span>
                        <span class="org-kcats-brackets">[[</span>string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encodestring<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>number?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encodenumber<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>emit encode<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>12 encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"AAAAAAAAAAw"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> encode encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"Zm9v"</span><span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> encode<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>radix <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>/<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span>
                       <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span>
                       <span class="org-builtin">swapdown</span> -
                       <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>prepend<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                      <span class="org-builtin">swap</span> prepend
                      <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]]</span> <span class="org-preprocessor">dip</span>
                      <span class="org-preprocessor">while</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>7 2 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 1 1<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>9 3 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1 0 0<span class="org-kcats-brackets">]]]</span>
                    <span class="org-kcats-brackets">[[</span>255 16 radix<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>15 15<span class="org-kcats-brackets">]]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org03a2d32" class="outline-3">
<h3 id="org03a2d32"><span class="section-number-3">1.10.</span> Strings</h3>
<div class="outline-text-3" id="text-1-10">
<div class='tangle-wrapper' data-tangle='src/kcats/core/strings-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"1"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"[1 2 3]"</span><span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[[]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">""</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>format <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo {} bar {} baz"</span> <span class="org-kcats-brackets">[</span><span class="org-string">"abc"</span> <span class="org-string">"def"</span><span class="org-kcats-brackets">]</span> format<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo abc bar def baz"</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>string? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[</span><span class="org-string">""</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[[[</span><span class="org-string">"hi"</span><span class="org-kcats-brackets">]</span> string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                     <span class="org-kcats-brackets">[[</span>yes string?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Don't really belong here but good enough for now</span>
<span class="org-kcats-brackets">[</span>word? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>yes word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>1 word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span><span class="org-string">"yes"</span> word?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>word <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word<span class="org-kcats-brackets">]]]</span>
       <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> word<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span><span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>inspect <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>string<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org289a3ef" class="outline-3">
<h3 id="org289a3ef"><span class="section-number-3">1.11.</span> Error handling</h3>
<div class="outline-text-3" id="text-1-11">
<div class='tangle-wrapper' data-tangle='src/kcats/core/errors-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>error? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">handle is a special word only used to unwind the program on</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">error, if there's no error and we end up reaching this word, we</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">ignore it.</span>
<span class="org-kcats-brackets">[</span>handle <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

<span class="org-kcats-brackets">[</span>fail <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/errors.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>assert <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">save stack to print in err message</span>
                       <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">run the assertion under the saved stack</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if passes, drop the saved stack, dont need</span>
                       <span class="org-kcats-brackets">[</span>string <span class="org-kcats-brackets">[</span><span class="org-string">"assertion failed "</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">join</span> fail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">else throw err</span>
                       <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>recover <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>handle<span class="org-kcats-brackets">]</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">add handle to the end of test</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">rec test ss</span>
                        <span class="org-builtin">sink</span> <span class="org-preprocessor">inject</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">res rec</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> error?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">err? res rec</span>
                        <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> <span class="org-builtin">swap</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span><span class="org-comment-delimiter">;; </span><span class="org-comment">drop the snapshot and run recovery</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">use snapshot as stack</span>
                        <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span>+<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 1
                         <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 2 +<span class="org-kcats-brackets">]</span>
                         recover<span class="org-kcats-brackets">]</span>
                        recover<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]</span>

                      <span class="org-kcats-brackets">[[[</span>1 2 <span class="org-string">"oh fudge"</span><span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>5 +<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 5<span class="org-kcats-brackets">]</span>
                         recover<span class="org-kcats-brackets">]</span>
                        <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>6 7 5<span class="org-kcats-brackets">]]]</span>

                      <span class="org-kcats-brackets">[[[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> recover<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]]]]]]</span>

 <span class="org-kcats-brackets">[</span>retry <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>error<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>unwound<span class="org-kcats-brackets">]</span> lookup
                      <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>2 3 <span class="org-string">"four"</span> * + handle <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> 4<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> retry<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>14<span class="org-kcats-brackets">]]]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgf95f04f" class="outline-3">
<h3 id="orgf95f04f"><span class="section-number-3">1.12.</span> Methods</h3>
<div class="outline-text-3" id="text-1-12">
<p>
We want a way of adding methods to a word that's already set up as a
simple 'decide' form. This will add the method at the beginning -
adding it at the end is not good because often there's a catchall
condition at the end, and adding beyond that means the new condition
is unreachable. Adding at the beginning is not always what the user
wants either, though. So maybe this could be improved by taking
another argument: a program to combine the item and the existing list
(that defaults to <code>prepend</code> here).
</p>
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/methods.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>addmethod <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program method<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program condition<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program definition<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[[</span>program newdefinition<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>*2 *1<span class="org-kcats-brackets">]</span> prepend<span class="org-kcats-brackets">]</span> pack
                          <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]</span>
             <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[[[</span><span class="org-function-name">count</span> 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]</span> decide<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> addmethod<span class="org-kcats-brackets">]</span>

                         <span class="org-kcats-brackets">[[[[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 3 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"foo"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
                            <span class="org-kcats-brackets">[[</span>not<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]]</span>
                           decide<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>method? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-function-name">first</span> <span class="org-kcats-brackets">[[</span>pair?<span class="org-kcats-brackets">]</span>
                                 <span class="org-kcats-brackets">[[</span>list?<span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]]</span> every?<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span> <span class="org-kcats-brackets">[</span>decide<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]]</span>
                        every?<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org5c11fb0" class="outline-3">
<h3 id="org5c11fb0"><span class="section-number-3">1.13.</span> Pipes</h3>
<div class="outline-text-3" id="text-1-13">
<div class='tangle-wrapper' data-tangle='src/kcats/core/pipes-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>pipe? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>timestamps pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[</span>standard pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                   <span class="org-kcats-brackets">[[[</span>1 2 3<span class="org-kcats-brackets">]</span> pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]</span>
                   <span class="org-kcats-brackets">[[</span>5 pipe?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>animate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>

<span class="org-kcats-brackets">[</span>attend <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>list<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>list<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>file-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>handoff <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>receiver <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>select <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list pipes<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>item pipe <span class="org-kcats-brackets">[</span>list pipes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sender <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>serversocket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>socket <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>standard <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>timestamps <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>database <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>sized params<span class="org-kcats-brackets">]</span> string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>

<span class="org-kcats-brackets">[</span>persist <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/pipes.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>pipe-in <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                        <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>value file-in<span class="org-kcats-brackets">]]</span>
                         <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                          <span class="org-kcats-brackets">[</span>stdout<span class="org-kcats-brackets">]]]</span>
                        decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>tunnel <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                       <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                          serversocket<span class="org-kcats-brackets">]]</span>
                        <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-client<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                          <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                          <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                          socket<span class="org-kcats-brackets">]]]</span>
                       decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>pipe-out <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>association
                         <span class="org-kcats-brackets">[[[</span>type <span class="org-kcats-brackets">[</span>file<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span>value file-out<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[</span>type <span class="org-kcats-brackets">[</span>ip-host<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span>
                            <span class="org-kcats-brackets">[</span>port<span class="org-kcats-brackets">]</span> lookup
                            <span class="org-kcats-brackets">[[</span>address<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                            serversocket<span class="org-kcats-brackets">]]]</span>
                         decide<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>spit <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item <span class="org-kcats-brackets">[</span>item target<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>pipe-in<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> encode <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>slurp <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> fold string <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>print <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>string<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>standard<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-string">"\n"</span> <span class="org-function-name">join</span> encode <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-comment-delimiter">;;</span><span class="org-comment">[slurp [[spec [[[item target]] [item pipe]]]]]</span>

 <span class="org-kcats-brackets">[</span>sleep <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>timer <span class="org-function-name">take</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>future <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>pipe<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>handoff <span class="org-builtin">swap</span>
                       <span class="org-kcats-brackets">[[</span>**1 <span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">return entire stack</span>
                        <span class="org-preprocessor">dive</span> <span class="org-function-name">put</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> pack
                       dictionary <span class="org-builtin">swap</span> spawn animate<span class="org-kcats-brackets">]]</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 <span class="org-kcats-brackets">[</span>2 +<span class="org-kcats-brackets">]</span> future <span class="org-function-name">take</span> <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>3<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>generator <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program generator-maker<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>program wrapped-generator<span class="org-kcats-brackets">]]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-builtin">swap</span> <span class="org-preprocessor">inject</span>
                          <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">inject</span> <span class="org-function-name">take</span><span class="org-kcats-brackets">]]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">generate from the wrapped generator</span>

 <span class="org-kcats-brackets">[</span>siphon <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>receptacle output<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>program generator<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[[</span>receptacle output<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>description <span class="org-string">"Generates values from a wrapped generator (stacked generator inside a list), until exhausted, puts all items into the output receptacle"</span><span class="org-kcats-brackets">]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">placeholder that gets dropped (next</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">iteration it will hold a copy of the last</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">element which is only needed to check if</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">the loop continues and can be dropped</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">after)</span>
                       <span class="org-kcats-brackets">[</span>empty?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">stop when generator returns</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">nothing</span>
                       <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the last value</span>
                        <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                        <span class="org-builtin">sink</span>
                        <span class="org-kcats-brackets">[[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
                       <span class="org-preprocessor">until</span>
                       <span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-builtin">sink</span> <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the now-empty dispenser</span>
          <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>integers 5 taker<span class="org-kcats-brackets">]</span> generator <span class="org-kcats-brackets">[]</span> siphon<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>0 1 2 3 4<span class="org-kcats-brackets">]]]]]]]</span>

 <span class="org-kcats-brackets">[</span>close <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>pipe<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgaf150de" class="outline-3">
<h3 id="orgaf150de"><span class="section-number-3">1.14.</span> Crypto</h3>
<div class="outline-text-3" id="text-1-14">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>random <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>key <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>bytes<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[</span><span class="org-string">"foo"</span> encode key<span class="org-kcats-brackets">]</span> 2 <span class="org-preprocessor">times</span> =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>sign <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes message<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association key<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>verify <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>bytes signature<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>bytes message<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>sized key<span class="org-kcats-brackets">]]</span>

                <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span><span class="org-string">"foo"</span> encode key <span class="org-string">"we attack at dawn"</span> encode <span class="org-kcats-brackets">[</span>sign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> verify<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/crypto.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>delegated <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>association pubkey<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
             <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span><span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">css cs pk</span>
                            <span class="org-kcats-brackets">[[</span>hash<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> decorated <span class="org-comment-delimiter">;; </span><span class="org-comment">css csh cs pk</span>
                             <span class="org-builtin">float</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">cs css csh pk</span>
                             <span class="org-kcats-brackets">[</span>verify<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
                             <span class="org-kcats-brackets">[[]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the program to run if the child script isn't authorized</span>
                             <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">runs the child script if the sig on its hash is verified</span>
                            <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the sig and (empty) child script -&gt; pk sig msg</span>
                             <span class="org-builtin">sink</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">sig msg pk</span>
                             verify<span class="org-kcats-brackets">]</span>
                            <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-preprocessor">branch</span><span class="org-kcats-brackets">]</span>
                           <span class="org-kcats-brackets">[[]]</span> recover<span class="org-kcats-brackets">]</span>
                          <span class="org-builtin">swap</span> prepend<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prepend the pubkey</span>

 <span class="org-kcats-brackets">[</span>hash <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>bytes<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span>bytes?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>hashbytes<span class="org-kcats-brackets">]]</span>
                      <span class="org-kcats-brackets">[[</span><span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>encode hash<span class="org-kcats-brackets">]]]</span>
                     decide<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-orgbb8a371" class="outline-3">
<h3 id="orgbb8a371"><span class="section-number-3">1.15.</span> Time and date</h3>
<div class="outline-text-3" id="text-1-15">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/time.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>milliseconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
                <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

 <span class="org-kcats-brackets">[</span>seconds <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>1000 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>minutes <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>seconds 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>hours <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>minutes 60 *<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>days <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>integer<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>integer<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>hours 24 *<span class="org-kcats-brackets">]]]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org4ed1352" class="outline-3">
<h3 id="org4ed1352"><span class="section-number-3">1.16.</span> Nested Environments</h3>
<div class="outline-text-3" id="text-1-16">
<div class='tangle-wrapper' data-tangle='src/kcats/core/environment-builtins.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>environment <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>sized<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
              <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]]</span> environment eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>environment? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>item<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
               <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]</span>
                          <span class="org-kcats-brackets">[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]]]]]]]</span>

<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 inc<span class="org-kcats-brackets">]]]</span> environment
                         eval-<span class="org-function-name">step</span> eval-<span class="org-function-name">step</span>
                         <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[[</span>2<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>evaluate <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[</span>14 1<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>finished? <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>boolean<span class="org-kcats-brackets">]]]</span>
            <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[[]]]</span>
                      <span class="org-kcats-brackets">[[[[</span>program <span class="org-kcats-brackets">[</span>1 2 3 4 + *<span class="org-kcats-brackets">]]]</span> environment
                        evaluate
                        finished?<span class="org-kcats-brackets">]</span>
                       <span class="org-kcats-brackets">[</span>yes<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>using <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>list modules<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>sized env<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]]]</span>

<span class="org-kcats-brackets">[</span>use <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program <span class="org-kcats-brackets">[</span>list modules<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> label environment <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">lm env</span>
                   <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> assign<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">capture the stack at runtime</span>
                   using <span class="org-comment-delimiter">;; </span><span class="org-comment">set up the resolver </span>
                   evaluate <span class="org-comment-delimiter">;; </span><span class="org-comment">execute the program in the inner environment</span>
                   <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore <span class="org-comment-delimiter">;; </span><span class="org-comment">replace the stack with the result from the inner env</span>
                   <span class="org-kcats-brackets">]]]]</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/core/environment.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>tos <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>stack<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
                   tos<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">TODO we don't use the term 'expression' anymore so this needs renaming</span>
<span class="org-kcats-brackets">[</span>top <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>item<span class="org-kcats-brackets">]]]</span>
      <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
      <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[[[</span>stack <span class="org-kcats-brackets">[</span>1 2 3<span class="org-kcats-brackets">]]</span>
                    <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
                   toe<span class="org-kcats-brackets">]</span>
                  <span class="org-kcats-brackets">[[</span>+<span class="org-kcats-brackets">]]]]]]]</span>

<span class="org-kcats-brackets">[</span>stage <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> label environment<span class="org-kcats-brackets">]]]]</span>

<span class="org-kcats-brackets">[</span>spawn <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span><span class="org-builtin">snapshot</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">p d s</span>
                     <span class="org-kcats-brackets">[</span>program dictionary stack<span class="org-kcats-brackets">]</span> label
                     environment<span class="org-kcats-brackets">]]</span>
        <span class="org-kcats-brackets">[</span>examples <span class="org-kcats-brackets">[[[</span>1 2 3 dictionary <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> spawn<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[</span>1 2 3 <span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[</span>3 2 1<span class="org-kcats-brackets">]]]</span> environment<span class="org-kcats-brackets">]]]]]]</span>

<span class="org-kcats-brackets">[</span>confine <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program module<span class="org-kcats-brackets">]</span> dictionary<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>spawn evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup restore<span class="org-kcats-brackets">]]]]</span>
</pre>
</div></div>
</div>
<div id="outline-container-org6c1655d" class="outline-4">
<h4 id="org6c1655d"><span class="section-number-4">1.16.1.</span> Debugging</h4>
<div class="outline-text-4" id="text-1-16-1">
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/debug.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>break <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]</span>
                <span class="org-kcats-brackets">[[</span>program condition<span class="org-kcats-brackets">]</span> environment<span class="org-kcats-brackets">]]]</span>
         <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[[</span><span class="org-builtin">swap</span> something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">still running</span>
                        <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> not<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">check condition not true yet</span>
                       <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
                       every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
                      <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                      <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>breakpoint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
              <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[]]]]</span>

 <span class="org-kcats-brackets">[</span>sprint <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span>
                 <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>program 0<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>breakpoint<span class="org-kcats-brackets">]</span> =<span class="org-kcats-brackets">]</span> break
                       <span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the condition</span>
                       <span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]]]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">advance past the breakpoint word if the program isn't complete</span>


 <span class="org-kcats-brackets">[</span>advance <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>environment<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>environment<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">count up the program length, we'll run until it's smaller than this</span>

                        <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">only stop if expr empty or shorter than we started off</span>
                         <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&lt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
                        <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
                        <span class="org-preprocessor">while</span>
                        <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the program length item</span>

 <span class="org-kcats-brackets">[</span>stepper <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[</span>program<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]]]]]</span>

 <span class="org-kcats-brackets">[</span>tracer <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>program generator<span class="org-kcats-brackets">]]]]</span>
          <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span>stage stepper<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>dump <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[]]]</span>
        <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> <span class="org-function-name">wrap</span> emit autoformat print<span class="org-kcats-brackets">]]]]</span>

 <span class="org-kcats-brackets">[</span>heatmap <span class="org-kcats-brackets">[[</span>spec <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>association<span class="org-kcats-brackets">]]]</span>
           <span class="org-kcats-brackets">[</span>definition <span class="org-kcats-brackets">[[</span>tracer
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">what item is being executed</span>
                         <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">don't emit [] or the execution stops, use 0 instead</span>
                          bail 0 or<span class="org-kcats-brackets">]</span>
                         each 
                         <span class="org-kcats-brackets">[</span>word?<span class="org-kcats-brackets">]</span> keep <span class="org-comment-delimiter">;; </span><span class="org-comment">count only words, which filters out the 0's from above</span>
                         frequencies<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]]]]]</span>


<span class="org-function-name">join</span>
</pre>
</div></div>

<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/debug-step.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>evaluating? <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-kcats-brackets">[</span>evaluate<span class="org-kcats-brackets">]</span> starts?<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>with-innermost <span class="org-kcats-brackets">[[[]</span> <span class="org-builtin">swap</span>
                   <span class="org-kcats-brackets">[[</span>evaluating?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>stack 0<span class="org-kcats-brackets">]</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span>lookup<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">append the next part of the path to the accumulator</span>
                    <span class="org-preprocessor">while</span> <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> dropdeep<span class="org-kcats-brackets">]</span>
                  <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">under the stepping prog</span>
                  <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> flip <span class="org-builtin">drop</span>

                  <span class="org-comment-delimiter">;; </span><span class="org-comment">find which envs are finished and remove</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">'evaluate' from parent</span>
                  <span class="org-kcats-brackets">[</span>0 -2 slice <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>collect<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddeep</span> 
                  <span class="org-kcats-brackets">[[[[[</span>evaluating?<span class="org-kcats-brackets">]</span>
                      <span class="org-kcats-brackets">[[</span>stack 0<span class="org-kcats-brackets">]</span> lookup finished?<span class="org-kcats-brackets">]]</span>
                     <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
                    <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">rest</span><span class="org-kcats-brackets">]</span> update<span class="org-kcats-brackets">]</span>
                    when<span class="org-kcats-brackets">]</span>
                   <span class="org-kcats-brackets">[</span>update<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shielddown</span> flip <span class="org-builtin">drop</span> <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
                  <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
<span class="org-function-name">join</span>
</pre>
</div></div>
</div>
<div id="outline-container-orge15863a" class="outline-5">
<h5 id="orge15863a"><span class="section-number-5">1.16.1.1.</span> Examples</h5>
<div class="outline-text-5" id="text-1-16-1-1">
</div>
<ol class="org-ol">
<li><a id="orga9f5c60"></a>Count the number of times each word is executed while running a program.<br />
<div class="outline-text-6" id="text-1-16-1-1-1">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment
evaluate
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>0 1 2 3 4 5 6 7 8 9 10<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span>
</pre>
</div>
<pre class="example">

[0 1 2 3 4 5 6 7 8 9 10]
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span>  word?
</pre>
</div>

<pre class="example">

[yes]
</pre>


<p>
"Increment the counter, or set to 1 if nothing"
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> bail 1 or
</pre>
</div>

<pre class="example">
1
</pre>


<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">empty list to put word counts in</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>3 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment
<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program, keep running</span>
<span class="org-kcats-brackets">[[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">get the item we're about to execute</span>
 <span class="org-builtin">swap</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">put it under the environment</span>
 <span class="org-kcats-brackets">[[</span>word?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">; </span><span class="org-comment">if it's a word</span>
  <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span>
   <span class="org-kcats-brackets">[[</span>inc<span class="org-kcats-brackets">]</span> bail 1 or<span class="org-kcats-brackets">]</span>
   update<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the results, the count for the word about to execute</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if it's not a word, do nothing</span>
  <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
 eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
<span class="org-preprocessor">while</span>
<span class="org-builtin">drop</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">drop the environment and just report the word counts</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-function-name">wrap</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span> 2<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">inject</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">loop</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>dec 3<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>decorate 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> 14<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&gt; 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">while</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> 16<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> 8<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> 9<span class="org-kcats-brackets">]]</span>
</pre>
</div>

<p>
Now that we have generators and <code>frequencies</code> I think this can be greatly simplified:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>5000 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
tracer
<span class="org-kcats-brackets">[[</span>program 0<span class="org-kcats-brackets">]</span> lookup <span class="org-string">"foo"</span> or<span class="org-kcats-brackets">]</span> each
<span class="org-kcats-brackets">[</span>word?<span class="org-kcats-brackets">]</span> keep
frequencies
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>&gt; 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> 2002<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>dec 1000<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>decorate 2<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span>decorated 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> 2007<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dip</span> 2<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">dipdown</span> 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-builtin">evert</span> 4004<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">inject</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span> 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">loop</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span> 3<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">shield</span> 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-builtin">snapshot</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span> 5<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> 1002<span class="org-kcats-brackets">]</span>
 
 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">unwrap</span> 1001<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">while</span> 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> 3<span class="org-kcats-brackets">]]</span>
<span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> generate<span class="org-kcats-brackets">]</span>
        <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
 <span class="org-preprocessor">dive</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[[</span>something?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>word? not<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>generate <span class="org-kcats-brackets">[[[</span>program 0<span class="org-kcats-brackets">]</span>
            lookup <span class="org-string">"foo"</span> or<span class="org-kcats-brackets">]</span>
           bail<span class="org-kcats-brackets">]</span>
 <span class="org-preprocessor">shielddown</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span>
</pre>
</div>
</div>
</li>
<li><a id="org69001b5"></a><span class="done CANCELED">CANCELED</span> spec checking<br />
<div class="outline-text-6" id="text-1-16-1-1-2">
<p>
clojure spec check can be replaced with predicate programs, that will
be run with <code>shield</code> before the actual word and if it returns false,
will raise an error.
</p>
</div>
</li>
<li><a id="orgafc3462"></a><span class="todo TODO">TODO</span> Trace output<br />
<div class="outline-text-6" id="text-1-16-1-1-3">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">results</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-builtin">clone</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
<span class="org-preprocessor">while</span>

</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]</span>
 <span class="org-kcats-brackets">[[[</span>stack <span class="org-kcats-brackets">[</span>1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>2 3 4 5<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>2 3 4 5<span class="org-kcats-brackets">]</span> 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2 1<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>3 4 5<span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>3 4 5<span class="org-kcats-brackets">]</span> 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 3 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>3 2<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span> 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 4 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>4 6<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>* <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>5<span class="org-kcats-brackets">]</span> 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>5<span class="org-kcats-brackets">]</span> 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">step</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[[</span>*<span class="org-kcats-brackets">]</span> 5 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>5 24<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[</span>*<span class="org-kcats-brackets">]]]</span>
  <span class="org-kcats-brackets">[[</span>stack <span class="org-kcats-brackets">[</span>120<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>program <span class="org-kcats-brackets">[]]]]]</span>
</pre>
</div>
</div>
</li>
<li><a id="org86f920d"></a><span class="done DONE">DONE</span> Step count limiting<br />
<div class="outline-text-6" id="text-1-16-1-1-4">
<p>
When testing or debugging, limit the number of steps to avoid a
possible infinite loop.
</p>
<div class="org-src-container">
<pre class="src src-kcats">200 <span class="org-comment-delimiter">;; </span><span class="org-comment">step count remaining</span>
<span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>10 <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup something? <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program</span>
 <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> and<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">still step budget remaining</span>
<span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-kcats-brackets">[</span>dec<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">decrease the step budget</span>
<span class="org-preprocessor">while</span>

<span class="org-comment-delimiter">;</span><span class="org-comment">[stack] lookup ;; return the output</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">evert</span> <span class="org-function-name">first</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">clone</span> dec <span class="org-kcats-brackets">[</span>0 &gt;<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">loop</span><span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span>stack <span class="org-kcats-brackets">[[[</span>0 &gt;<span class="org-kcats-brackets">]</span> 4 5 6 7 8 9 10<span class="org-kcats-brackets">]</span> 4 5 6 7 8 9 10<span class="org-kcats-brackets">]]]</span> 0
</pre>
</div>
</div>
</li>
<li><a id="org37db6f1"></a><span class="done DONE">DONE</span> Breakpoint<br />
<div class="outline-text-6" id="text-1-16-1-1-5">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[[[</span>toe <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> =<span class="org-kcats-brackets">]</span>
   <span class="org-kcats-brackets">[</span>tos 3 &gt;<span class="org-kcats-brackets">]]</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
  every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">when to stop - when we're about to add and tos already &gt;3</span>
 <span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
 environment

 <span class="org-kcats-brackets">[[[[</span>program<span class="org-kcats-brackets">]</span> lookup something?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">something still in the program</span>
   <span class="org-kcats-brackets">[</span><span class="org-builtin">swap</span> <span class="org-preprocessor">execute</span> not<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">don't stop yet</span>
  <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span>
  every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">break?</span>
 <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
<li><a id="org43b4f02"></a><span class="todo TODO">TODO</span> Step over<br />
<div class="outline-text-6" id="text-1-16-1-1-6">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>0 <span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>+<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">the sample program to run</span>
 environment

<span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span><span class="org-comment-delimiter">;; </span><span class="org-comment">count up the program length, we'll run until it's smaller than this</span>

 <span class="org-kcats-brackets">[[</span>program<span class="org-kcats-brackets">]</span> lookup <span class="org-function-name">count</span>
  <span class="org-kcats-brackets">[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>&lt;=<span class="org-kcats-brackets">]]</span> <span class="org-kcats-brackets">[</span><span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> every?<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">only stop if expr empty or shorter than we started off</span>
 <span class="org-kcats-brackets">[</span>eval-<span class="org-function-name">step</span><span class="org-kcats-brackets">]</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">evaluate the environment one step</span>
 <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgd061511" class="outline-3">
<h3 id="orgd061511"><span class="section-number-3">1.17.</span> <span class="todo TODO">TODO</span> Functional environment</h3>
<div class="outline-text-3" id="text-1-17">
<p>
There are use cases for kcats where you don't want a program to be
able to mess with external resources like files, network sockets etc
nor be able to spawn new threads, the program it's running should be a
pure function and this module lets you enforce that.
</p>
<div class='tangle-wrapper' data-tangle='src/kcats/stdlib/functional.kcats'><div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>pipe-in pipe-out channel timeout
 handoff file-in file-out timestamps
 standard serversocket animate future
 spit tunnel database<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span><span class="org-function-name">wrap</span> unassign<span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
</pre>
</div></div>
</div>
</div>
</div>
<div id="outline-container-orgbe193e1" class="outline-2">
<h2 id="orgbe193e1"><span class="section-number-2">2.</span> Issues</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org460d4ae" class="outline-3">
<h3 id="org460d4ae"><span class="section-number-3">2.1.</span> <span class="done DONE">DONE</span> Get rid of platform-specific definitions</h3>
</div>
<div id="outline-container-orgd867e7a" class="outline-3">
<h3 id="orgd867e7a"><span class="section-number-3">2.2.</span> <span class="done DONE">DONE</span> fix evaluate</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>program <span class="org-kcats-brackets">[</span>1 1 +<span class="org-kcats-brackets">]]]</span> environment evaluate <span class="org-kcats-brackets">[</span>stack<span class="org-kcats-brackets">]</span> lookup
</pre>
</div>

<pre class="example">

[[2]]
</pre>
</div>
</div>
<div id="outline-container-orga9e6e8c" class="outline-3">
<h3 id="orga9e6e8c"><span class="section-number-3">2.3.</span> <span class="todo TODO">TODO</span> merkle tree functions</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-function-name">join</span> hash <span class="org-string">"foobar"</span> hash =
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">yes
</pre>
</div>

<p>
First let's figure out how to represent a tree:
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-comment-delimiter">;</span><span class="org-comment">[5 [[3 [[1c []]</span>
<span class="org-comment-delimiter">;        </span><span class="org-comment">[2c []]]]</span>
<span class="org-comment-delimiter">;    </span><span class="org-comment">[4 [[3c []]]]]]</span>
<span class="org-kcats-brackets">[[</span>hash <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>empty-node <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">""</span> hash node<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rawpath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [[] [take swap [child] dip path] [drop] if]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix rawpath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>parent <span class="org-kcats-brackets">[</span>butlast butlast<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
          hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">lopsidedtree n</span>
 <span class="org-kcats-brackets">[</span>balance <span class="org-kcats-brackets">[]]</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree cur-ct</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span><span class="org-builtin">clone</span> path <span class="org-kcats-brackets">[</span><span class="org-function-name">pop</span> zero?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>parent<span class="org-kcats-brackets">]</span> when<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dipdown</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">node tree path ct</span>
       <span class="org-builtin">swapdown</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">node path tree ct</span>
       <span class="org-kcats-brackets">[]]]</span>
 <span class="org-kcats-brackets">[</span>add <span class="org-kcats-brackets">[[</span>odd?<span class="org-kcats-brackets">]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">insert an unbalanced node (empty sibling)</span>
       <span class="org-kcats-brackets">[</span>empty-node siblings <span class="org-kcats-brackets">[</span>path parent<span class="org-kcats-brackets">]]</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise replace the empty sibling</span>
       <span class="org-kcats-brackets">[]</span>
      <span class="org-kcats-brackets">]]]</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">["" drop</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[0 []] 1 node addchild 2 node 3 node addchild addchild</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;[1 0]  1 [interpose] shield swap put dropdown lookup</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"foo"  hash node "bar"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;; update the root node</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">; now add a new sibling</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"baz"  hash node siblings</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">rehash</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">3 path [pop zero?] [butlast butlast] [] if</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">;dump</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">["quux" hash node siblings rehash ] update</span>
<span class="org-comment-delimiter">; </span><span class="org-comment">]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-string">"bar"</span> <span class="org-string">"baz"</span> <span class="org-string">"quux"</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>node<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span> <span class="org-kcats-brackets">[]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
1234
</p>
<ul class="org-ul">
<li>12
<ul class="org-ul">
<li>1</li>
<li>2</li>
</ul></li>
<li>34
<ul class="org-ul">
<li>3</li>
<li>4</li>
</ul></li>
</ul>

<ul class="org-ul">
<li>5</li>
<li>6</li>
</ul></li>
</ul>
<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
<span class="org-kcats-brackets">[</span><span class="org-string">""</span> <span class="org-kcats-brackets">[]]</span>
</pre>
</div>

<p>
interpose impl
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 3 4<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>foo<span class="org-kcats-brackets">]</span> <span class="org-function-name">unwrap</span> interpose
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 foo 3 foo 4<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>3 <span class="org-kcats-brackets">[]]]]]]</span>
  <span class="org-kcats-brackets">[</span>1 0<span class="org-kcats-brackets">]</span> 1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend 0 <span class="org-function-name">put</span> <span class="org-builtin">dropdown</span> <span class="org-kcats-brackets">[</span>inc<span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 <span class="org-kcats-brackets">[[</span>1 <span class="org-kcats-brackets">[]]</span>
    <span class="org-kcats-brackets">[</span>2 <span class="org-kcats-brackets">[[</span>4 <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<p>
We need a function that, given a number n, gives the path in the
merkle tree. eg, 8 would be 1 1 1. Is it just <code>n-1</code> in binary?
6 would be 1 0 1. Ok so just write a function to expand binary digits:
</p>

<div class="org-src-container">
<pre class="src src-kcats">8 dec 2 radix
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]</span> <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-builtin">drop</span> <span class="org-string">"hi"</span> <span class="org-string">"there"</span><span class="org-kcats-brackets">]</span> update
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-string">"there"</span><span class="org-kcats-brackets">]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>hash <span class="org-kcats-brackets">[]]</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>child <span class="org-kcats-brackets">[[</span>children<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> get<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-comment-delimiter">;</span><span class="org-comment">[path [[] [take swap [child] dip path] [drop] if]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[</span>dec 2 radix nodepath<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span> hash <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>

 <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]</span>
 assign<span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
             <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]</span>
 <span class="org-kcats-brackets">[</span>1 1<span class="org-kcats-brackets">]</span>
 <span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
               <span class="org-kcats-brackets">[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]]]]</span>
<span class="org-function-name">reverse</span> <span class="org-function-name">unwrap</span> assign
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span><span class="org-string">"foobarbaz"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foobar"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"foo"</span> <span class="org-kcats-brackets">[]]</span>
                         <span class="org-kcats-brackets">[</span><span class="org-string">"bar"</span> <span class="org-kcats-brackets">[]]]]</span>
              <span class="org-kcats-brackets">[</span><span class="org-string">"bazquux"</span> <span class="org-kcats-brackets">[[</span><span class="org-string">"baz"</span> <span class="org-kcats-brackets">[]]</span>
                          <span class="org-kcats-brackets">[</span><span class="org-string">"quux"</span> <span class="org-kcats-brackets">[]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">
<span class="org-kcats-brackets">[</span>
 <span class="org-kcats-brackets">[</span>children <span class="org-kcats-brackets">[</span><span class="org-function-name">second</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>data <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>node <span class="org-kcats-brackets">[[]</span> pair<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>addchild <span class="org-kcats-brackets">[[</span><span class="org-function-name">pop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-function-name">put</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>siblings <span class="org-kcats-brackets">[[]</span> node <span class="org-builtin">sink</span> <span class="org-kcats-brackets">[</span>addchild<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> addchild<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>nodepath <span class="org-kcats-brackets">[</span>1 <span class="org-kcats-brackets">[</span>interpose<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> <span class="org-builtin">swap</span> prepend <span class="org-builtin">dropdown</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>padded <span class="org-kcats-brackets">[[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
          <span class="org-builtin">swap</span> repeat
          <span class="org-builtin">swap</span> <span class="org-function-name">join</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>path <span class="org-kcats-brackets">[[</span>dec 2 radix<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> 2 log ceiling 0 padded nodepath<span class="org-kcats-brackets">]]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">item-ct index</span>
 <span class="org-kcats-brackets">[</span>depth <span class="org-kcats-brackets">[]]</span>

 <span class="org-kcats-brackets">[</span>rehash <span class="org-kcats-brackets">[[</span>children <span class="org-kcats-brackets">[</span>data<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">first</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span> empty <span class="org-builtin">swap</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">join</span><span class="org-kcats-brackets">]</span> <span class="org-function-name">step</span>
          hash
          <span class="org-function-name">wrap</span> <span class="org-kcats-brackets">[</span>0<span class="org-kcats-brackets">]</span> <span class="org-builtin">swap</span> update<span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>joiner <span class="org-kcats-brackets">[[</span>2 2 partition
           <span class="org-kcats-brackets">[[</span><span class="org-function-name">count</span> 1 =<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-function-name">put</span><span class="org-kcats-brackets">]</span> when
            <span class="org-function-name">unwrap</span> siblings<span class="org-kcats-brackets">]</span> each<span class="org-kcats-brackets">]</span>
          assemble <span class="org-kcats-brackets">[</span>rehash<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span><span class="org-kcats-brackets">]]</span>
 <span class="org-kcats-brackets">[</span>merkle <span class="org-kcats-brackets">[[</span>hash node<span class="org-kcats-brackets">]</span> <span class="org-function-name">map</span>
          <span class="org-kcats-brackets">[</span><span class="org-function-name">count</span> 1 &gt;<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span>joiner<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">while</span><span class="org-kcats-brackets">]]]</span>
<span class="org-kcats-brackets">[[</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span> <span class="org-string">"e"</span><span class="org-kcats-brackets">]</span>
 <span class="org-function-name">count</span>
 5 <span class="org-comment-delimiter">;; </span><span class="org-comment">2nd item</span>
 <span class="org-builtin">swap</span> path <span class="org-kcats-brackets">]</span>
let
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1 0 1 0<span class="org-kcats-brackets">]</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"FO3l6Ol62TcjJ3KPUJm5VgSjlZPKw704o0OtdiBSE+c="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"5aAf7hTg7VxIcU8iGA8lrYNltT+XefedxKPX6Tlj+Uo="</span>
                                                        <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"ypeBEsobvcr6wjGzmiPcTaeG7/gUfE5yuYB3ha/uSLs="</span> <span class="org-kcats-brackets">[]]</span>
                                                         <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"PiPoFgA5WUoziU9lZOGxNIu9egCI1CxKy3PurtWcAJ0="</span> <span class="org-kcats-brackets">[]]]]</span>
                                                       <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"v/4LNNuha8b6wXwIusVdZ2ze1aSt5B/iyZJKXd6PPls="</span> <span class="org-kcats-brackets">[[</span>#b64 <span class="org-string">"Ln0sA6lQeuJl7PW1NWiFpTOTogKdJBOUmXJloaJa78Y="</span>
                                                                                                              <span class="org-kcats-brackets">[]]</span>
                                                                                                             <span class="org-kcats-brackets">[</span>#b64 <span class="org-string">"GKw+c0PwFokMUQ6T+TUmEWnZ4/VlQ2Qpgw+vCTT0+OQ="</span> <span class="org-kcats-brackets">[]]]]]]]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 1 1<span class="org-kcats-brackets">]</span> 5 0 <span class="org-kcats-brackets">[[[</span><span class="org-function-name">count</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">shield</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dive</span> -<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span>
        <span class="org-builtin">swap</span> repeat
        <span class="org-builtin">swap</span> <span class="org-function-name">join</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>0 0 1 1 1<span class="org-kcats-brackets">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b439fa" class="outline-3">
<h3 id="org5b439fa"><span class="section-number-3">2.4.</span> <span class="done CANCELED">CANCELED</span> Make taker/dropper more flexible</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Goal: implement drop and drop-while with the same logic
</p>

<p>
Canceled - the commonality between drop and drop-while are too small to be worth trying to factor out.
</p>

<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>1 2 3 4 5<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
3
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span>
  <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span>
  <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[</span>4 5<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[[[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[[</span>generate <span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span>
               <span class="org-preprocessor">dip</span> dec<span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">while</span> <span class="org-kcats-brackets">[</span>generate <span class="org-builtin">swap</span><span class="org-kcats-brackets">]</span>
  <span class="org-preprocessor">dip</span> <span class="org-builtin">float</span><span class="org-kcats-brackets">]</span>
 bail<span class="org-kcats-brackets">]</span>
0 <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>


<p>
This is what drop-while looks like
</p>
<div class="org-src-container">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span>
<span class="org-kcats-brackets">[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">the state (whether threshold reached)</span>
<span class="org-kcats-brackets">[[]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">condition - whether we've finished dropping or not </span>
 <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">true - pass everything else through</span>
 <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">prime init</span>
  <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">bring pred up and exec it</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">if pred passes drop the value</span>
  prime <span class="org-comment-delimiter">;; </span><span class="org-comment">after this should have value on top</span>
  <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> <span class="org-keyword">true</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">dip</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">set flag</span>
 <span class="org-kcats-brackets">]</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">false - generate, check pred, repeat</span>
 <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
collect
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats"><span class="org-kcats-brackets">[]</span> <span class="org-kcats-brackets">[[]</span> <span class="org-kcats-brackets">[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span>
    <span class="org-kcats-brackets">[[[</span>generate<span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span><span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[[[</span><span class="org-builtin">clone</span><span class="org-kcats-brackets">]</span> <span class="org-preprocessor">divedown</span> <span class="org-preprocessor">execute</span><span class="org-kcats-brackets">]</span> bail<span class="org-kcats-brackets">]</span>
     <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span><span class="org-kcats-brackets">]</span> prime <span class="org-kcats-brackets">[</span><span class="org-builtin">drop</span> yes<span class="org-kcats-brackets">]</span>
     <span class="org-preprocessor">dip</span><span class="org-kcats-brackets">]</span>
    <span class="org-preprocessor">if</span><span class="org-kcats-brackets">]</span>
yes <span class="org-kcats-brackets">[</span>positive?<span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[</span><span class="org-function-name">take</span><span class="org-kcats-brackets">]</span> <span class="org-kcats-brackets">[]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Skyrod Vactai</p>
<p class="date">Created: 2024-10-10 Thu 15:52</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
